<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challenge Cup SSIAP - Formation S√©curit√© Incendie</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap');

        * {
            font-family: 'Poppins', sans-serif;
        }

        @keyframes bounce-in {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        @keyframes unlock {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px) rotate(20deg); }
            100% { transform: translateY(-40px) rotate(40deg); opacity: 0; }
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(93, 92, 222, 0.5); }
            50% { box-shadow: 0 0 40px rgba(93, 92, 222, 0.8), 0 0 60px rgba(93, 92, 222, 0.6); }
        }

        @keyframes progress-fill {
            from { height: 0%; }
            to { height: var(--target-height); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        .bounce-in { animation: bounce-in 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .shake { animation: shake 0.5s ease-in-out; }
        .unlock { animation: unlock 0.8s ease-out forwards; }
        .confetti { animation: confetti-fall 3s linear; }
        .float { animation: float 3s ease-in-out infinite; }
        .glow { animation: glow 2s ease-in-out infinite; }
        .pulse-anim { animation: pulse 1s ease-in-out infinite; }

        .glass-morphism {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .glass-morphism {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .neon-text {
            text-shadow: 0 0 10px rgba(93, 92, 222, 0.8),
                         0 0 20px rgba(93, 92, 222, 0.6),
                         0 0 30px rgba(93, 92, 222, 0.4);
        }

        .progress-bar-vertical {
            position: relative;
            width: 100%;
            height: 500px;
            background: linear-gradient(180deg, #e0e0e0 0%, #f5f5f5 100%);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }

        .progress-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            transition: height 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .box-segment {
            width: 100%;
            border-top: 2px solid rgba(255,255,255,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            transition: all 0.5s;
        }

        .matching-item {
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .matching-item.selected {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(93, 92, 222, 0.8);
        }

        .matching-item.matched {
            opacity: 0.6;
            pointer-events: none;
        }

        .puzzle-piece {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            text-align: center;
            padding: 10px;
            min-height: 60px;
        }

        .puzzle-piece:hover {
            transform: rotateY(10deg) scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .puzzle-piece.correct {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            animation: pulse-success 0.6s;
        }

        @keyframes pulse-success {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .draw-canvas {
            border: 3px solid #5D5CDE;
            border-radius: 12px;
            background: white;
            cursor: crosshair;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .sequence-item {
            transition: all 0.3s;
            cursor: pointer;
        }

        .sequence-item:hover {
            transform: translateY(-5px);
        }

        .sequence-item.selected {
            transform: scale(0.95);
            opacity: 0.5;
        }

        .timer-critical {
            animation: pulse-red 0.5s infinite;
        }

        @keyframes pulse-red {
            0%, 100% { color: #ef4444; transform: scale(1); }
            50% { color: #dc2626; transform: scale(1.1); }
        }

        .ranking-badge {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .rank-1 { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); }
        .rank-2 { background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%); }
        .rank-3 { background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%); }
        .rank-other { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); }
    </style>
    <script>

// ==================== GESTION S√âLECTION NIVEAU ====================

// Fonction pour afficher/cacher les √©crans
function showLevelScreen(screenId) {
    const screens = ['level-selection-screen', 'auth-screen', 'login-screen', 'player-entry-screen', 'supervisor-screen', 'boxes-screen', 'game-screen', 'end-screen', 'admin-screen'];
    screens.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            if (id === screenId) {
                element.classList.remove('hidden');
            } else {
                element.classList.add('hidden');
            }
        }
    });
}

function showScreen(screenId) {
    showLevelScreen(screenId);
}

// La fonction selectLevel() et les event listeners sont d√©finis dans le deuxi√®me script
// o√π toutes les variables n√©cessaires (PASSWORD_HASHES, BOXES_DATA_BY_LEVEL, etc.) sont disponibles


// Ajouter un bouton retour dans l'√©cran de login
function addBackButton() {
    const loginScreen = document.getElementById('login-screen');
    if (loginScreen && !document.getElementById('back-to-selection')) {
        const backBtn = document.createElement('button');
        backBtn.id = 'back-to-selection';
        backBtn.className = 'absolute top-6 left-6 px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-all';
        backBtn.innerHTML = '‚Üê Retour';
        backBtn.onclick = () => {
            playSound('tick');
            showLevelScreen('level-selection-screen');
        };
        loginScreen.appendChild(backBtn);
    }
}

// Appeler addBackButton apr√®s le chargement
setTimeout(addBackButton, 100);



        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }
    </script>
</head>
<body class="h-full bg-gradient-to-br from-red-100 via-orange-50 to-yellow-100 dark:from-gray-900 dark:via-red-900 dark:to-gray-800">
    <!-- Confetti Container -->
    <div id="confetti-container" class="fixed inset-0 pointer-events-none z-50"></div>

    <div id="app" class="min-h-screen p-4 md:p-8">

        <!-- √âcran de s√©lection du niveau SSIAP -->
        <div id="level-selection-screen" class="max-w-6xl mx-auto">
            <div class="text-center mb-12 bounce-in">
                <div class="text-8xl mb-6">üèÜ</div>
                <h1 class="text-5xl md:text-7xl font-bold neon-text text-primary mb-4">Challenge Cup SSIAP</h1>
                <p class="text-xl md:text-2xl text-gray-700 dark:text-gray-300 font-semibold">S√©lectionnez votre niveau de formation</p>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
                <!-- SSIAP 1 -->
                <div class="level-card glass-morphism rounded-3xl shadow-2xl p-8 text-center cursor-pointer hover:shadow-3xl transform hover:scale-105 transition-all bounce-in" data-level="1" style="animation-delay: 0.1s">
                    <div class="text-7xl mb-4">üë®‚Äçüöí</div>
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">SSIAP 1</h2>
                    <p class="text-lg text-gray-600 dark:text-gray-400 mb-4">Agent de S√©curit√© Incendie</p>
                    <div class="text-sm text-gray-500 dark:text-gray-500">
                        <p>‚Ä¢ Pr√©vention incendie</p>
                        <p>‚Ä¢ Secours aux personnes</p>
                        <p>‚Ä¢ Mise en s√©curit√©</p>
                    </div>
                </div>

                <!-- SSIAP 2 -->
                <div class="level-card glass-morphism rounded-3xl shadow-2xl p-8 text-center cursor-pointer hover:shadow-3xl transform hover:scale-105 transition-all bounce-in" data-level="2" style="animation-delay: 0.2s">
                    <div class="text-7xl mb-4">üë®‚Äç‚úàÔ∏è</div>
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">SSIAP 2</h2>
                    <p class="text-lg text-gray-600 dark:text-gray-400 mb-4">Chef d'√âquipe</p>
                    <div class="text-sm text-gray-500 dark:text-gray-500">
                        <p>‚Ä¢ Gestion d'√©quipe</p>
                        <p>‚Ä¢ Manipulation SSI</p>
                        <p>‚Ä¢ Gestion de crise</p>
                    </div>
                </div>

                <!-- SSIAP 3 -->
                <div class="level-card glass-morphism rounded-3xl shadow-2xl p-8 text-center cursor-pointer hover:shadow-3xl transform hover:scale-105 transition-all bounce-in" data-level="3" style="animation-delay: 0.3s">
                    <div class="text-7xl mb-4">üëî</div>
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">SSIAP 3</h2>
                    <p class="text-lg text-gray-600 dark:text-gray-400 mb-4">Chef de Service</p>
                    <div class="text-sm text-gray-500 dark:text-gray-500">
                        <p>‚Ä¢ Management du service</p>
                        <p>‚Ä¢ R√©glementation</p>
                        <p>‚Ä¢ Projets et travaux</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- √âcran d'authentification par mot de passe -->
        <div id="auth-screen" class="hidden max-w-md mx-auto">
            <div class="text-center mb-8 bounce-in">
                <div class="text-8xl mb-6">üîê</div>
                <h1 class="text-4xl md:text-5xl font-bold text-primary mb-4">Challenge Cup SSIAP</h1>
                <p class="text-lg text-gray-700 dark:text-gray-300">Formation S√©curit√© Incendie</p>
            </div>

            <div class="glass-morphism rounded-3xl shadow-2xl p-8 bounce-in" style="animation-delay: 0.2s">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 text-center">Entrez le mot de passe</h2>

                <form id="auth-form" class="space-y-6">
                    <div>
                        <label for="auth-password" class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">
                            Mot de passe
                        </label>
                        <input
                            type="password"
                            id="auth-password"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base focus:border-primary focus:outline-none"
                            required
                            autocomplete="off"
                        >
                    </div>

                    <div id="auth-error" class="hidden text-red-600 dark:text-red-400 text-sm font-semibold text-center bg-red-50 dark:bg-red-900/20 p-3 rounded-lg">
                        ‚ùå Mot de passe incorrect
                    </div>

                    <button
                        type="submit"
                        class="w-full bg-gradient-to-r from-primary via-orange-600 to-yellow-600 text-white text-xl font-bold py-4 rounded-xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all"
                    >
                        üîì D√©verrouiller
                    </button>
                </form>

                <div class="mt-6 text-center text-xs text-gray-500 dark:text-gray-400">
                    üîí Acc√®s r√©serv√© aux membres autoris√©s
                </div>
            </div>
        </div>

        <!-- Page de connexion (Superviseur) -->
        <div id="login-screen" class="hidden max-w-4xl mx-auto">
            <div class="text-center mb-8 bounce-in">
                <h1 class="text-5xl md:text-7xl font-bold neon-text text-primary mb-4">üî• <span id="login-title">Challenge Cup SSIAP</span></h1>
                <p class="text-xl md:text-2xl text-gray-700 dark:text-gray-300 font-semibold">Formation S√©curit√© Incendie</p>
            </div>

            <div class="max-w-md mx-auto mb-6">
                <div class="glass-morphism rounded-3xl shadow-2xl p-8 text-center bounce-in" style="animation-delay: 0.2s">
                    <div class="text-6xl mb-4">üë®‚Äçüöí</div>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Superviseur</h2>
                    <p class="text-gray-600 dark:text-gray-400 mb-6">Suivez la progression de tous les groupes en temps r√©el</p>
                    <button id="supervisor-btn" class="w-full bg-gradient-to-r from-red-600 to-orange-600 text-white text-xl font-bold py-4 rounded-xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all">
                        üìä Tableau de Bord
                    </button>
                </div>
            </div>

            <div class="glass-morphism rounded-3xl shadow-2xl p-8 text-center bounce-in" style="animation-delay: 0.6s">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">üì± Connexion Mobile</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">Scannez ce QR code pour rejoindre depuis votre mobile/tablette</p>
                <div id="qrcode" class="inline-block p-4 bg-white rounded-xl mb-4"></div>
                <p class="text-sm text-gray-500 dark:text-gray-500 mb-2">ou</p>
                <button id="manual-player-access-btn" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white text-base font-bold rounded-xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all">
                    üë• Acc√®s Joueur Direct
                </button>
            </div>
        </div>

        <!-- Page de connexion (Joueur - accessible via QR code) -->
        <div id="player-entry-screen" class="hidden max-w-4xl mx-auto">
            <div class="text-center mb-8 bounce-in">
                <h1 class="text-5xl md:text-7xl font-bold neon-text text-primary mb-4">üî• <span id="player-login-title">Challenge Cup SSIAP</span></h1>
                <p class="text-xl md:text-2xl text-gray-700 dark:text-gray-300 font-semibold">Formation S√©curit√© Incendie</p>
            </div>

            <div class="max-w-md mx-auto">
                <div class="glass-morphism rounded-3xl shadow-2xl p-8 text-center bounce-in" style="animation-delay: 0.2s">
                    <div class="text-6xl mb-4">üë•</div>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Joueur / Groupe</h2>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">Rejoignez la chasse au tr√©sor</p>

                    <input type="text" id="team-name-input" placeholder="Nom de votre √©quipe" class="w-full px-4 py-3 rounded-lg border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-white mb-4 text-base focus:border-primary focus:outline-none" maxlength="20">

                    <button id="player-btn" class="w-full bg-gradient-to-r from-primary via-purple-600 to-pink-600 text-white text-xl font-bold py-4 rounded-xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all">
                        üöÄ Commencer
                    </button>
                </div>
            </div>
        </div>

        <!-- Tableau de bord Superviseur -->
        <div id="supervisor-screen" class="hidden max-w-full mx-auto">
            <div class="text-center mb-6">
                <h1 class="text-4xl md:text-5xl font-bold text-primary neon-text mb-2">üë®‚Äçüöí Tableau de Bord SSIAP 1</h1>
                <p class="text-lg text-gray-600 dark:text-gray-400">Progression en temps r√©el</p>
                <div class="mt-4 flex flex-wrap justify-center gap-3">
                    <button id="back-to-login-supervisor" class="px-6 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-all">
                        ‚Üê Retour
                    </button>
                    <button id="stop-all-games-btn" class="px-6 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition-all">
                        ‚è∏Ô∏è Arr√™ter le Jeu
                    </button>
                    <button id="reset-all-btn" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-all">
                        üîÑ R√©initialiser Tout
                    </button>
                    <button id="admin-mode-btn" class="px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-all">
                        üîß Mode ADMIN
                    </button>
                </div>
            </div>

            <div class="glass-morphism rounded-3xl shadow-2xl p-6 mb-6">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-primary" id="active-teams-count">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">√âquipes Actives</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-green-600" id="finished-teams-count">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">√âquipes Termin√©es</div>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full pulse-anim"></div>
                        <span class="text-sm text-gray-600 dark:text-gray-400">Mise √† jour en direct</span>
                    </div>
                </div>
            </div>

            <!-- Barres de progression verticales -->
            <div id="teams-progress-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                <!-- Les barres seront g√©n√©r√©es ici -->
            </div>

            <!-- Classement final -->
            <div id="final-ranking" class="hidden mt-8 glass-morphism rounded-3xl shadow-2xl p-8">
                <h2 class="text-3xl font-bold text-center text-gray-800 dark:text-white mb-6">üèÜ Classement Final</h2>
                <div id="ranking-list" class="space-y-4">
                    <!-- Le classement sera g√©n√©r√© ici -->
                </div>
            </div>
        </div>

        <!-- √âcran des coffres (Joueur) -->
        <div id="boxes-screen" class="hidden max-w-7xl mx-auto">
            <div class="text-center mb-6">
                <div class="inline-block glass-morphism px-6 py-3 rounded-full mb-4">
                    <span class="text-xl font-bold text-primary" id="team-name-display"></span>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold text-primary neon-text mb-4">üéÅ Les Coffres au Tr√©sor SST</h1>
                <div class="flex justify-center items-center gap-6 flex-wrap">
                    <div class="text-center">
                        <div class="text-4xl font-bold text-primary" id="total-score-display">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Points Totaux</div>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl font-bold text-green-600" id="boxes-unlocked">0/8</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Coffres Ouverts</div>
                    </div>
                </div>
            </div>

            <div id="boxes-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
                <!-- Les coffres seront g√©n√©r√©s ici -->
            </div>
        </div>

        <!-- √âcran de jeu -->
        <div id="game-screen" class="hidden max-w-6xl mx-auto">
            <!-- En-t√™te avec score et progression -->
            <div class="glass-morphism rounded-2xl shadow-xl p-4 md:p-6 mb-6 bounce-in">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <button id="back-to-boxes" class="px-6 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-all">
                        ‚Üê Retour aux coffres
                    </button>

                    <div class="flex items-center gap-6">
                        <div class="text-center">
                            <div class="text-3xl font-bold text-primary" id="game-score-display">0</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Points</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-orange-600" id="timer-display">60</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Secondes</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl" id="attempts-display">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Essais</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Container du jeu actuel -->
            <div id="current-game" class="glass-morphism rounded-3xl shadow-2xl p-6 md:p-8 bounce-in">
                <!-- Le contenu du jeu sera ins√©r√© ici dynamiquement -->
            </div>

            <!-- Boutons de validation -->
            <div id="game-controls" class="mt-6 flex gap-4">
                <button id="validate-btn" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white text-xl font-bold py-5 rounded-xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all duration-300">
                    ‚úì Valider la R√©ponse
                </button>
                <button id="reset-answer-btn" class="hidden px-6 bg-gradient-to-r from-orange-500 to-red-600 text-white text-xl font-bold py-5 rounded-xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all duration-300">
                    üîÑ R√©initialiser
                </button>
            </div>
        </div>

        <!-- √âcran de fin -->
        <div id="end-screen" class="hidden max-w-5xl mx-auto text-center">
            <div class="glass-morphism rounded-3xl shadow-2xl p-8 md:p-12 bounce-in">
                <div class="text-8xl mb-6">üèÜ</div>
                <h1 class="text-5xl md:text-6xl font-bold text-primary neon-text mb-6">Mission Accomplie !</h1>
                <p class="text-2xl text-gray-700 dark:text-gray-300 mb-8">Vous √™tes maintenant un expert SSIAP 1 certifi√© !</p>

                <div class="bg-gradient-to-r from-primary via-orange-600 to-yellow-600 text-white rounded-2xl p-10 mb-8 shadow-2xl">
                    <div class="text-7xl font-bold mb-3" id="final-score">0</div>
                    <div class="text-3xl font-semibold">Points totaux</div>
                </div>

                <div id="final-stats" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <!-- Stats seront ajout√©es dynamiquement -->
                </div>

                <button id="restart-btn" class="bg-gradient-to-r from-primary via-orange-600 to-yellow-600 text-white text-3xl font-bold py-8 px-16 rounded-2xl shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all duration-300 glow">
                    üîÑ Recommencer l'Aventure
                </button>
            </div>
        </div>

        <!-- √âcran ADMIN -->
        <div id="admin-screen" class="hidden max-w-7xl mx-auto">
            <div class="glass-morphism rounded-3xl shadow-2xl p-6 md:p-10">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-bold text-primary neon-text">üîß Mode ADMIN</h1>
                    <button id="admin-close-btn" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold transition-all">
                        ‚úï Fermer
                    </button>
                </div>

                <div class="grid md:grid-cols-3 gap-6">
                    <!-- Colonne gauche : Liste des coffres et jeux -->
                    <div class="md:col-span-1 bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg flex flex-col max-h-[600px]">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-white">üì¶ Coffres & Jeux</h2>

                        <!-- Barre de recherche -->
                        <div class="mb-4">
                            <input
                                type="text"
                                id="admin-search"
                                placeholder="üîç Rechercher un jeu..."
                                class="w-full px-4 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:border-primary focus:outline-none"
                            >
                        </div>

                        <!-- Filtres par type -->
                        <div class="mb-4 flex flex-wrap gap-2">
                            <button class="admin-filter-btn px-3 py-1 text-xs rounded-full bg-primary text-white" data-type="all">
                                Tous
                            </button>
                            <button class="admin-filter-btn px-3 py-1 text-xs rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-type="quiz">
                                QCM
                            </button>
                            <button class="admin-filter-btn px-3 py-1 text-xs rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-type="true-false">
                                V/F
                            </button>
                            <button class="admin-filter-btn px-3 py-1 text-xs rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-type="matching">
                                Appariement
                            </button>
                            <button class="admin-filter-btn px-3 py-1 text-xs rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-type="sequence">
                                S√©quence
                            </button>
                        </div>

                        <!-- Compteur de r√©sultats -->
                        <div class="mb-3 text-sm text-gray-600 dark:text-gray-400">
                            <span id="admin-results-count">0</span> jeu(x) affich√©(s)
                        </div>

                        <!-- Liste scrollable -->
                        <div id="admin-boxes-list" class="space-y-3 overflow-y-auto flex-1">
                            <!-- Liste des coffres sera g√©n√©r√©e ici -->
                        </div>
                    </div>

                    <!-- Colonne droite : Formulaire d'√©dition -->
                    <div class="md:col-span-2 bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
                        <div id="admin-no-selection" class="text-center py-20 text-gray-500 dark:text-gray-400">
                            <div class="text-6xl mb-4">üëà</div>
                            <p class="text-xl">S√©lectionnez un jeu √† modifier</p>
                        </div>

                        <div id="admin-edit-form" class="hidden space-y-6 max-h-[600px] overflow-y-auto pr-4">
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white sticky top-0 bg-white dark:bg-gray-800 pb-4 z-10">
                                ‚úèÔ∏è √âdition du jeu
                            </h2>

                            <!-- S√©lecteur de variantes -->
                            <div id="admin-variation-selector" class="hidden">
                                <!-- Le s√©lecteur sera g√©n√©r√© dynamiquement -->
                            </div>

                            <div class="space-y-4">
                                <!-- Type de jeu (lecture seule) -->
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Type de jeu</label>
                                    <input type="text" id="admin-type" readonly class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-white">
                                </div>

                                <!-- Titre -->
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Titre</label>
                                    <input type="text" id="admin-title" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base">
                                </div>

                                <!-- Question -->
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Question</label>
                                    <textarea id="admin-question" rows="3" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base"></textarea>
                                </div>

                                <!-- Options/R√©ponses (dynamique selon le type) -->
                                <div id="admin-options-container">
                                    <!-- Les options seront g√©n√©r√©es dynamiquement -->
                                </div>

                                <!-- R√©ponse correcte -->
                                <div id="admin-correct-answer-container">
                                    <!-- Le champ de r√©ponse correcte sera g√©n√©r√© dynamiquement -->
                                </div>

                                <!-- Explication (pour true-false) -->
                                <div id="admin-explanation-container" class="hidden">
                                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Explication</label>
                                    <textarea id="admin-explanation" rows="3" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base"></textarea>
                                </div>

                                <!-- Limite de temps -->
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Limite de temps (secondes)</label>
                                    <input type="number" id="admin-timeLimit" min="10" max="300" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base">
                                </div>

                                <!-- Points -->
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Points</label>
                                    <input type="number" id="admin-points" min="10" max="500" step="10" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base">
                                </div>
                            </div>

                            <!-- Boutons d'action -->
                            <div class="flex gap-4 pt-6 border-t border-gray-200 dark:border-gray-700 sticky bottom-0 bg-white dark:bg-gray-800">
                                <button id="admin-save-btn" class="flex-1 px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition-all shadow-lg">
                                    üíæ Enregistrer les modifications
                                </button>
                                <button id="admin-cancel-btn" class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-all">
                                    ‚ùå Annuler
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Panneau de contr√¥le du timing global -->
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">‚è±Ô∏è Contr√¥le du Timing Global</h3>

                    <div class="bg-gradient-to-br from-orange-50 to-yellow-50 dark:from-gray-800 dark:to-gray-700 rounded-2xl p-6 mb-4">
                        <!-- Statistiques actuelles -->
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-orange-600 dark:text-orange-400" id="admin-avg-time">0</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Temps moyen (sec)</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-blue-600 dark:text-blue-400" id="admin-min-time">0</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Minimum (sec)</div>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl font-bold text-red-600 dark:text-red-400" id="admin-max-time">0</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Maximum (sec)</div>
                            </div>
                        </div>

                        <!-- Presets de vitesse -->
                        <div class="mb-4">
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-3">Presets de vitesse</label>
                            <div class="grid grid-cols-4 gap-3">
                                <button class="admin-speed-preset px-4 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold transition-all shadow-lg" data-multiplier="0.5">
                                    üî• Ultra Rapide<br><span class="text-xs opacity-80">-50%</span>
                                </button>
                                <button class="admin-speed-preset px-4 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold transition-all shadow-lg" data-multiplier="0.75">
                                    ‚ö° Rapide<br><span class="text-xs opacity-80">-25%</span>
                                </button>
                                <button class="admin-speed-preset px-4 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold transition-all shadow-lg" data-multiplier="1.25">
                                    üê¢ Lent<br><span class="text-xs opacity-80">+25%</span>
                                </button>
                                <button class="admin-speed-preset px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-all shadow-lg" data-multiplier="1.5">
                                    ü¶• Tr√®s Lent<br><span class="text-xs opacity-80">+50%</span>
                                </button>
                            </div>
                        </div>

                        <!-- Contr√¥le manuel -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl p-4">
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-3">Ajustement personnalis√©</label>
                            <div class="flex gap-3 items-center">
                                <input
                                    type="number"
                                    id="admin-time-multiplier"
                                    min="0.1"
                                    max="3"
                                    step="0.1"
                                    value="1.0"
                                    class="w-32 px-4 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base font-bold text-center"
                                >
                                <span class="text-gray-600 dark:text-gray-400">√ó multiplicateur</span>
                                <button id="admin-apply-multiplier" class="flex-1 px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-all">
                                    Appliquer √† tous les jeux
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                                üí° Exemple : 0.5 = diviser par 2 (plus rapide), 2.0 = doubler (plus lent)
                            </p>
                        </div>

                        <!-- D√©finir un temps fixe -->
                        <div class="bg-white dark:bg-gray-800 rounded-xl p-4 mt-3">
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-3">Temps fixe pour tous</label>
                            <div class="flex gap-3 items-center">
                                <input
                                    type="number"
                                    id="admin-fixed-time"
                                    min="10"
                                    max="300"
                                    step="5"
                                    value="30"
                                    class="w-32 px-4 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base font-bold text-center"
                                >
                                <span class="text-gray-600 dark:text-gray-400">secondes</span>
                                <button id="admin-apply-fixed-time" class="flex-1 px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-semibold transition-all">
                                    D√©finir ce temps pour tous
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Boutons de gestion globale -->
                <div class="flex gap-4 mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button id="admin-export-btn" class="flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-all">
                        üì• Exporter toutes les questions (JSON)
                    </button>
                    <button id="admin-import-btn" class="flex-1 px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-all">
                        üì§ Importer des questions (JSON)
                    </button>
                </div>
                <input type="file" id="admin-import-file" accept=".json" class="hidden">
            </div>
        </div>
    </div>

<script>
 
// Configuration du th√®me sombre
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.classList.add('dark');
}
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
    if (event.matches) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
});

// ==================== AUTHENTIFICATION ====================

// Hash SHA-256 simple (compatible navigateur)
async function hashPassword(password) {
    const msgBuffer = new TextEncoder().encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    return hashHex;
}

// Mot de passe unique pour acc√©der √† l'application
const MASTER_PASSWORD_HASH = 'd203a5ec80cba930926704ea5e0ed009acf71190a76faf5920e318a4aee5dbef'; // MiBSSIAP

// Donn√©es des questions par niveau
const BOXES_DATA_BY_LEVEL = {
    1: [
    {
        "title": "Le Feu",
        "subtitle": "Conna√Ætre le comportement du feu",
        "icon": "üî•",
        "color": "from-red-500 to-orange-700",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Triangle du Feu",
                    "question": "Quels sont les 3 √©l√©ments n√©cessaires pour qu'un feu se d√©clare ?",
                    "options": [
                        "Combustible, Comburant, √ânergie d'activation",
                        "Chaleur, Fum√©e, Flamme",
                        "Oxyg√®ne, Azote, Hydrog√®ne",
                        "Bois, Papier, Tissu"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Triangle du Feu",
                    "question": "Comment appelle-t-on l'√©l√©ment qui br√ªle dans le triangle du feu ?",
                    "options": [
                        "Le combustible",
                        "Le comburant",
                        "L'√©nergie d'activation",
                        "La flamme"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 35,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Triangle du Feu",
                    "question": "Quel est le comburant le plus courant dans un incendie ?",
                    "options": [
                        "L'oxyg√®ne de l'air",
                        "Le dioxyde de carbone",
                        "L'azote",
                        "L'eau"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 35,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Triangle du Feu",
                    "question": "Quelle est la concentration minimale d'oxyg√®ne n√©cessaire √† la combustion ?",
                    "options": [
                        "18%",
                        "21%",
                        "15%",
                        "25%"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Triangle du Feu",
                    "question": "Pour √©teindre un feu, on peut agir sur :",
                    "options": [
                        "Un ou plusieurs √©l√©ments du triangle du feu",
                        "Uniquement le combustible",
                        "Uniquement la flamme",
                        "La couleur de la fum√©e"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Triangle du Feu",
                    "question": "L'√©nergie d'activation peut provenir de :",
                    "options": [
                        "Une √©tincelle, une flamme nue, un point chaud",
                        "Uniquement de l'√©lectricit√©",
                        "Uniquement du soleil",
                        "La pr√©sence d'oxyg√®ne"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Classes de Feu",
                    "question": "Un feu de classe B concerne les liquides et solides liqu√©fiables.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Les feux de classe B concernent les liquides inflammables (essence, huile, alcool) et les solides liqu√©fiables (paraffine, cires).",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Classes de Feu",
                    "question": "Un feu de classe A concerne uniquement le bois.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - Les feux de classe A concernent tous les solides : bois, papier, carton, tissu, plastiques, etc.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Classes de Feu",
                    "question": "Un feu de classe C concerne les gaz inflammables.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Les feux de classe C concernent les gaz inflammables comme le propane, le butane, le m√©thane, etc.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Classes de Feu",
                    "question": "Un feu de classe D concerne les m√©taux comme le magn√©sium ou l'aluminium.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Les feux de classe D concernent les m√©taux l√©gers (magn√©sium, aluminium, sodium, etc.).",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Classes de Feu",
                    "question": "Un feu de friteuse est un feu de classe A.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - Un feu de friteuse (huile) est un feu de classe B (liquides inflammables).",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Classes de Feu",
                    "question": "On peut utiliser de l'eau sur tous les types de feux.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - L'eau ne doit JAMAIS √™tre utilis√©e sur les feux de classe B (liquides), D (m√©taux) ou sur installations √©lectriques.",
                    "timeLimit": 30,
                    "points": 80
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Classes de Feu",
                    "question": "Associez chaque classe de feu avec le bon type de combustible :",
                    "pairs": [
                        {
                            "left": "Classe A",
                            "right": "Solides (bois, papier, tissu)"
                        },
                        {
                            "left": "Classe B",
                            "right": "Liquides ou solides liqu√©fiables"
                        },
                        {
                            "left": "Classe C",
                            "right": "Gaz"
                        },
                        {
                            "left": "Classe D",
                            "right": "M√©taux"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Agents Extincteurs",
                    "question": "Associez chaque agent extincteur avec son utilisation principale :",
                    "pairs": [
                        {
                            "left": "Eau pulv√©ris√©e",
                            "right": "Feux de classe A"
                        },
                        {
                            "left": "Poudre ABC",
                            "right": "Feux A, B, C polyvalent"
                        },
                        {
                            "left": "CO2",
                            "right": "Feux √©lectriques et B"
                        },
                        {
                            "left": "Mousse",
                            "right": "Feux de classe B"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Modes de Propagation",
                    "question": "Associez chaque mode de propagation avec sa d√©finition :",
                    "pairs": [
                        {
                            "left": "Conduction",
                            "right": "Par contact direct"
                        },
                        {
                            "left": "Convection",
                            "right": "Par d√©placement de gaz chauds"
                        },
                        {
                            "left": "Rayonnement",
                            "right": "Par ondes √©lectromagn√©tiques"
                        },
                        {
                            "left": "Projection",
                            "right": "Par projections de mati√®res"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Ph√©nom√®nes Thermiques",
                    "question": "Associez chaque ph√©nom√®ne avec sa caract√©ristique :",
                    "pairs": [
                        {
                            "left": "Flashover",
                            "right": "Embrasement g√©n√©ralis√© √©clair"
                        },
                        {
                            "left": "Backdraft",
                            "right": "Explosion de fum√©es"
                        },
                        {
                            "left": "Point √©clair",
                            "right": "Temp√©rature d'inflammation"
                        },
                        {
                            "left": "Auto-inflammation",
                            "right": "Combustion spontan√©e"
                        }
                    ],
                    "timeLimit": 70,
                    "points": 140
                },
                {
                    "type": "matching",
                    "title": "Couleur des Fum√©es",
                    "question": "Associez la couleur de fum√©e avec ce qu'elle indique :",
                    "pairs": [
                        {
                            "left": "Fum√©e blanche",
                            "right": "Vapeur d'eau ou mat√©riaux l√©gers"
                        },
                        {
                            "left": "Fum√©e noire",
                            "right": "Combustion d'hydrocarbures"
                        },
                        {
                            "left": "Fum√©e jaune",
                            "right": "Mati√®res plastiques/chimiques"
                        },
                        {
                            "left": "Fum√©e grise",
                            "right": "Combustion normale"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ]
        ]
    },
    {
        "title": "S√©curit√© Incendie",
        "subtitle": "Principes r√©glementaires",
        "icon": "üè¢",
        "color": "from-orange-500 to-yellow-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Classification ERP",
                    "question": "Qu'est-ce qu'un ERP ?",
                    "options": [
                        "√âtablissement Recevant du Public",
                        "√âquipement de R√©duction des P√©rils",
                        "Espace R√©serv√© aux Pompiers",
                        "√âtage de Rassemblement Principal"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Types d'ERP",
                    "question": "Un restaurant est un ERP de type :",
                    "options": [
                        "N (restaurants)",
                        "L (salles de spectacle)",
                        "M (magasins)",
                        "O (h√¥tels)"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Cat√©gories ERP",
                    "question": "√Ä partir de combien de personnes un ERP est-il de 1√®re cat√©gorie ?",
                    "options": [
                        "Plus de 1500 personnes",
                        "Plus de 1000 personnes",
                        "Plus de 2000 personnes",
                        "Plus de 700 personnes"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Types d'ERP",
                    "question": "Un centre commercial est un ERP de type :",
                    "options": [
                        "M (magasins de vente)",
                        "N (restaurants)",
                        "L (salles de spectacle)",
                        "W (administrations)"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "R√©glementation ERP",
                    "question": "Quel texte r√©glemente la s√©curit√© incendie dans les ERP ?",
                    "options": [
                        "Arr√™t√© du 25 juin 1980",
                        "Code du travail",
                        "Arr√™t√© du 2 mai 2005",
                        "R√®glement de s√©curit√© incendie"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Commission de s√©curit√©",
                    "question": "Qui pr√©side la commission de s√©curit√© d'un ERP ?",
                    "options": [
                        "Le repr√©sentant du maire",
                        "Le chef d'√©tablissement",
                        "Le SSIAP",
                        "Le sapeur-pompier"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "Cat√©gories ERP",
                    "question": "Quelles cat√©gories d'ERP existent selon l'effectif ? (Plusieurs r√©ponses)",
                    "options": [
                        "1√®re cat√©gorie (> 1500 personnes)",
                        "2√®me cat√©gorie (701 √† 1500 personnes)",
                        "3√®me cat√©gorie (301 √† 700 personnes)",
                        "4√®me cat√©gorie (jusqu'√† 300 personnes)",
                        "5√®me cat√©gorie (seuil variable selon le type)"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3,
                        4
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Principes de S√©curit√©",
                    "question": "Quels sont les principes fondamentaux de la s√©curit√© incendie en ERP ? (Plusieurs r√©ponses)",
                    "options": [
                        "√âvacuation rapide du public",
                        "Limitation de la propagation du feu",
                        "Accessibilit√© aux secours",
                        "Alerte rapide des secours",
                        "D√©tection automatique"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Moyens de Secours",
                    "question": "Quels moyens de secours sont obligatoires dans un ERP ? (Plusieurs r√©ponses)",
                    "options": [
                        "Extincteurs",
                        "√âclairage de s√©curit√©",
                        "Syst√®me de s√©curit√© incendie (SSI)",
                        "Issue de secours",
                        "Alarme incendie"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        3,
                        4
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "D√©gagements",
                    "question": "Quelles r√®gles s'appliquent aux d√©gagements d'un ERP ? (Plusieurs r√©ponses)",
                    "options": [
                        "2 sorties minimum si effectif > 50",
                        "Largeur minimale : 0,90 m par unit√© de passage",
                        "Ouvrant dans le sens de l'√©vacuation si > 50 pers.",
                        "Toujours √©quip√©s de barres anti-panique",
                        "Signal√©s et √©clair√©s"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        4
                    ],
                    "timeLimit": 70,
                    "points": 160
                },
                {
                    "type": "quiz-multi",
                    "title": "D√©senfumage",
                    "question": "Quels sont les objectifs du d√©senfumage ? (Plusieurs r√©ponses)",
                    "options": [
                        "Faciliter l'√©vacuation du public",
                        "Limiter la propagation de l'incendie",
                        "Faciliter l'intervention des secours",
                        "R√©duire la temp√©rature",
                        "Prot√©ger les biens"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "D√©senfumage",
                    "question": "Le d√©senfumage permet d'√©vacuer les fum√©es et gaz chauds.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le d√©senfumage √©vacue fum√©es et gaz chauds, facilitant l'√©vacuation et l'intervention des secours.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "D√©senfumage",
                    "question": "Le d√©senfumage peut √™tre naturel ou m√©canique.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le d√©senfumage naturel utilise les ouvrants, le m√©canique utilise des ventilateurs extracteurs.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "D√©senfumage",
                    "question": "Les exutoires de fum√©e doivent √™tre ferm√©s en cas d'incendie.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - Les exutoires doivent √™tre OUVERTS pour √©vacuer les fum√©es vers l'ext√©rieur.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "D√©senfumage",
                    "question": "La surface utile d'un exutoire est g√©n√©ralement de 1 m¬≤ minimum.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La surface utile d'un exutoire est g√©n√©ralement de 1 m¬≤ pour √™tre efficace.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "D√©senfumage",
                    "question": "Le d√©senfumage m√©canique n√©cessite une alimentation √©lectrique de s√©curit√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Les ventilateurs de d√©senfumage doivent √™tre aliment√©s par une source de s√©curit√©.",
                    "timeLimit": 35,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "D√©senfumage",
                    "question": "Les √©crans de cantonnement servent √† diriger les fum√©es vers les exutoires.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Les √©crans de cantonnement (hauteur minimale 1 m) guident les fum√©es vers les exutoires.",
                    "timeLimit": 35,
                    "points": 80
                }
            ]
        ]
    },
    {
        "title": "Installations Techniques",
        "subtitle": "SSI et √©quipements de s√©curit√©",
        "icon": "‚öôÔ∏è",
        "color": "from-yellow-500 to-green-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Syst√®me de S√©curit√© Incendie",
                    "question": "Que signifie SSI ?",
                    "options": [
                        "Syst√®me de S√©curit√© Incendie",
                        "Service de Surveillance Int√©rieur",
                        "Syst√®me de Signalisation Intelligente",
                        "Service de S√©curit√© Int√©gr√©"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Cat√©gories SSI",
                    "question": "Combien existe-t-il de cat√©gories de SSI ?",
                    "options": [
                        "5 cat√©gories (A, B, C, D, E)",
                        "3 cat√©gories",
                        "4 cat√©gories",
                        "6 cat√©gories"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "SSI Cat√©gorie A",
                    "question": "Quelle est la cat√©gorie de SSI la plus compl√®te ?",
                    "options": [
                        "Cat√©gorie A",
                        "Cat√©gorie E",
                        "Cat√©gorie C",
                        "Cat√©gorie B"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 35,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Composants SSI",
                    "question": "Le SSI est compos√© du SDI et du :",
                    "options": [
                        "SMSI (Syst√®me de Mise en S√©curit√© Incendie)",
                        "SSIAP (Service de S√©curit√©)",
                        "SME (Syst√®me de Mise √† l'√âcart)",
                        "SDE (Syst√®me de D√©tection √âtendu)"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "SDI",
                    "question": "Que signifie SDI ?",
                    "options": [
                        "Syst√®me de D√©tection Incendie",
                        "Service de D√©fense Incendie",
                        "Syst√®me de Diffusion d'Information",
                        "S√©curit√© Documentaire Incendie"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "SMSI",
                    "question": "Que fait le SMSI en cas d'incendie ?",
                    "options": [
                        "Active les dispositifs de s√©curit√© (d√©senfumage, alarme, etc.)",
                        "D√©tecte l'incendie uniquement",
                        "Appelle automatiquement les pompiers",
                        "√âteint le feu automatiquement"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ],
            [
                {
                    "type": "sequence",
                    "title": "Fonctionnement SSI",
                    "question": "Remettez dans l'ordre les √©tapes du fonctionnement d'un SSI :",
                    "items": [
                        "D√©tection par un d√©tecteur",
                        "Transmission au tableau de signalisation",
                        "D√©clenchement de l'alarme",
                        "Mise en s√©curit√© (d√©senfumage, etc.)"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Proc√©dure d'Intervention",
                    "question": "Ordre d'intervention du SSIAP en cas d'alarme incendie :",
                    "items": [
                        "Lev√©e de doute",
                        "Alerte des secours si feu confirm√©",
                        "Mise en s√©curit√© des personnes",
                        "Premi√®re intervention si possible"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Installation Colonne S√®che",
                    "question": "Caract√©ristiques d'une colonne s√®che dans l'ordre croissant :",
                    "items": [
                        "Hauteur b√¢timent : entre 18m et 50m",
                        "Diam√®tre : DN 65 ou DN 100",
                        "Prises sur paliers tous les niveaux",
                        "Vidange en partie basse"
                    ],
                    "timeLimit": 70,
                    "points": 140
                },
                {
                    "type": "sequence",
                    "title": "V√©rification Extincteur",
                    "question": "√âtapes de v√©rification annuelle d'un extincteur :",
                    "items": [
                        "Contr√¥le visuel de l'√©tat g√©n√©ral",
                        "V√©rification de la pression/masse",
                        "Contr√¥le de l'accessibilit√©",
                        "Apposition de l'√©tiquette de contr√¥le"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "D√©clenchement Manuel",
                    "question": "√âtapes apr√®s l'activation d'un d√©clencheur manuel :",
                    "items": [
                        "Signal transmis au tableau de signalisation",
                        "Identification de la zone concern√©e",
                        "Lev√©e de doute par le SSIAP",
                        "D√©clenchement alarme √©vacuation si n√©cessaire"
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "Colonnes S√®ches et Humides",
                    "question": "Quelles affirmations sur les colonnes sont vraies ? (Plusieurs r√©ponses)",
                    "options": [
                        "Colonne s√®che : vide en temps normal",
                        "Colonne humide : toujours en eau",
                        "Colonne s√®che : b√¢timents 18m √† 50m",
                        "Colonne humide : b√¢timents > 50m",
                        "Alimentation par les pompiers"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 70,
                    "points": 160
                },
                {
                    "type": "quiz-multi",
                    "title": "RIA - Robinet d'Incendie Arm√©",
                    "question": "Caract√©ristiques d'un RIA ? (Plusieurs r√©ponses)",
                    "options": [
                        "DN 19 ou DN 25 ou DN 33",
                        "Longueur 20m ou 30m",
                        "Utilisable par toute personne form√©e",
                        "Efficace sur feux A et B",
                        "Contr√¥le annuel obligatoire"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        4
                    ],
                    "timeLimit": 70,
                    "points": 160
                },
                {
                    "type": "quiz-multi",
                    "title": "D√©tecteurs Incendie",
                    "question": "Quels types de d√©tecteurs automatiques existent ? (Plusieurs r√©ponses)",
                    "options": [
                        "D√©tecteur thermique",
                        "D√©tecteur de fum√©e optique",
                        "D√©tecteur de flamme",
                        "D√©tecteur de chaleur lin√©aire",
                        "D√©tecteur de monoxyde de carbone"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "√âclairage de S√©curit√©",
                    "question": "L'√©clairage de s√©curit√© comprend ? (Plusieurs r√©ponses)",
                    "options": [
                        "√âclairage d'√©vacuation",
                        "√âclairage d'ambiance ou anti-panique",
                        "√âclairage des locaux techniques",
                        "BAES (Bloc Autonome d'√âclairage de S√©curit√©)",
                        "LSC (Luminaire Sur Circuit)"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Portes Coupe-Feu",
                    "question": "Caract√©ristiques des portes coupe-feu ? (Plusieurs r√©ponses)",
                    "options": [
                        "Classement en temps : 1/4h, 1/2h, 1h, 2h",
                        "Fermeture automatique obligatoire",
                        "Ne jamais √™tre cal√©es ouvertes (sauf DAS)",
                        "Contr√¥le p√©riodique obligatoire",
                        "Peuvent √™tre vitr√©es (verre arm√©)"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 70,
                    "points": 160
                }
            ]
        ]
    },
    {
        "title": "Moyens de Secours",
        "subtitle": "Extincteurs et √©quipements",
        "icon": "üßØ",
        "color": "from-green-500 to-blue-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Types d'Extincteurs",
                    "question": "Quel extincteur utiliser sur un feu d'origine √©lectrique ?",
                    "options": [
                        "Extincteur CO2",
                        "Extincteur √† eau",
                        "Extincteur √† mousse",
                        "Extincteur √† eau pulv√©ris√©e"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Extincteur √† Poudre",
                    "question": "L'extincteur √† poudre ABC est efficace sur :",
                    "options": [
                        "Feux de classe A, B et C",
                        "Uniquement feux de classe A",
                        "Uniquement feux de classe B",
                        "Feux de classe D uniquement"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Distance d'Utilisation",
                    "question": "√Ä quelle distance doit-on se placer pour utiliser un extincteur ?",
                    "options": [
                        "2 √† 3 m√®tres du foyer",
                        "Le plus pr√®s possible",
                        "5 √† 10 m√®tres minimum",
                        "10 m√®tres minimum"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Implantation Extincteurs",
                    "question": "Quelle est la distance maximale √† parcourir pour atteindre un extincteur ?",
                    "options": [
                        "15 m√®tres maximum",
                        "30 m√®tres maximum",
                        "10 m√®tres maximum",
                        "20 m√®tres maximum"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Capacit√© Extincteur",
                    "question": "Quelle est la capacit√© minimale d'un extincteur portatif ?",
                    "options": [
                        "6 litres ou 6 kg",
                        "3 litres ou 3 kg",
                        "9 litres ou 9 kg",
                        "12 litres ou 12 kg"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Contr√¥le Extincteur",
                    "question": "√Ä quelle fr√©quence les extincteurs doivent-ils √™tre v√©rifi√©s ?",
                    "options": [
                        "Annuellement",
                        "Tous les 6 mois",
                        "Tous les 2 ans",
                        "Tous les 3 ans"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 35,
                    "points": 100
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Agents Extincteurs",
                    "question": "Associez chaque agent extincteur avec son action principale :",
                    "pairs": [
                        {
                            "left": "Eau",
                            "right": "Refroidissement"
                        },
                        {
                            "left": "Mousse",
                            "right": "√âtouffement par isolement"
                        },
                        {
                            "left": "CO2",
                            "right": "√âtouffement par dilution O2"
                        },
                        {
                            "left": "Poudre",
                            "right": "Inhibition de la r√©action"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Pictogrammes Extincteurs",
                    "question": "Associez la couleur avec le type d'agent extincteur :",
                    "pairs": [
                        {
                            "left": "Rouge",
                            "right": "Eau/Eau pulv√©ris√©e"
                        },
                        {
                            "left": "Cr√®me/Beige",
                            "right": "Mousse"
                        },
                        {
                            "left": "Bleu",
                            "right": "Poudre"
                        },
                        {
                            "left": "Noir",
                            "right": "CO2"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Efficacit√© par Classe",
                    "question": "Associez l'extincteur avec les classes de feu efficaces :",
                    "pairs": [
                        {
                            "left": "Eau pulv√©ris√©e + additif",
                            "right": "A et B"
                        },
                        {
                            "left": "Poudre ABC",
                            "right": "A, B et C"
                        },
                        {
                            "left": "CO2",
                            "right": "B et feux √©lectriques"
                        },
                        {
                            "left": "Poudre sp√©ciale",
                            "right": "Classe D (m√©taux)"
                        }
                    ],
                    "timeLimit": 70,
                    "points": 140
                },
                {
                    "type": "matching",
                    "title": "Avantages/Inconv√©nients",
                    "question": "Associez l'extincteur avec son principal inconv√©nient :",
                    "pairs": [
                        {
                            "left": "CO2",
                            "right": "Asphyxie en local ferm√©"
                        },
                        {
                            "left": "Poudre",
                            "right": "R√©duit la visibilit√©"
                        },
                        {
                            "left": "Eau",
                            "right": "Conducteur d'√©lectricit√©"
                        },
                        {
                            "left": "Mousse",
                            "right": "Salissant, d√©g√¢ts collat√©raux"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "RIA - Caract√©ristiques",
                    "question": "Associez le diam√®tre RIA avec son usage :",
                    "pairs": [
                        {
                            "left": "DN 19",
                            "right": "Usage courant, 1 personne"
                        },
                        {
                            "left": "DN 25",
                            "right": "Usage standard"
                        },
                        {
                            "left": "DN 33",
                            "right": "Gros d√©bits, 2 personnes"
                        },
                        {
                            "left": "RIA > DN 19",
                            "right": "Feux de classe A uniquement"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "sequence",
                    "title": "Utilisation Extincteur",
                    "question": "Remettez dans l'ordre les √©tapes d'utilisation d'un extincteur :",
                    "items": [
                        "Retirer la goupille de s√©curit√©",
                        "Se placer √† 2-3m du feu, dos au vent",
                        "Presser la poign√©e ou percuter",
                        "Diriger le jet √† la base des flammes"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Technique d'Extinction",
                    "question": "Ordre des actions pour √©teindre un feu avec un extincteur :",
                    "items": [
                        "Attaquer le feu par le bas",
                        "Balayer la base des flammes",
                        "Progresser au fur et √† mesure",
                        "Surveiller les reprises de feu"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Feu de Liquide",
                    "question": "Proc√©dure d'extinction d'un feu de liquide inflammable :",
                    "items": [
                        "Couper l'arriv√©e de combustible si possible",
                        "Se prot√©ger des vapeurs",
                        "Attaquer en formant un √©cran (mousse/poudre)",
                        "Couvrir toute la surface du liquide"
                    ],
                    "timeLimit": 70,
                    "points": 140
                },
                {
                    "type": "sequence",
                    "title": "Intervention SSIAP",
                    "question": "Actions du SSIAP lors d'un d√©part de feu :",
                    "items": [
                        "Donner l'alerte",
                        "Mettre en s√©curit√© les personnes",
                        "Utiliser l'extincteur adapt√© si possible",
                        "Attendre les secours si feu trop important"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Contr√¥le Extincteur",
                    "question": "V√©rifications lors du contr√¥le mensuel d'un extincteur :",
                    "items": [
                        "Accessibilit√© et signalisation",
                        "Pr√©sence de la goupille",
                        "Pression dans la zone verte (ou masse conforme)",
                        "Absence de d√©gradation visible"
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ]
        ]
    },
    {
        "title": "R√¥le du SSIAP",
        "subtitle": "Missions et responsabilit√©s",
        "icon": "üë®‚Äçüöí",
        "color": "from-blue-500 to-indigo-600",
        "games": [
            [
                {
                    "type": "quiz-multi",
                    "title": "Missions SSIAP 1",
                    "question": "Quelles sont les missions principales du SSIAP 1 ? (Plusieurs r√©ponses)",
                    "options": [
                        "Surveillance des installations de s√©curit√©",
                        "Sensibilisation du personnel",
                        "Premi√®re intervention incendie",
                        "Gestion du PC s√©curit√©",
                        "Assistance aux personnes"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        4
                    ],
                    "timeLimit": 70,
                    "points": 160
                },
                {
                    "type": "quiz-multi",
                    "title": "Rondes de S√©curit√©",
                    "question": "Que doit v√©rifier le SSIAP lors de ses rondes ? (Plusieurs r√©ponses)",
                    "options": [
                        "Fermeture des portes coupe-feu",
                        "Accessibilit√© des extincteurs et RIA",
                        "D√©sencombrement des d√©gagements",
                        "√âtat des issues de secours",
                        "Temp√©rature ambiante"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 70,
                    "points": 160
                },
                {
                    "type": "quiz-multi",
                    "title": "Permis de Feu",
                    "question": "Le permis de feu est obligatoire pour : (Plusieurs r√©ponses)",
                    "options": [
                        "Travaux par points chauds (soudure, meulage)",
                        "Travaux de peinture",
                        "Travaux dans zones √† risque d'incendie",
                        "Pr√©sence ERP en activit√©",
                        "Nettoyage des locaux"
                    ],
                    "correctAnswers": [
                        0,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Poste de S√©curit√©",
                    "question": "Le poste de s√©curit√© doit comporter : (Plusieurs r√©ponses)",
                    "options": [
                        "Tableau de signalisation incendie",
                        "T√©l√©phone urbain",
                        "Plans de l'√©tablissement",
                        "Moyens d'extinction",
                        "Registre de s√©curit√©"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        4
                    ],
                    "timeLimit": 70,
                    "points": 160
                },
                {
                    "type": "quiz-multi",
                    "title": "Main Courante",
                    "question": "Que doit-on noter sur la main courante ? (Plusieurs r√©ponses)",
                    "options": [
                        "Rondes effectu√©es",
                        "Anomalies constat√©es",
                        "Interventions r√©alis√©es",
                        "Tous les appels t√©l√©phoniques",
                        "Visites de commissions de s√©curit√©"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        4
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Obligations SSIAP",
                    "question": "Le SSIAP peut quitter son poste sans autorisation en cas d'urgence personnelle.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - Le SSIAP ne peut quitter son poste qu'avec autorisation. La continuit√© de service est obligatoire.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Recyclage SSIAP",
                    "question": "Le recyclage SSIAP 1 doit √™tre effectu√© tous les 3 ans.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le recyclage SSIAP 1 est obligatoire tous les 3 ans (21h de formation).",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Carte Professionnelle",
                    "question": "La carte professionnelle SSIAP est valable √† vie.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - La carte professionnelle SSIAP doit √™tre renouvel√©e tous les 3 ans apr√®s recyclage.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "R√¥le SSIAP",
                    "question": "Le SSIAP peut refuser l'acc√®s aux sapeurs-pompiers.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - Le SSIAP doit faciliter l'acc√®s et guider les sapeurs-pompiers dans l'√©tablissement.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "SSIAP et Public",
                    "question": "Le SSIAP doit pouvoir expliquer les consignes de s√©curit√© au public.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La sensibilisation et l'information du personnel et du public font partie des missions du SSIAP.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Formations",
                    "question": "Le SSIAP peut former le personnel √† la manipulation des extincteurs.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le SSIAP participe √† la sensibilisation et √† la formation du personnel aux consignes de s√©curit√©.",
                    "timeLimit": 30,
                    "points": 80
                }
            ],
            [
                {
                    "type": "quiz",
                    "title": "Responsabilit√©",
                    "question": "Qui est responsable de la s√©curit√© incendie dans un ERP ?",
                    "options": [
                        "Le chef d'√©tablissement",
                        "Le SSIAP",
                        "Le maire",
                        "Les sapeurs-pompiers"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Registre de S√©curit√©",
                    "question": "Qui tient le registre de s√©curit√© ?",
                    "options": [
                        "Le chef d'√©tablissement",
                        "Le SSIAP uniquement",
                        "Les sapeurs-pompiers",
                        "La commission de s√©curit√©"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Exercices d'√âvacuation",
                    "question": "Quelle est la fr√©quence minimale des exercices d'√©vacuation en ERP ?",
                    "options": [
                        "2 fois par an (tous les 6 mois)",
                        "1 fois par an",
                        "4 fois par an",
                        "1 fois tous les 2 ans"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Consignes de S√©curit√©",
                    "question": "O√π doivent √™tre affich√©es les consignes de s√©curit√© ?",
                    "options": [
                        "√Ä chaque niveau, de mani√®re visible",
                        "Uniquement au poste de s√©curit√©",
                        "Uniquement √† l'entr√©e",
                        "Uniquement dans les bureaux"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Visite de Commission",
                    "question": "Qui demande la visite p√©riodique de la commission de s√©curit√© ?",
                    "options": [
                        "Le chef d'√©tablissement",
                        "Le SSIAP",
                        "Le maire",
                        "Les sapeurs-pompiers"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Effectifs",
                    "question": "Qui calcule l'effectif du public admissible dans l'ERP ?",
                    "options": [
                        "Le chef d'√©tablissement avec la commission",
                        "Le SSIAP uniquement",
                        "Le maire",
                        "Les pompiers"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ]
        ]
    },
    {
        "title": "√âvacuation",
        "subtitle": "D√©gagements et signalisation",
        "icon": "üö™",
        "color": "from-indigo-500 to-purple-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Unit√© de Passage",
                    "question": "Quelle est la largeur d'une unit√© de passage (UP) ?",
                    "options": [
                        "0,60 m",
                        "0,90 m",
                        "1,20 m",
                        "0,80 m"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Nombre de Sorties",
                    "question": "Combien de sorties minimum si l'effectif d√©passe 50 personnes ?",
                    "options": [
                        "2 sorties",
                        "1 sortie",
                        "3 sorties",
                        "4 sorties"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 35,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Sens d'Ouverture",
                    "question": "Dans quel sens doivent ouvrir les portes si effectif > 50 personnes ?",
                    "options": [
                        "Dans le sens de l'√©vacuation",
                        "Dans le sens inverse de l'√©vacuation",
                        "Les deux sens possibles",
                        "Coulissantes uniquement"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Distance Parcours",
                    "question": "Quelle est la distance maximale √† parcourir vers une sortie en ERP (cas g√©n√©ral) ?",
                    "options": [
                        "50 m√®tres maximum",
                        "30 m√®tres maximum",
                        "100 m√®tres maximum",
                        "25 m√®tres maximum"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Barre Anti-panique",
                    "question": "√Ä partir de quel effectif les portes doivent-elles √™tre √©quip√©es de barres anti-panique ?",
                    "options": [
                        "100 personnes",
                        "50 personnes",
                        "200 personnes",
                        "Toujours obligatoire"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Largeur Minimale",
                    "question": "Quelle est la largeur minimale d'un d√©gagement ?",
                    "options": [
                        "0,90 m (1 UP minimum)",
                        "0,60 m",
                        "1,20 m",
                        "1,40 m"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Panneaux de S√©curit√©",
                    "question": "Associez chaque panneau avec sa signification :",
                    "pairs": [
                        {
                            "left": "Vert + pictogramme",
                            "right": "Issue de secours / √âvacuation"
                        },
                        {
                            "left": "Rouge + pictogramme",
                            "right": "Mat√©riel incendie"
                        },
                        {
                            "left": "Jaune triangle",
                            "right": "Danger / Avertissement"
                        },
                        {
                            "left": "Bleu rond",
                            "right": "Obligation"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Signalisation √âvacuation",
                    "question": "Associez les pictogrammes avec leur signification :",
                    "pairs": [
                        {
                            "left": "Homme qui court + fl√®che",
                            "right": "Sortie de secours"
                        },
                        {
                            "left": "Escalier + fl√®che",
                            "right": "Direction escalier secours"
                        },
                        {
                            "left": "Porte + fl√®che",
                            "right": "Issue de secours"
                        },
                        {
                            "left": "Point de rassemblement",
                            "right": "Zone de regroupement"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Panneaux Mat√©riel",
                    "question": "Associez le panneau avec le mat√©riel :",
                    "pairs": [
                        {
                            "left": "Carr√© rouge + extincteur",
                            "right": "Emplacement extincteur"
                        },
                        {
                            "left": "Carr√© rouge + t√©l√©phone",
                            "right": "T√©l√©phone d'urgence"
                        },
                        {
                            "left": "Carr√© rouge + lance",
                            "right": "RIA / Robinet incendie"
                        },
                        {
                            "left": "Carr√© rouge + bouton",
                            "right": "D√©clencheur manuel"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Couleurs S√©curit√©",
                    "question": "Associez la couleur avec sa signification :",
                    "pairs": [
                        {
                            "left": "Vert",
                            "right": "Sauvetage / Secours"
                        },
                        {
                            "left": "Rouge",
                            "right": "Incendie / Interdiction"
                        },
                        {
                            "left": "Jaune/Orange",
                            "right": "Danger"
                        },
                        {
                            "left": "Bleu",
                            "right": "Obligation"
                        }
                    ],
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "matching",
                    "title": "Types de Portes",
                    "question": "Associez le type de porte avec sa fonction :",
                    "pairs": [
                        {
                            "left": "Porte coupe-feu",
                            "right": "R√©sistance au feu (CF)"
                        },
                        {
                            "left": "Porte pare-flammes",
                            "right": "√âtanch√©it√© flammes (PF)"
                        },
                        {
                            "left": "Porte issue de secours",
                            "right": "√âvacuation du public"
                        },
                        {
                            "left": "Porte avec ferme-porte",
                            "right": "Fermeture automatique"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Issues de Secours",
                    "question": "Les issues de secours peuvent √™tre condamn√©es apr√®s la fermeture de l'√©tablissement.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - Les issues de secours doivent TOUJOURS rester libres et accessibles, m√™me en dehors des heures d'ouverture.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "D√©gagements",
                    "question": "Les d√©gagements doivent √™tre maintenus libres en permanence.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Aucun obstacle ne doit encombrer les d√©gagements (cartons, chaises, etc.).",
                    "timeLimit": 25,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "√âclairage Secours",
                    "question": "L'√©clairage de s√©curit√© s'allume uniquement en cas de coupure √©lectrique.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - L'√©clairage de s√©curit√© prend le relais automatiquement en cas de d√©faillance de l'√©clairage normal.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Signalisation",
                    "question": "Les panneaux d'√©vacuation doivent √™tre lumineux ou √©clair√©s.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Pour √™tre visibles m√™me en cas de coupure √©lectrique (BAES ou √©clairage de s√©curit√©).",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Portes Secours",
                    "question": "On peut bloquer temporairement une porte de secours avec un cale-porte.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - INTERDIT ! Sauf si √©quip√©e d'un DAS (Dispositif Actionn√© de S√©curit√©) qui lib√®re la porte en cas d'alarme.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Point de Rassemblement",
                    "question": "Le point de rassemblement doit √™tre situ√© √† l'ext√©rieur, √©loign√© du b√¢timent.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Pour prot√©ger les personnes √©vacu√©es et faciliter l'intervention des secours.",
                    "timeLimit": 30,
                    "points": 80
                }
            ]
        ]
    },
    {
        "title": "Mise en Pratique",
        "subtitle": "Exercices et interventions",
        "icon": "üéØ",
        "color": "from-purple-500 to-pink-600",
        "games": [
            [
                {
                    "type": "sequence",
                    "title": "Proc√©dure d'Alarme",
                    "question": "Ordre des actions lors du d√©clenchement de l'alarme incendie :",
                    "items": [
                        "Lev√©e de doute par le SSIAP",
                        "Alerte pompiers si feu confirm√© (18/112)",
                        "D√©clenchement alarme √©vacuation",
                        "Guidage et assistance √† l'√©vacuation"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Premi√®re Intervention",
                    "question": "Proc√©dure de premi√®re intervention sur un d√©but de feu :",
                    "items": [
                        "Donner l'alerte",
                        "Mettre en s√©curit√© les personnes √† proximit√©",
                        "Prendre l'extincteur adapt√©",
                        "Attaquer le feu √† sa base"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Accueil Pompiers",
                    "question": "Actions lors de l'arriv√©e des sapeurs-pompiers :",
                    "items": [
                        "Les accueillir √† l'entr√©e",
                        "Leur remettre les cl√©s et plans",
                        "Les guider vers le sinistre",
                        "Se tenir √† leur disposition"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Ronde de S√©curit√©",
                    "question": "D√©roulement d'une ronde de s√©curit√© type :",
                    "items": [
                        "V√©rifier les d√©gagements libres",
                        "Contr√¥ler fermeture portes CF",
                        "V√©rifier accessibilit√© moyens de secours",
                        "Noter les anomalies sur main courante"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Travaux par Points Chauds",
                    "question": "Proc√©dure pour des travaux de soudure dans l'ERP :",
                    "items": [
                        "√âtablir un permis de feu",
                        "Prot√©ger la zone (b√¢che, extincteur)",
                        "Surveiller pendant les travaux",
                        "Ronde de s√©curit√© 1h apr√®s fin travaux"
                    ],
                    "timeLimit": 70,
                    "points": 140
                }
            ],
            [
                {
                    "type": "quiz",
                    "title": "D√©tecteur D√©clench√©",
                    "question": "Un d√©tecteur se d√©clenche dans une zone inoccup√©e. Que faites-vous en premier ?",
                    "options": [
                        "Lev√©e de doute imm√©diate sur place",
                        "Appeler les pompiers",
                        "D√©clencher l'alarme √©vacuation",
                        "R√©initialiser le d√©tecteur"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Feu de Poubelle",
                    "question": "Vous d√©couvrez un feu de poubelle. Quel extincteur utilisez-vous ?",
                    "options": [
                        "Eau pulv√©ris√©e ou poudre ABC",
                        "CO2 uniquement",
                        "Mousse",
                        "Laisser br√ªler et appeler pompiers"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Fum√©e Sans Feu",
                    "question": "Vous constatez de la fum√©e mais pas de feu visible. Que faites-vous ?",
                    "options": [
                        "Donner l'alerte, √©vacuer la zone, attendre les pompiers",
                        "Ventiler la zone imm√©diatement",
                        "Chercher la source en ouvrant toutes les portes",
                        "Ne rien faire, c'est peut-√™tre rien"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "√âvacuation Difficile",
                    "question": "Une personne refuse d'√©vacuer lors de l'alarme. Que faites-vous ?",
                    "options": [
                        "Insister fermement, expliquer le danger, si refus noter et continuer",
                        "La forcer physiquement √† sortir",
                        "Rester avec elle",
                        "Appeler la police"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Porte CF Ouverte",
                    "question": "Vous trouvez une porte coupe-feu maintenue ouverte par un carton. Que faites-vous ?",
                    "options": [
                        "Retirer le carton, fermer la porte, noter sur main courante",
                        "Laisser comme √ßa, ce n'est pas grave",
                        "Pr√©venir uniquement le chef d'√©tablissement",
                        "Attendre la prochaine ronde"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Panne √âlectrique",
                    "question": "Coupure √©lectrique g√©n√©rale dans l'ERP. Premi√®re action ?",
                    "options": [
                        "V√©rifier que l'√©clairage de s√©curit√© fonctionne",
                        "Appeler les pompiers",
                        "√âvacuer imm√©diatement",
                        "Attendre le retour du courant"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Alerte Pompiers",
                    "question": "On doit toujours faire une lev√©e de doute AVANT d'appeler les pompiers.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Pour limiter les d√©rangements inutiles, sauf si impossibilit√© d'acc√®s √† la zone (auquel cas on alerte par pr√©caution).",
                    "timeLimit": 35,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Ascenseurs",
                    "question": "En cas d'alarme incendie, on doit utiliser les ascenseurs pour √©vacuer plus vite.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - INTERDIT ! Les ascenseurs peuvent tomber en panne ou s'arr√™ter √† l'√©tage en feu. Utiliser les escaliers.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Fum√©e Dense",
                    "question": "En cas de fum√©e dense, il faut ramper au sol pour √©vacuer.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - L'air respirable est au niveau du sol. Les fum√©es et gaz chauds montent.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Porte Chaude",
                    "question": "Si une porte est chaude au toucher, il faut l'ouvrir pour v√©rifier.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - NE JAMAIS ouvrir une porte chaude ! Le feu est derri√®re. Risque de backdraft (explosion de fum√©es).",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Feu √âlectrique",
                    "question": "Sur un feu d'origine √©lectrique, il faut d'abord couper le courant si possible.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Couper l'alimentation √©lectrique supprime la source d'√©nergie et √©vite les risques d'√©lectrocution.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Point de Rassemblement",
                    "question": "Apr√®s √©vacuation, chacun peut rentrer chez soi directement.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - Tout le monde doit se rendre au point de rassemblement pour permettre le comptage et s'assurer que personne ne manque.",
                    "timeLimit": 35,
                    "points": 80
                }
            ]
        ]
    },
    {
        "title": "Synth√®se",
        "subtitle": "Documents et r√©glementation",
        "icon": "üìö",
        "color": "from-pink-500 to-red-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Registre de S√©curit√©",
                    "question": "Que contient le registre de s√©curit√© ?",
                    "options": [
                        "Contr√¥les p√©riodiques, v√©rifications, consignes, PV de commission",
                        "Uniquement les coordonn√©es des pompiers",
                        "La liste du personnel",
                        "Les horaires d'ouverture"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Arr√™t√© du 25 juin 1980",
                    "question": "L'arr√™t√© du 25 juin 1980 concerne :",
                    "options": [
                        "La s√©curit√© incendie dans les ERP",
                        "Le Code du Travail",
                        "Les IGH uniquement",
                        "Les habitations"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Arr√™t√© du 2 mai 2005",
                    "question": "L'arr√™t√© du 2 mai 2005 concerne :",
                    "options": [
                        "La formation SSIAP",
                        "Les ERP",
                        "Les IGH",
                        "Le Code du Travail"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Commission de S√©curit√©",
                    "question": "Quelle est la p√©riodicit√© des visites de commission en ERP de 1√®re cat√©gorie ?",
                    "options": [
                        "Annuelle",
                        "Tous les 2 ans",
                        "Tous les 3 ans",
                        "Tous les 5 ans"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Plan d'√âvacuation",
                    "question": "Que doit comporter un plan d'√©vacuation ?",
                    "options": [
                        "Point de rassemblement, issues, cheminements, vous √™tes ici",
                        "Uniquement les sorties",
                        "Uniquement les extincteurs",
                        "La liste du personnel"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Consignes G√©n√©rales",
                    "question": "Les consignes g√©n√©rales de s√©curit√© doivent √™tre affich√©es :",
                    "options": [
                        "De mani√®re visible √† chaque niveau",
                        "Uniquement √† l'entr√©e",
                        "Uniquement au PC s√©curit√©",
                        "Uniquement dans les bureaux"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Textes R√©glementaires",
                    "question": "Associez chaque texte avec son domaine :",
                    "pairs": [
                        {
                            "left": "Arr√™t√© 25 juin 1980",
                            "right": "S√©curit√© incendie ERP"
                        },
                        {
                            "left": "Arr√™t√© 2 mai 2005",
                            "right": "Formation SSIAP"
                        },
                        {
                            "left": "Code du Travail",
                            "right": "S√©curit√© des travailleurs"
                        },
                        {
                            "left": "R√®glement de s√©curit√©",
                            "right": "Dispositions techniques ERP"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Documents Obligatoires",
                    "question": "Associez le document avec son contenu :",
                    "pairs": [
                        {
                            "left": "Registre de s√©curit√©",
                            "right": "V√©rifications et contr√¥les"
                        },
                        {
                            "left": "Notice de s√©curit√©",
                            "right": "Description des mesures de s√©curit√©"
                        },
                        {
                            "left": "Consignes",
                            "right": "Conduite √† tenir en cas d'incendie"
                        },
                        {
                            "left": "Proc√®s-verbal",
                            "right": "Avis de la commission de s√©curit√©"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Responsabilit√©s",
                    "question": "Associez l'acteur avec sa responsabilit√© :",
                    "pairs": [
                        {
                            "left": "Chef d'√©tablissement",
                            "right": "Responsable de la s√©curit√©"
                        },
                        {
                            "left": "Maire",
                            "right": "Pouvoir de police, autorisations"
                        },
                        {
                            "left": "SSIAP",
                            "right": "Surveillance et pr√©vention"
                        },
                        {
                            "left": "Commission",
                            "right": "Avis technique s√©curit√©"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Contr√¥les P√©riodiques",
                    "question": "Associez l'√©quipement avec sa fr√©quence de contr√¥le :",
                    "pairs": [
                        {
                            "left": "Extincteurs",
                            "right": "Annuel"
                        },
                        {
                            "left": "SSI",
                            "right": "Annuel"
                        },
                        {
                            "left": "D√©senfumage",
                            "right": "Annuel"
                        },
                        {
                            "left": "√âclairage s√©curit√©",
                            "right": "Mensuel (autonomie)"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Types d'ERP",
                    "question": "Associez la lettre avec le type d'ERP :",
                    "pairs": [
                        {
                            "left": "Type L",
                            "right": "Salles de spectacle"
                        },
                        {
                            "left": "Type M",
                            "right": "Magasins de vente"
                        },
                        {
                            "left": "Type N",
                            "right": "Restaurants"
                        },
                        {
                            "left": "Type O",
                            "right": "H√¥tels"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "R√©visions SSIAP",
                    "question": "Quels sont les r√¥les du SSIAP en ERP ? (Plusieurs r√©ponses)",
                    "options": [
                        "Pr√©vention incendie",
                        "Sensibilisation du personnel",
                        "Premi√®re intervention",
                        "Direction de l'√©tablissement",
                        "Accueil des secours"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        4
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Principes G√©n√©raux",
                    "question": "Quels sont les principes de base de la s√©curit√© incendie ? (Plusieurs r√©ponses)",
                    "options": [
                        "√âviter la naissance du feu",
                        "Limiter la propagation",
                        "√âvacuer rapidement",
                        "Maximiser les profits",
                        "Faciliter l'intervention des secours"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        4
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "V√©rifications Quotidiennes",
                    "question": "Que doit v√©rifier le SSIAP quotidiennement ? (Plusieurs r√©ponses)",
                    "options": [
                        "Accessibilit√© des issues",
                        "Fonctionnement du SSI",
                        "D√©gagements libres",
                        "Comptabilit√© de l'√©tablissement",
                        "Fermeture des portes CF"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        4
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "En Cas d'Incendie",
                    "question": "Actions prioritaires en cas de d√©couverte d'un feu ? (Plusieurs r√©ponses)",
                    "options": [
                        "Donner l'alerte",
                        "Sauver les personnes en danger imm√©diat",
                        "Tenter une premi√®re intervention si possible",
                        "Filmer la sc√®ne",
                        "Guider les secours"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        4
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "√âquipements de S√©curit√©",
                    "question": "Quels √©quipements font partie du SSI ? (Plusieurs r√©ponses)",
                    "options": [
                        "D√©tecteurs automatiques",
                        "D√©clencheurs manuels",
                        "Centrale d'alarme",
                        "Extincteurs",
                        "Dispositifs de mise en s√©curit√©"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        4
                    ],
                    "timeLimit": 70,
                    "points": 160
                }
            ]
        ]
    }
],
    2: [
    {
        "title": "Chef d'√âquipe",
        "subtitle": "R√¥le et missions SSIAP 2",
        "icon": "üë®‚Äç‚úàÔ∏è",
        "color": "from-red-500 to-orange-700",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Missions SSIAP 2",
                    "question": "Quelle est la mission principale du chef d'√©quipe SSIAP 2 ?",
                    "options": [
                        "Encadrer et former l'√©quipe de s√©curit√© incendie",
                        "Remplacer le directeur de l'√©tablissement",
                        "G√©rer uniquement les exercices d'√©vacuation",
                        "Contr√¥ler les acc√®s du public"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Hi√©rarchie",
                    "question": "Le chef d'√©quipe SSIAP 2 est plac√© sous l'autorit√© :",
                    "options": [
                        "Du chef de service de s√©curit√© incendie (SSIAP 3)",
                        "Du maire",
                        "Des sapeurs-pompiers",
                        "Du chef d'√©tablissement directement"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Formation Continue",
                    "question": "Le chef d'√©quipe doit assurer la formation continue :",
                    "options": [
                        "Des agents de s√©curit√© incendie (SSIAP 1)",
                        "Des sapeurs-pompiers",
                        "Du public",
                        "De la direction uniquement"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Gestion d'√âquipe",
                    "question": "Le chef d'√©quipe peut manager combien d'agents SSIAP 1 maximum ?",
                    "options": [
                        "Jusqu'√† 3 agents par √©quipe",
                        "Pas de limite",
                        "1 agent uniquement",
                        "10 agents"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Responsabilit√©s",
                    "question": "En l'absence du SSIAP 3, qui assure la continuit√© du service ?",
                    "options": [
                        "Le chef d'√©quipe SSIAP 2",
                        "Le SSIAP 1 le plus ancien",
                        "Le chef d'√©tablissement",
                        "Les sapeurs-pompiers"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Planning",
                    "question": "Qui √©tablit les plannings des rondes et des √©quipes ?",
                    "options": [
                        "Le chef d'√©quipe SSIAP 2",
                        "Chaque agent SSIAP 1",
                        "Le chef d'√©tablissement",
                        "La commission de s√©curit√©"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "Attributions SSIAP 2",
                    "question": "Quelles sont les attributions du chef d'√©quipe ? (Plusieurs r√©ponses)",
                    "options": [
                        "Management de l'√©quipe de s√©curit√©",
                        "Formation et recyclage des agents",
                        "Gestion du PC s√©curit√© en situation de crise",
                        "R√©daction des rapports d'intervention",
                        "Recrutement du personnel"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "T√¢ches Quotidiennes",
                    "question": "Quelles t√¢ches quotidiennes incombent au chef d'√©quipe ? (Plusieurs r√©ponses)",
                    "options": [
                        "Contr√¥le des rondes effectu√©es",
                        "V√©rification de la main courante",
                        "Briefing de l'√©quipe",
                        "Organisation des exercices",
                        "Paiement des salaires"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Comp√©tences Requises",
                    "question": "Quelles comp√©tences sont attendues d'un SSIAP 2 ? (Plusieurs r√©ponses)",
                    "options": [
                        "Leadership et management d'√©quipe",
                        "Ma√Ætrise du SSI",
                        "Gestion de crise",
                        "P√©dagogie et formation",
                        "Comptabilit√©"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Relations Externes",
                    "question": "Le chef d'√©quipe est en relation avec : (Plusieurs r√©ponses)",
                    "options": [
                        "La commission de s√©curit√©",
                        "Les sapeurs-pompiers",
                        "Le bureau de contr√¥le",
                        "Les entreprises ext√©rieures",
                        "Les fournisseurs de mat√©riel bureautique"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Documents √† G√©rer",
                    "question": "Quels documents le chef d'√©quipe doit-il g√©rer ? (Plusieurs r√©ponses)",
                    "options": [
                        "Main courante du PC s√©curit√©",
                        "Registre de s√©curit√©",
                        "Rapports d'intervention",
                        "Planning des √©quipes",
                        "Factures d'√©lectricit√©"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "PC S√©curit√©",
                    "question": "Le chef d'√©quipe est responsable du bon fonctionnement du poste central de s√©curit√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le chef d'√©quipe est responsable du PC s√©curit√© et de son bon fonctionnement.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Formation",
                    "question": "Le chef d'√©quipe peut former les agents SSIAP 1 de son √©quipe.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le SSIAP 2 assure la formation continue et le recyclage des SSIAP 1.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Exercices",
                    "question": "Le chef d'√©quipe organise et supervise les exercices d'√©vacuation.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - L'organisation et la supervision des exercices font partie de ses missions.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Autonomie",
                    "question": "Le chef d'√©quipe peut prendre des d√©cisions en autonomie lors d'une crise.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - En situation de crise, il doit pouvoir prendre des d√©cisions rapides pour assurer la s√©curit√©.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Contr√¥le",
                    "question": "Le chef d'√©quipe contr√¥le la tenue et le comportement des agents de s√©curit√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le contr√¥le de l'√©quipe (tenue, comportement, respect des consignes) fait partie de ses responsabilit√©s.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "√âquipements",
                    "question": "Le chef d'√©quipe s'assure du bon √©tat et de la disponibilit√© des √©quipements de s√©curit√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Il doit contr√¥ler r√©guli√®rement l'√©tat des √©quipements (extincteurs, RIA, SSI, etc.).",
                    "timeLimit": 30,
                    "points": 80
                }
            ]
        ]
    },
    {
        "title": "Manipulation SSI",
        "subtitle": "Syst√®me de s√©curit√© incendie",
        "icon": "üñ•Ô∏è",
        "color": "from-orange-500 to-yellow-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Centrale SSI",
                    "question": "Que signifie CMSI ?",
                    "options": [
                        "Centralisateur de Mise en S√©curit√© Incendie",
                        "Centre de Maintien du Syst√®me Incendie",
                        "Commande Manuelle du Syst√®me d'Incendie",
                        "Central de Mesure de S√©curit√© Int√©rieure"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "ECS",
                    "question": "Que signifie ECS dans le cadre du SSI ?",
                    "options": [
                        "√âquipement de Contr√¥le et de Signalisation",
                        "Extincteur de Classe Sp√©ciale",
                        "√âvacuation et Contr√¥le de S√©curit√©",
                        "√ânergie de Coupure S√©curis√©e"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "DAS",
                    "question": "Que signifie DAS ?",
                    "options": [
                        "Dispositif Actionn√© de S√©curit√©",
                        "D√©tecteur Automatique de S√©curit√©",
                        "D√©clencheur d'Alarme Sp√©ciale",
                        "Dispositif d'Alerte Sonore"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Fonctions CMSI",
                    "question": "Quelle fonction n'est PAS assur√©e par un CMSI ?",
                    "options": [
                        "Extinction automatique",
                        "Mise en s√©curit√© des ascenseurs",
                        "D√©clenchement de l'alarme",
                        "Commande du d√©senfumage"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Zones de D√©tection",
                    "question": "La surface maximale d'une zone de d√©tection est de :",
                    "options": [
                        "1600 m¬≤",
                        "1000 m¬≤",
                        "2000 m¬≤",
                        "500 m¬≤"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Alarme",
                    "question": "Combien y a-t-il de types d'alarme en ERP ?",
                    "options": [
                        "5 types (1, 2a, 2b, 3, 4)",
                        "3 types",
                        "2 types",
                        "4 types"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "sequence",
                    "title": "Mise en ≈íuvre SSI",
                    "question": "Ordre des actions lors de la mise en ≈ìuvre du SSI :",
                    "items": [
                        "D√©tection du sinistre",
                        "Localisation sur la centrale",
                        "Lev√©e de doute",
                        "D√©clenchement alarme et mise en s√©curit√©"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "D√©faut SSI",
                    "question": "Proc√©dure en cas de d√©faut sur le SSI :",
                    "items": [
                        "Identifier le d√©faut sur la centrale",
                        "Noter sur la main courante",
                        "Pr√©venir le responsable technique",
                        "Faire intervenir la maintenance"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Compartimentage",
                    "question": "Ordre de mise en s√©curit√© en cas d'incendie :",
                    "items": [
                        "Fermeture des portes coupe-feu (DAS)",
                        "Arr√™t de la ventilation",
                        "D√©senfumage des circulations",
                        "Rappel des ascenseurs"
                    ],
                    "timeLimit": 70,
                    "points": 140
                },
                {
                    "type": "sequence",
                    "title": "Test SSI",
                    "question": "√âtapes du test hebdomadaire du SSI :",
                    "items": [
                        "V√©rifier l'alimentation √©lectrique",
                        "Tester un d√©clencheur manuel",
                        "Contr√¥ler la diffusion de l'alarme",
                        "Noter le test sur la main courante"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "R√©armement",
                    "question": "Proc√©dure de r√©armement apr√®s alarme :",
                    "items": [
                        "S'assurer de la disparition du sinistre",
                        "Acquitter l'alarme sur la centrale",
                        "R√©armer les DAS (portes, etc.)",
                        "Remettre le syst√®me en surveillance"
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Composants SSI",
                    "question": "Associez chaque composant √† sa fonction :",
                    "pairs": [
                        {
                            "left": "CMSI",
                            "right": "Gestion des mises en s√©curit√©"
                        },
                        {
                            "left": "DM (D√©clencheur Manuel)",
                            "right": "D√©clenchement manuel alarme"
                        },
                        {
                            "left": "DAI (D√©tecteur Auto)",
                            "right": "D√©tection automatique"
                        },
                        {
                            "left": "DAS",
                            "right": "Fermeture portes CF"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Cat√©gories SSI",
                    "question": "Associez la cat√©gorie SSI avec ses caract√©ristiques :",
                    "pairs": [
                        {
                            "left": "Cat√©gorie A",
                            "right": "Syst√®me complet avec CMSI"
                        },
                        {
                            "left": "Cat√©gorie B",
                            "right": "SDI + alarme type 1"
                        },
                        {
                            "left": "Cat√©gorie C",
                            "right": "SDI + alarme type 2"
                        },
                        {
                            "left": "Cat√©gorie D",
                            "right": "SDI + alarme type 3"
                        }
                    ],
                    "timeLimit": 70,
                    "points": 140
                },
                {
                    "type": "matching",
                    "title": "Types d'Alarme",
                    "question": "Associez le type d'alarme avec son mode de diffusion :",
                    "pairs": [
                        {
                            "left": "Type 1",
                            "right": "G√©n√©rale imm√©diate"
                        },
                        {
                            "left": "Type 2a",
                            "right": "G√©n√©rale avec temporisation"
                        },
                        {
                            "left": "Type 2b",
                            "right": "G√©n√©rale avec CMSI"
                        },
                        {
                            "left": "Type 3",
                            "right": "Deux zones s√©par√©es"
                        }
                    ],
                    "timeLimit": 70,
                    "points": 140
                },
                {
                    "type": "matching",
                    "title": "D√©fauts SSI",
                    "question": "Associez le d√©faut avec son indication :",
                    "pairs": [
                        {
                            "left": "Voyant jaune",
                            "right": "D√©faut technique"
                        },
                        {
                            "left": "Voyant rouge",
                            "right": "Alarme feu"
                        },
                        {
                            "left": "Voyant vert",
                            "right": "Fonctionnement normal"
                        },
                        {
                            "left": "Sonnerie",
                            "right": "D√©faut alimentation"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "√âquipements Actionn√©s",
                    "question": "Associez l'√©quipement avec son action en cas d'incendie :",
                    "pairs": [
                        {
                            "left": "Portes CF",
                            "right": "Fermeture automatique"
                        },
                        {
                            "left": "Ascenseurs",
                            "right": "Mise √† niveau √©vacuation"
                        },
                        {
                            "left": "Ventilation",
                            "right": "Arr√™t"
                        },
                        {
                            "left": "Exutoires",
                            "right": "Ouverture"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ]
        ]
    },
    {
        "title": "Hygi√®ne & S√©curit√©",
        "subtitle": "S√©curit√© au travail",
        "icon": "ü¶∫",
        "color": "from-yellow-500 to-green-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Code du Travail",
                    "question": "Le chef d'√©quipe doit appliquer les r√®gles :",
                    "options": [
                        "Du Code du Travail et de la r√©glementation ERP",
                        "Uniquement du Code du Travail",
                        "Uniquement de la r√©glementation ERP",
                        "Du Code civil uniquement"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Document Unique",
                    "question": "Le Document Unique d'√âvaluation des Risques Professionnels (DUERP) doit √™tre :",
                    "options": [
                        "Mis √† jour au moins annuellement",
                        "Cr√©√© tous les 5 ans",
                        "Facultatif",
                        "R√©dig√© uniquement en cas d'accident"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "EPI",
                    "question": "Que signifie EPI ?",
                    "options": [
                        "√âquipement de Protection Individuelle",
                        "√âquipe de Pr√©vention Incendie",
                        "Exercice Pratique d'Intervention",
                        "Extinction Par Inhibition"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 35,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Accident du Travail",
                    "question": "En cas d'accident du travail, le chef d'√©quipe doit :",
                    "options": [
                        "Porter secours et d√©clarer l'accident dans les 48h",
                        "Ne rien faire, c'est la victime qui d√©clare",
                        "D√©clarer uniquement si c'est grave",
                        "Attendre 1 semaine avant de d√©clarer"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Travail en Hauteur",
                    "question": "Le port du harnais de s√©curit√© est obligatoire √† partir de :",
                    "options": [
                        "3 m√®tres de hauteur",
                        "5 m√®tres de hauteur",
                        "2 m√®tres de hauteur",
                        "10 m√®tres de hauteur"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Temps de Travail",
                    "question": "La dur√©e maximale quotidienne de travail est de :",
                    "options": [
                        "10 heures (12h exceptionnellement)",
                        "8 heures maximum",
                        "14 heures",
                        "Pas de limite"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Obligation Employeur",
                    "question": "L'employeur doit former le personnel aux risques professionnels.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La formation √† la s√©curit√© est une obligation de l'employeur (Code du Travail).",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "M√©decine du Travail",
                    "question": "Tout salari√© doit passer une visite m√©dicale d'embauche.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La visite m√©dicale d'embauche est obligatoire pour tous les salari√©s.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Droit de Retrait",
                    "question": "Un salari√© peut exercer son droit de retrait s'il estime √™tre en danger grave et imminent.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le droit de retrait permet au salari√© de se retirer d'une situation de travail dangereuse.",
                    "timeLimit": 35,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "EPI Gratuits",
                    "question": "Les EPI doivent √™tre fournis gratuitement par l'employeur.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - L'employeur doit fournir gratuitement les EPI n√©cessaires et adapt√©s.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Signalisation",
                    "question": "La signalisation de s√©curit√© est obligatoire dans tous les lieux de travail.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La signalisation doit indiquer les risques et les moyens de secours.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Registre Accidents",
                    "question": "L'employeur doit tenir un registre des accidents du travail.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le registre unique du personnel et le registre des accidents sont obligatoires.",
                    "timeLimit": 30,
                    "points": 80
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "Risques Professionnels",
                    "question": "Quels sont les principaux risques pour un agent de s√©curit√© ? (Plusieurs r√©ponses)",
                    "options": [
                        "Travail de nuit et post√©",
                        "Stress et agressivit√© du public",
                        "Risques li√©s aux rondes (chutes, etc.)",
                        "Exposition aux fum√©es en cas d'incendie",
                        "Risques financiers"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Mesures de Pr√©vention",
                    "question": "Quelles mesures de pr√©vention doit mettre en place le chef d'√©quipe ? (Plusieurs r√©ponses)",
                    "options": [
                        "Formation r√©guli√®re de l'√©quipe",
                        "V√©rification des EPI",
                        "Respect des temps de repos",
                        "Analyse des situations dangereuses",
                        "Augmentation des cadences"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "EPI Obligatoires",
                    "question": "Quels EPI peuvent √™tre n√©cessaires pour un agent SSIAP ? (Plusieurs r√©ponses)",
                    "options": [
                        "Chaussures de s√©curit√©",
                        "Gants pour manipulation",
                        "Casque en zone √† risque",
                        "Harnais pour travaux en hauteur",
                        "Maillot de bain"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Obligations R√©glementaires",
                    "question": "Quelles obligations s'appliquent aux locaux de travail ? (Plusieurs r√©ponses)",
                    "options": [
                        "A√©ration et ventilation",
                        "√âclairage suffisant",
                        "Temp√©rature adapt√©e (18¬∞C min. bureaux)",
                        "Sanitaires et vestiaires",
                        "Piscine olympique"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Acteurs Pr√©vention",
                    "question": "Qui sont les acteurs de la pr√©vention en entreprise ? (Plusieurs r√©ponses)",
                    "options": [
                        "Le chef d'√©tablissement",
                        "Le CSE (Comit√© Social et √âconomique)",
                        "Le m√©decin du travail",
                        "L'inspection du travail",
                        "Les clients"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ]
        ]
    },
    {
        "title": "Gestion de Crise",
        "subtitle": "Chef du PC s√©curit√©",
        "icon": "üö®",
        "color": "from-green-500 to-blue-600",
        "games": [
            [
                {
                    "type": "sequence",
                    "title": "D√©but d'Incendie",
                    "question": "Actions du chef d'√©quipe lors d'un d√©but d'incendie :",
                    "items": [
                        "R√©ceptionner l'alarme et localiser",
                        "Envoyer une √©quipe en lev√©e de doute",
                        "D√©clencher l'alarme √©vacuation si confirm√©",
                        "Alerter les secours (18/112)"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "√âvacuation",
                    "question": "Gestion d'une √©vacuation totale :",
                    "items": [
                        "D√©clenchement de l'alarme g√©n√©rale",
                        "Coordination des √©quipes d'√©vacuation",
                        "V√©rification de l'√©vacuation compl√®te",
                        "Compte-rendu au commandant des op√©rations"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Accueil Secours",
                    "question": "Accueil et guidage des sapeurs-pompiers :",
                    "items": [
                        "Attendre les secours au point de rassemblement",
                        "Informer le chef d'agr√®s de la situation",
                        "Remettre les plans et cl√©s",
                        "Guider vers le sinistre"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Communication Crise",
                    "question": "Communication lors d'une crise :",
                    "items": [
                        "Briefing de l'√©quipe de s√©curit√©",
                        "Information du chef d'√©tablissement",
                        "Coordination avec les secours",
                        "Communication au public si n√©cessaire"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Post-Incident",
                    "question": "Actions apr√®s l'intervention :",
                    "items": [
                        "D√©briefing avec l'√©quipe",
                        "R√©daction du rapport d'intervention",
                        "Remise en √©tat des lieux",
                        "Analyse et retour d'exp√©rience"
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "quiz",
                    "title": "Commandement",
                    "question": "En situation de crise, qui prend le commandement des op√©rations de secours ?",
                    "options": [
                        "Le commandant des sapeurs-pompiers",
                        "Le chef d'√©quipe SSIAP 2",
                        "Le chef d'√©tablissement",
                        "Le maire"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "R√¥le PC S√©curit√©",
                    "question": "Le PC s√©curit√© sert √† :",
                    "options": [
                        "Centraliser les informations et coordonner les actions",
                        "Stocker le mat√©riel",
                        "Recevoir le public",
                        "Faire des r√©unions"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Prise de D√©cision",
                    "question": "Le chef d'√©quipe doit prendre des d√©cisions :",
                    "options": [
                        "Rapidement en fonction de la situation",
                        "Apr√®s consultation de tous les agents",
                        "Uniquement avec l'accord du chef d'√©tablissement",
                        "En demandant l'avis du public"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Moyens de Communication",
                    "question": "Les moyens de communication du PC s√©curit√© sont :",
                    "options": [
                        "T√©l√©phone urbain, radio, interphone, SSI",
                        "Uniquement le t√©l√©phone",
                        "Uniquement la radio",
                        "Courrier postal"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Main Courante",
                    "question": "Pendant une crise, la main courante doit :",
                    "options": [
                        "√ätre tenue en temps r√©el avec toutes les actions",
                        "√ätre remplie le lendemain",
                        "Ne pas √™tre utilis√©e",
                        "√ätre remplie uniquement en cas d'accident"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Transmission Consignes",
                    "question": "Les consignes doivent √™tre transmises de mani√®re :",
                    "options": [
                        "Claire, pr√©cise et v√©rifiable",
                        "Vague pour laisser de l'autonomie",
                        "Uniquement √† l'oral",
                        "Par email"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Alarme Restreinte",
                    "question": "L'alarme restreinte est destin√©e √† avertir uniquement le personnel de s√©curit√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - L'alarme restreinte alerte le personnel de s√©curit√© avant l'alarme g√©n√©rale d'√©vacuation.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "√âvacuation Imm√©diate",
                    "question": "L'√©vacuation doit toujours √™tre imm√©diate d√®s la d√©tection d'un incendie.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - La lev√©e de doute doit √™tre effectu√©e avant de d√©clencher l'alarme g√©n√©rale (sauf alarme type 1).",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Plans d'Intervention",
                    "question": "Les plans d'intervention doivent √™tre disponibles au PC s√©curit√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Plans, cl√©s et informations doivent √™tre imm√©diatement disponibles pour les secours.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Autonomie",
                    "question": "Le chef d'√©quipe peut quitter le PC s√©curit√© pendant une intervention.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - Le PC s√©curit√© doit √™tre tenu en permanence pendant l'intervention pour assurer la coordination.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Rapport",
                    "question": "Un rapport √©crit doit √™tre √©tabli apr√®s chaque intervention des secours.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le rapport d'intervention est obligatoire et doit √™tre conserv√© dans le registre de s√©curit√©.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Coordination",
                    "question": "Le chef d'√©quipe coordonne l'action de son √©quipe avec celle des secours ext√©rieurs.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Il doit assurer la liaison entre son √©quipe et les sapeurs-pompiers.",
                    "timeLimit": 30,
                    "points": 80
                }
            ]
        ]
    },
    {
        "title": "Management",
        "subtitle": "Gestion et animation d'√©quipe",
        "icon": "üë•",
        "color": "from-blue-500 to-indigo-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Leadership",
                    "question": "Un bon leader se caract√©rise par :",
                    "options": [
                        "L'exemplarit√© et la capacit√© √† motiver",
                        "L'autoritarisme",
                        "La distance avec son √©quipe",
                        "L'absence de communication"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Communication",
                    "question": "La communication dans une √©quipe doit √™tre :",
                    "options": [
                        "Bidirectionnelle (√©coute et transmission)",
                        "Uniquement descendante (chef ‚Üí √©quipe)",
                        "Uniquement ascendante (√©quipe ‚Üí chef)",
                        "Inexistante pour √©viter les conflits"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Motivation",
                    "question": "Pour motiver son √©quipe, le chef d'√©quipe doit :",
                    "options": [
                        "Reconna√Ætre le travail accompli et valoriser",
                        "Uniquement sanctionner les erreurs",
                        "√ätre indiff√©rent",
                        "Critiquer en public"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "D√©l√©gation",
                    "question": "D√©l√©guer permet de :",
                    "options": [
                        "Responsabiliser et d√©velopper les comp√©tences",
                        "Se d√©charger de toutes ses t√¢ches",
                        "√âviter de travailler",
                        "Cr√©er de la confusion"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Gestion Conflit",
                    "question": "Face √† un conflit dans l'√©quipe, le chef d'√©quipe doit :",
                    "options": [
                        "√âcouter les parties et chercher une solution",
                        "Ignorer le probl√®me",
                        "Prendre parti syst√©matiquement",
                        "Sanctionner tout le monde"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "√âvaluation",
                    "question": "L'√©valuation d'un agent doit √™tre :",
                    "options": [
                        "Objective, constructive et r√©guli√®re",
                        "Uniquement n√©gative",
                        "Faite une seule fois par an",
                        "Bas√©e sur des impressions personnelles"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Styles de Management",
                    "question": "Associez le style avec sa caract√©ristique :",
                    "pairs": [
                        {
                            "left": "Directif",
                            "right": "Impose les d√©cisions"
                        },
                        {
                            "left": "Participatif",
                            "right": "Consulte l'√©quipe"
                        },
                        {
                            "left": "D√©l√©gatif",
                            "right": "Responsabilise les agents"
                        },
                        {
                            "left": "Persuasif",
                            "right": "Explique et convainc"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Outils Management",
                    "question": "Associez l'outil avec son objectif :",
                    "pairs": [
                        {
                            "left": "Briefing",
                            "right": "Transmettre informations"
                        },
                        {
                            "left": "Debriefing",
                            "right": "Analyser l'action pass√©e"
                        },
                        {
                            "left": "Entretien individuel",
                            "right": "√âvaluer et √©couter"
                        },
                        {
                            "left": "R√©union d'√©quipe",
                            "right": "Partager et d√©cider"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Comp√©tences Chef",
                    "question": "Associez la comp√©tence avec sa d√©finition :",
                    "pairs": [
                        {
                            "left": "Empathie",
                            "right": "Comprendre les √©motions"
                        },
                        {
                            "left": "Assertivit√©",
                            "right": "S'affirmer sans agresser"
                        },
                        {
                            "left": "P√©dagogie",
                            "right": "Transmettre des savoirs"
                        },
                        {
                            "left": "R√©silience",
                            "right": "G√©rer le stress"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Besoins √âquipe",
                    "question": "Associez le besoin avec son type (Maslow) :",
                    "pairs": [
                        {
                            "left": "S√©curit√© emploi",
                            "right": "Besoin de s√©curit√©"
                        },
                        {
                            "left": "Reconnaissance",
                            "right": "Besoin d'estime"
                        },
                        {
                            "left": "Coh√©sion groupe",
                            "right": "Besoin d'appartenance"
                        },
                        {
                            "left": "D√©veloppement",
                            "right": "Besoin d'accomplissement"
                        }
                    ],
                    "timeLimit": 70,
                    "points": 140
                },
                {
                    "type": "matching",
                    "title": "Communication Non-Verbale",
                    "question": "Associez le signal avec sa signification :",
                    "pairs": [
                        {
                            "left": "Bras crois√©s",
                            "right": "Fermeture/d√©fense"
                        },
                        {
                            "left": "Contact visuel",
                            "right": "√âcoute/attention"
                        },
                        {
                            "left": "Sourire",
                            "right": "Bienveillance"
                        },
                        {
                            "left": "Posture droite",
                            "right": "Assurance"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "R√¥les Chef d'√âquipe",
                    "question": "Quels sont les r√¥les d'un chef d'√©quipe ? (Plusieurs r√©ponses)",
                    "options": [
                        "Organiser le travail",
                        "Former et encadrer",
                        "Contr√¥ler et √©valuer",
                        "Motiver l'√©quipe",
                        "Faire tout le travail seul"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Qualit√©s Requises",
                    "question": "Quelles qualit√©s sont essentielles pour un chef d'√©quipe ? (Plusieurs r√©ponses)",
                    "options": [
                        "Sens du leadership",
                        "Capacit√© d'√©coute",
                        "Organisation",
                        "Gestion du stress",
                        "Individualisme"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "R√©union Efficace",
                    "question": "Pour une r√©union efficace, il faut : (Plusieurs r√©ponses)",
                    "options": [
                        "Un ordre du jour clair",
                        "Un temps d√©fini",
                        "Une synth√®se des d√©cisions",
                        "La participation de tous",
                        "Parler de sujets personnels uniquement"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Gestion du Temps",
                    "question": "Pour bien g√©rer son temps, le chef d'√©quipe doit : (Plusieurs r√©ponses)",
                    "options": [
                        "Prioriser les t√¢ches",
                        "Planifier √† l'avance",
                        "D√©l√©guer quand c'est possible",
                        "√âviter les interruptions inutiles",
                        "Tout faire en m√™me temps"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Formation Continue",
                    "question": "La formation continue de l'√©quipe porte sur : (Plusieurs r√©ponses)",
                    "options": [
                        "Les nouvelles proc√©dures",
                        "L'utilisation du mat√©riel",
                        "Les retours d'exp√©rience",
                        "Les √©volutions r√©glementaires",
                        "Des sujets sans rapport avec le m√©tier"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ]
        ]
    },
    {
        "title": "Extinction",
        "subtitle": "Pratique et techniques",
        "icon": "üßØ",
        "color": "from-indigo-500 to-purple-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Attaque du Feu",
                    "question": "Pour attaquer un feu efficacement, il faut :",
                    "options": [
                        "Se placer dos au vent, attaquer par la base",
                        "Se placer face au vent",
                        "Arroser par le haut des flammes",
                        "S'approcher au maximum"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Feu de Liquide",
                    "question": "Sur un feu de liquide inflammable, on doit :",
                    "options": [
                        "Utiliser mousse ou poudre, jamais eau en jet",
                        "Utiliser uniquement de l'eau",
                        "Souffler sur le feu",
                        "Ne rien faire"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "RIA",
                    "question": "Le RIA est efficace sur les feux de classe :",
                    "options": [
                        "A uniquement (solides)",
                        "A, B et C",
                        "B uniquement (liquides)",
                        "Tous les types"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Bin√¥me",
                    "question": "Lors d'une intervention, il faut travailler :",
                    "options": [
                        "En bin√¥me minimum pour la s√©curit√©",
                        "Toujours seul",
                        "√Ä 10 personnes minimum",
                        "Avec les pompiers uniquement"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Limite Intervention",
                    "question": "L'intervention du SSIAP est limit√©e :",
                    "options": [
                        "Aux d√©buts de feu, sans se mettre en danger",
                        "√Ä tous les types d'incendies",
                        "Uniquement aux feux de poubelle",
                        "Il ne doit jamais intervenir"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "ARI",
                    "question": "L'Appareil Respiratoire Isolant (ARI) est r√©serv√© :",
                    "options": [
                        "Aux sapeurs-pompiers form√©s",
                        "√Ä tous les SSIAP",
                        "Au public",
                        "Aux agents de m√©nage"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "sequence",
                    "title": "Intervention Feu",
                    "question": "Ordre des actions lors d'une intervention sur feu :",
                    "items": [
                        "√âvaluer la situation (type, ampleur)",
                        "Donner l'alerte",
                        "Mettre en s√©curit√© les personnes",
                        "Attaquer le feu si possible"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Utilisation RIA",
                    "question": "√âtapes d'utilisation d'un RIA :",
                    "items": [
                        "Ouvrir la porte du coffret",
                        "D√©rouler le tuyau compl√®tement",
                        "Ouvrir la vanne d'alimentation",
                        "Diriger le jet √† la base des flammes"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Feu √âlectrique",
                    "question": "Proc√©dure sur feu d'origine √©lectrique :",
                    "items": [
                        "Couper l'alimentation √©lectrique",
                        "V√©rifier la coupure effective",
                        "Utiliser extincteur CO2 ou poudre",
                        "Surveiller les reprises"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Protection Individuelle",
                    "question": "Mesures de protection lors de l'intervention :",
                    "items": [
                        "√âvaluer les risques (fum√©es, chaleur)",
                        "Porter les EPI adapt√©s",
                        "Rester en bin√¥me",
                        "Pr√©parer une voie de repli"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Apr√®s Extinction",
                    "question": "Actions apr√®s extinction d'un feu :",
                    "items": [
                        "Surveiller les reprises possibles",
                        "A√©rer les locaux",
                        "Remettre en √©tat le mat√©riel utilis√©",
                        "R√©diger le rapport d'intervention"
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Priorit√© S√©curit√©",
                    "question": "La s√©curit√© du personnel prime sur l'extinction du feu.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Aucune intervention ne doit mettre en danger la vie des intervenants.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Eau sur √âlectricit√©",
                    "question": "On peut utiliser de l'eau sur un feu d'origine √©lectrique si le courant est coup√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Si la coupure √©lectrique est effective et v√©rifi√©e, l'eau devient utilisable.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Feu Trop Important",
                    "question": "Si le feu est trop important, il faut √©vacuer et attendre les pompiers.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Ne jamais se mettre en danger. Les SSIAP n'interviennent que sur les d√©buts de feu.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Fum√©es Toxiques",
                    "question": "Sans ARI, il ne faut pas p√©n√©trer dans un local enfum√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Les fum√©es sont toxiques et mortelles. L'ARI est obligatoire.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Porte Chaude",
                    "question": "Une porte chaude indique un feu violent derri√®re, il ne faut pas l'ouvrir.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Risque de backdraft (explosion de fum√©es). Ne jamais ouvrir.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Exercices R√©guliers",
                    "question": "Le chef d'√©quipe doit organiser des exercices pratiques r√©guliers.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - L'entra√Ænement r√©gulier maintient les comp√©tences de l'√©quipe.",
                    "timeLimit": 30,
                    "points": 80
                }
            ]
        ]
    },
    {
        "title": "Visites Applicatives",
        "subtitle": "Contr√¥les et v√©rifications",
        "icon": "üîç",
        "color": "from-purple-500 to-pink-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Objectif Visite",
                    "question": "L'objectif principal d'une visite de s√©curit√© est de :",
                    "options": [
                        "V√©rifier le respect des r√®gles de s√©curit√©",
                        "Contr√¥ler le personnel",
                        "Chercher des anomalies pour sanctionner",
                        "Faire du tourisme"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Fr√©quence",
                    "question": "Les visites de s√©curit√© doivent √™tre effectu√©es :",
                    "options": [
                        "R√©guli√®rement selon un planning d√©fini",
                        "Une fois par an",
                        "Uniquement en cas de probl√®me",
                        "Jamais"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Rapport de Visite",
                    "question": "Apr√®s une visite, le chef d'√©quipe doit :",
                    "options": [
                        "R√©diger un rapport avec les anomalies constat√©es",
                        "Ne rien √©crire",
                        "En parler oralement uniquement",
                        "Oublier ce qu'il a vu"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Zones √† Contr√¥ler",
                    "question": "Les visites doivent couvrir :",
                    "options": [
                        "Toutes les zones de l'√©tablissement",
                        "Uniquement les zones publiques",
                        "Uniquement les locaux techniques",
                        "Uniquement l'entr√©e"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Points de Contr√¥le",
                    "question": "Lors d'une visite, on v√©rifie notamment :",
                    "options": [
                        "D√©gagements, moyens de secours, portes CF",
                        "Uniquement la d√©coration",
                        "La propret√© des vitres",
                        "Le mobilier"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Suivi Anomalies",
                    "question": "Les anomalies d√©tect√©es doivent √™tre :",
                    "options": [
                        "Signal√©es et suivies jusqu'√† correction",
                        "Ignor√©es",
                        "Corrig√©es dans 5 ans",
                        "Cach√©es"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "D√©gagements",
                    "question": "Lors du contr√¥le des d√©gagements, on v√©rifie : (Plusieurs r√©ponses)",
                    "options": [
                        "Qu'ils sont libres de tout obstacle",
                        "L'√©clairage de s√©curit√© fonctionne",
                        "Les portes s'ouvrent dans le bon sens",
                        "La signalisation est visible",
                        "La couleur des murs"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Moyens de Secours",
                    "question": "Quels moyens de secours faut-il contr√¥ler ? (Plusieurs r√©ponses)",
                    "options": [
                        "Extincteurs (accessibilit√©, pression)",
                        "RIA (signalisation, d√©roulement)",
                        "D√©clencheurs manuels",
                        "Issues de secours",
                        "Distributeurs de boissons"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Portes Coupe-Feu",
                    "question": "Pour les portes coupe-feu, on contr√¥le : (Plusieurs r√©ponses)",
                    "options": [
                        "La fermeture automatique",
                        "L'absence d'obstacle (cale)",
                        "L'√©tat des joints",
                        "Le bon fonctionnement du ferme-porte",
                        "La couleur de la peinture"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Locaux √† Risque",
                    "question": "Dans les locaux √† risque, on v√©rifie : (Plusieurs r√©ponses)",
                    "options": [
                        "Le stockage conforme",
                        "Les installations √©lectriques",
                        "La ventilation",
                        "L'absence de sources d'ignition",
                        "Le nombre de chaises"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Signalisation",
                    "question": "La signalisation de s√©curit√© doit √™tre : (Plusieurs r√©ponses)",
                    "options": [
                        "Visible et non masqu√©e",
                        "Conforme aux normes",
                        "√âclair√©e ou lumineuse",
                        "En bon √©tat",
                        "De couleur rose"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Gravit√© Anomalies",
                    "question": "Associez l'anomalie avec son niveau de gravit√© :",
                    "pairs": [
                        {
                            "left": "Issue secours condamn√©e",
                            "right": "Critique - correction imm√©diate"
                        },
                        {
                            "left": "Extincteur d√©charg√©",
                            "right": "Grave - correction rapide"
                        },
                        {
                            "left": "Carton dans couloir",
                            "right": "Moyenne - √† corriger"
                        },
                        {
                            "left": "Signalisation sale",
                            "right": "Mineure - √† nettoyer"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Responsables Correction",
                    "question": "Associez l'anomalie avec le responsable de la correction :",
                    "pairs": [
                        {
                            "left": "Porte CF d√©fectueuse",
                            "right": "Service technique"
                        },
                        {
                            "left": "Encombrement couloir",
                            "right": "Service concern√©"
                        },
                        {
                            "left": "SSI en panne",
                            "right": "Entreprise de maintenance"
                        },
                        {
                            "left": "Consignes obsol√®tes",
                            "right": "Service s√©curit√©"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Outils de Visite",
                    "question": "Associez l'outil avec son usage lors d'une visite :",
                    "pairs": [
                        {
                            "left": "Check-list",
                            "right": "Ne rien oublier"
                        },
                        {
                            "left": "Appareil photo",
                            "right": "Documenter les anomalies"
                        },
                        {
                            "left": "Main courante",
                            "right": "Tracer la visite"
                        },
                        {
                            "left": "Plans",
                            "right": "Se rep√©rer"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Types de Visites",
                    "question": "Associez le type de visite avec son objectif :",
                    "pairs": [
                        {
                            "left": "Visite programm√©e",
                            "right": "Contr√¥le syst√©matique"
                        },
                        {
                            "left": "Visite inopin√©e",
                            "right": "V√©rification ponctuelle"
                        },
                        {
                            "left": "Visite post-travaux",
                            "right": "R√©ception s√©curit√©"
                        },
                        {
                            "left": "Visite commission",
                            "right": "Contr√¥le r√©glementaire"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Documents Visite",
                    "question": "Associez le document avec son contenu :",
                    "pairs": [
                        {
                            "left": "Rapport de visite",
                            "right": "Constatations et anomalies"
                        },
                        {
                            "left": "Fiche de suivi",
                            "right": "√âtat d'avancement corrections"
                        },
                        {
                            "left": "Plan annot√©",
                            "right": "Localisation anomalies"
                        },
                        {
                            "left": "Photos",
                            "right": "Preuves visuelles"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ]
        ]
    },
    {
        "title": "Commissions",
        "subtitle": "R√©glementation et visites",
        "icon": "üìã",
        "color": "from-pink-500 to-red-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Commission de S√©curit√©",
                    "question": "La commission de s√©curit√© est pr√©sid√©e par :",
                    "options": [
                        "Le repr√©sentant du maire",
                        "Le chef d'√©tablissement",
                        "Le SSIAP 3",
                        "Un sapeur-pompier"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Composition",
                    "question": "La commission de s√©curit√© comprend notamment :",
                    "options": [
                        "Sapeurs-pompiers, services techniques, repr√©sentants √©lus",
                        "Uniquement des pompiers",
                        "Uniquement le chef d'√©tablissement",
                        "Uniquement des √©lus"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "P√©riodicit√© ERP 1√®re",
                    "question": "Pour un ERP de 1√®re cat√©gorie, la visite p√©riodique est :",
                    "options": [
                        "Annuelle",
                        "Tous les 3 ans",
                        "Tous les 5 ans",
                        "Une seule fois"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Avis Commission",
                    "question": "L'avis de la commission peut √™tre :",
                    "options": [
                        "Favorable, d√©favorable ou avec prescriptions",
                        "Uniquement favorable",
                        "Uniquement d√©favorable",
                        "Sans importance"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "R√¥le SSIAP",
                    "question": "Lors d'une visite de commission, le SSIAP doit :",
                    "options": [
                        "Accompagner, informer et r√©pondre aux questions",
                        "Rester au PC s√©curit√©",
                        "Quitter l'√©tablissement",
                        "Se cacher"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "PV Commission",
                    "question": "Le proc√®s-verbal de la commission doit √™tre :",
                    "options": [
                        "Conserv√© dans le registre de s√©curit√©",
                        "Jet√© imm√©diatement",
                        "Gard√© chez soi",
                        "Envoy√© √† la presse"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Obligation Visite",
                    "question": "Tout ERP doit faire l'objet de visites de commissions de s√©curit√© p√©riodiques.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Les visites p√©riodiques sont obligatoires selon la cat√©gorie de l'ERP.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Avis D√©favorable",
                    "question": "Un avis d√©favorable peut entra√Æner la fermeture de l'√©tablissement.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le maire peut prendre un arr√™t√© de fermeture suite √† un avis d√©favorable.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Travaux",
                    "question": "Tous travaux modifiant la s√©curit√© doivent √™tre d√©clar√©s et autoris√©s.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Les travaux n√©cessitent une autorisation apr√®s avis de la commission.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Registre S√©curit√©",
                    "question": "Le registre de s√©curit√© doit √™tre pr√©sent√© √† la commission lors de sa visite.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le registre de s√©curit√© est un document obligatoire √† pr√©senter.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Formation SSIAP",
                    "question": "Le chef d'√©quipe doit justifier de sa qualification SSIAP 2 lors des visites.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Les dipl√¥mes et recyclages doivent √™tre √† jour et pr√©sentables.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Suivi Prescriptions",
                    "question": "Les prescriptions de la commission doivent √™tre suivies et lev√©es.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le chef d'√©tablissement doit r√©aliser les prescriptions dans les d√©lais impartis.",
                    "timeLimit": 30,
                    "points": 80
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Types de Visites",
                    "question": "Associez le type de visite avec son objectif :",
                    "pairs": [
                        {
                            "left": "Visite p√©riodique",
                            "right": "Contr√¥le r√©gulier"
                        },
                        {
                            "left": "Visite d'ouverture",
                            "right": "Avant 1√®re exploitation"
                        },
                        {
                            "left": "Visite de r√©ception",
                            "right": "Apr√®s travaux"
                        },
                        {
                            "left": "Visite inopin√©e",
                            "right": "Suite √† incident ou plainte"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Documents √† Pr√©senter",
                    "question": "Associez le document avec son contenu :",
                    "pairs": [
                        {
                            "left": "Registre de s√©curit√©",
                            "right": "V√©rifications et contr√¥les"
                        },
                        {
                            "left": "Notice de s√©curit√©",
                            "right": "Description installations"
                        },
                        {
                            "left": "Plans",
                            "right": "Configuration des lieux"
                        },
                        {
                            "left": "Dipl√¥mes SSIAP",
                            "right": "Qualification du personnel"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Acteurs Commission",
                    "question": "Associez l'acteur avec son r√¥le :",
                    "pairs": [
                        {
                            "left": "Pr√©sident",
                            "right": "Repr√©sentant du maire"
                        },
                        {
                            "left": "Rapporteur",
                            "right": "Sapeur-pompier"
                        },
                        {
                            "left": "Chef d'√©tablissement",
                            "right": "Responsable s√©curit√©"
                        },
                        {
                            "left": "SSIAP",
                            "right": "Guide et informateur"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Suites de Visite",
                    "question": "Associez l'avis avec sa cons√©quence :",
                    "pairs": [
                        {
                            "left": "Favorable",
                            "right": "Exploitation autoris√©e"
                        },
                        {
                            "left": "Favorable avec prescriptions",
                            "right": "Travaux √† r√©aliser"
                        },
                        {
                            "left": "D√©favorable",
                            "right": "Interdiction d'exploitation"
                        },
                        {
                            "left": "Report",
                            "right": "Nouvelle visite n√©cessaire"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Pr√©paration Visite",
                    "question": "Associez la t√¢che avec le responsable :",
                    "pairs": [
                        {
                            "left": "Convocation commission",
                            "right": "Mairie"
                        },
                        {
                            "left": "Pr√©paration documents",
                            "right": "Chef d'√©tablissement"
                        },
                        {
                            "left": "V√©rifications pr√©alables",
                            "right": "Chef d'√©quipe SSIAP 2"
                        },
                        {
                            "left": "Guidage visite",
                            "right": "Service s√©curit√©"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ]
        ]
    }
],
    3: [
    {
        "title": "Gestion du Service",
        "subtitle": "Organisation et management",
        "icon": "üëî",
        "color": "from-red-500 to-orange-700",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Chef de Service",
                    "question": "Le chef de service SSIAP 3 est responsable :",
                    "options": [
                        "De l'ensemble du service de s√©curit√© incendie",
                        "Uniquement d'une √©quipe",
                        "Uniquement du PC s√©curit√©",
                        "Des sapeurs-pompiers"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Effectif",
                    "question": "Le SSIAP 3 est obligatoire dans les ERP de :",
                    "options": [
                        "1√®re et 2√®me cat√©gorie avec service de s√©curit√©",
                        "Toutes cat√©gories",
                        "Uniquement 5√®me cat√©gorie",
                        "Jamais obligatoire"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Autorit√©",
                    "question": "Le chef de service est plac√© sous l'autorit√© :",
                    "options": [
                        "Du chef d'√©tablissement",
                        "Du maire",
                        "Des sapeurs-pompiers",
                        "De la pr√©fecture"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "D√©l√©gation",
                    "question": "Le chef d'√©tablissement peut d√©l√©guer au SSIAP 3 :",
                    "options": [
                        "Certaines responsabilit√©s de s√©curit√© par √©crit",
                        "Toute sa responsabilit√©",
                        "Aucune responsabilit√©",
                        "Uniquement les responsabilit√©s financi√®res"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Missions",
                    "question": "Parmi les missions du SSIAP 3, on trouve :",
                    "options": [
                        "Conseil au chef d'√©tablissement, management, gestion budg√©taire",
                        "Uniquement l'intervention sur feu",
                        "Uniquement la formation",
                        "Uniquement les rondes"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Responsabilit√© P√©nale",
                    "question": "En cas d'accident grave, le SSIAP 3 peut engager :",
                    "options": [
                        "Sa responsabilit√© p√©nale si faute d√©montr√©e",
                        "Uniquement la responsabilit√© de l'√©tablissement",
                        "Aucune responsabilit√©",
                        "Uniquement une responsabilit√© civile"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "Organisation Service",
                    "question": "Le chef de service doit organiser : (Plusieurs r√©ponses)",
                    "options": [
                        "Les plannings et l'effectif",
                        "La formation continue",
                        "Les √©quipements et moyens",
                        "La gestion budg√©taire",
                        "Les menus de la cantine"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Documents √† G√©rer",
                    "question": "Quels documents rel√®vent du chef de service ? (Plusieurs r√©ponses)",
                    "options": [
                        "Registre de s√©curit√©",
                        "Notice de s√©curit√©",
                        "Consignes g√©n√©rales",
                        "Plans d'intervention",
                        "Factures de restaurant"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Relations Externes",
                    "question": "Le SSIAP 3 est en relation avec : (Plusieurs r√©ponses)",
                    "options": [
                        "La commission de s√©curit√©",
                        "Le SDIS (pompiers)",
                        "Les bureaux de contr√¥le",
                        "Les entreprises ext√©rieures",
                        "Les agences de voyage"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Gestion RH",
                    "question": "Le chef de service g√®re : (Plusieurs r√©ponses)",
                    "options": [
                        "Le recrutement des agents",
                        "L'√©valuation du personnel",
                        "La formation et le recyclage",
                        "Les plannings et cong√©s",
                        "Les salaires (c'est les RH)"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Conseil Direction",
                    "question": "Le SSIAP 3 conseille la direction sur : (Plusieurs r√©ponses)",
                    "options": [
                        "Les travaux et am√©nagements",
                        "Les projets de s√©curit√©",
                        "Le budget du service s√©curit√©",
                        "Les √©volutions r√©glementaires",
                        "La strat√©gie commerciale"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Responsabilit√© Totale",
                    "question": "Le chef d'√©tablissement reste toujours le seul responsable de la s√©curit√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - M√™me avec d√©l√©gation, le chef d'√©tablissement garde la responsabilit√© finale.",
                    "timeLimit": 35,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Budget",
                    "question": "Le SSIAP 3 propose et g√®re le budget du service de s√©curit√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Il √©tablit le budget et suit les d√©penses du service de s√©curit√©.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Formation",
                    "question": "Le SSIAP 3 peut former les SSIAP 1 et SSIAP 2.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Il assure la formation continue de son √©quipe (SSIAP 1 et 2).",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Recrutement",
                    "question": "Le chef de service participe au recrutement des agents de s√©curit√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Il d√©finit les profils et participe aux entretiens de recrutement.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Autonomie",
                    "question": "Le SSIAP 3 a une large autonomie dans la gestion de son service.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Il g√®re son service en autonomie dans le cadre de sa d√©l√©gation.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "D√©cision Fermeture",
                    "question": "Le SSIAP 3 peut d√©cider seul de fermer l'√©tablissement.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - Seul le maire (ou pr√©fet) peut ordonner la fermeture. Le SSIAP 3 peut conseiller.",
                    "timeLimit": 35,
                    "points": 80
                }
            ]
        ]
    },
    {
        "title": "R√©glementation",
        "subtitle": "Textes et obligations",
        "icon": "üìú",
        "color": "from-orange-500 to-yellow-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Code de la Construction",
                    "question": "Le r√®glement de s√©curit√© des ERP est annex√© √† :",
                    "options": [
                        "Le Code de la Construction et de l'Habitation",
                        "Le Code du Travail",
                        "Le Code P√©nal",
                        "Le Code Civil"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Arr√™t√© du 25 juin 1980",
                    "question": "L'arr√™t√© du 25 juin 1980 concerne :",
                    "options": [
                        "La s√©curit√© incendie dans les ERP",
                        "Les IGH uniquement",
                        "Les habitations",
                        "Le Code du Travail"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "IGH",
                    "question": "Un IGH (Immeuble de Grande Hauteur) a une hauteur sup√©rieure √† :",
                    "options": [
                        "50 m√®tres (plancher bas dernier niveau)",
                        "30 m√®tres",
                        "100 m√®tres",
                        "28 m√®tres"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "ICPE",
                    "question": "Que signifie ICPE ?",
                    "options": [
                        "Installation Class√©e pour la Protection de l'Environnement",
                        "Incendie Class√© Pour √âvacuation",
                        "Installation de Contr√¥le des Produits Explosifs",
                        "Intervention Collective Pour l'Environnement"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Pouvoir Police",
                    "question": "Le pouvoir de police administrative en mati√®re de s√©curit√© incendie appartient √† :",
                    "options": [
                        "Le maire (ou le pr√©fet)",
                        "Le chef d'√©tablissement",
                        "Le SSIAP 3",
                        "Les sapeurs-pompiers"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Accessibilit√©",
                    "question": "L'accessibilit√© aux personnes handicap√©es est r√©gie par :",
                    "options": [
                        "La loi du 11 f√©vrier 2005",
                        "L'arr√™t√© du 25 juin 1980",
                        "Le Code du Travail",
                        "La loi de 1991"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Textes R√©glementaires",
                    "question": "Associez le texte avec son domaine :",
                    "pairs": [
                        {
                            "left": "Arr√™t√© 25 juin 1980",
                            "right": "ERP"
                        },
                        {
                            "left": "Arr√™t√© 18 octobre 1977",
                            "right": "IGH"
                        },
                        {
                            "left": "Arr√™t√© 2 mai 2005",
                            "right": "Formation SSIAP"
                        },
                        {
                            "left": "Code du Travail",
                            "right": "√âtablissements de travail"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Cat√©gories ERP",
                    "question": "Associez la cat√©gorie avec l'effectif :",
                    "pairs": [
                        {
                            "left": "1√®re cat√©gorie",
                            "right": "> 1500 personnes"
                        },
                        {
                            "left": "2√®me cat√©gorie",
                            "right": "701 √† 1500 personnes"
                        },
                        {
                            "left": "3√®me cat√©gorie",
                            "right": "301 √† 700 personnes"
                        },
                        {
                            "left": "4√®me cat√©gorie",
                            "right": "‚â§ 300 personnes"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Types ERP",
                    "question": "Associez la lettre avec le type d'ERP :",
                    "pairs": [
                        {
                            "left": "Type J",
                            "right": "Structures d'accueil pour personnes √¢g√©es"
                        },
                        {
                            "left": "Type L",
                            "right": "Salles d'audition, spectacles"
                        },
                        {
                            "left": "Type M",
                            "right": "Magasins de vente"
                        },
                        {
                            "left": "Type N",
                            "right": "Restaurants et d√©bits de boissons"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Acteurs S√©curit√©",
                    "question": "Associez l'acteur avec son r√¥le :",
                    "pairs": [
                        {
                            "left": "Maire",
                            "right": "Pouvoir de police"
                        },
                        {
                            "left": "Commission s√©curit√©",
                            "right": "Avis technique"
                        },
                        {
                            "left": "Bureau de contr√¥le",
                            "right": "V√©rification technique"
                        },
                        {
                            "left": "SDIS",
                            "right": "Secours et pr√©vention"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Documents Obligatoires",
                    "question": "Associez le document avec son objectif :",
                    "pairs": [
                        {
                            "left": "Registre de s√©curit√©",
                            "right": "Tra√ßabilit√© des contr√¥les"
                        },
                        {
                            "left": "Notice de s√©curit√©",
                            "right": "Description mesures s√©curit√©"
                        },
                        {
                            "left": "Consignes",
                            "right": "Conduite √† tenir"
                        },
                        {
                            "left": "Plan d'√©vacuation",
                            "right": "Cheminements d'√©vacuation"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "Obligations √âtablissement",
                    "question": "Quelles sont les obligations du chef d'√©tablissement ? (Plusieurs r√©ponses)",
                    "options": [
                        "Maintenir les installations en bon √©tat",
                        "Former le personnel aux consignes",
                        "Organiser des exercices d'√©vacuation",
                        "Tenir le registre de s√©curit√© √† jour",
                        "Remplacer les sapeurs-pompiers"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Commissions S√©curit√©",
                    "question": "La commission de s√©curit√© v√©rifie : (Plusieurs r√©ponses)",
                    "options": [
                        "L'√©tat des installations de s√©curit√©",
                        "L'effectif et la qualification du service de s√©curit√©",
                        "La conformit√© des travaux",
                        "Le respect de la r√©glementation",
                        "La comptabilit√© de l'√©tablissement"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Accessibilit√© PMR",
                    "question": "L'accessibilit√© des PMR concerne : (Plusieurs r√©ponses)",
                    "options": [
                        "L'acc√®s √† l'√©tablissement",
                        "La circulation int√©rieure",
                        "Les sanitaires adapt√©s",
                        "La signalisation",
                        "Uniquement les nouvelles constructions"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "V√©rifications P√©riodiques",
                    "question": "Quelles installations n√©cessitent des v√©rifications p√©riodiques ? (Plusieurs r√©ponses)",
                    "options": [
                        "SSI (annuel)",
                        "Extincteurs (annuel)",
                        "√âclairage de s√©curit√© (mensuel)",
                        "D√©senfumage (annuel)",
                        "D√©coration murale"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 70,
                    "points": 160
                },
                {
                    "type": "quiz-multi",
                    "title": "Autorisation Travaux",
                    "question": "Quels travaux n√©cessitent une autorisation ? (Plusieurs r√©ponses)",
                    "options": [
                        "Modification des d√©gagements",
                        "Changement de destination",
                        "Augmentation de l'effectif",
                        "Installation √©quipements techniques",
                        "Changement de papier peint"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ]
        ]
    },
    {
        "title": "Gestion Budg√©taire",
        "subtitle": "Budget du service s√©curit√©",
        "icon": "üí∞",
        "color": "from-yellow-500 to-green-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "√âlaboration Budget",
                    "question": "Le budget du service de s√©curit√© est √©tabli par :",
                    "options": [
                        "Le chef de service en accord avec la direction",
                        "Uniquement la direction financi√®re",
                        "Les sapeurs-pompiers",
                        "La commission de s√©curit√©"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Postes Budg√©taires",
                    "question": "Le budget s√©curit√© comprend principalement :",
                    "options": [
                        "Personnel, √©quipements, formations, maintenances",
                        "Uniquement les salaires",
                        "Uniquement les extincteurs",
                        "Uniquement les formations"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Investissement",
                    "question": "Un investissement en s√©curit√© est :",
                    "options": [
                        "Une d√©pense durable (√©quipement, installation)",
                        "Une d√©pense courante (consommable)",
                        "Toujours inutile",
                        "Facultatif"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Suivi Budg√©taire",
                    "question": "Le chef de service doit :",
                    "options": [
                        "Suivre l'ex√©cution du budget et justifier les √©carts",
                        "D√©penser sans compter",
                        "Ne jamais regarder le budget",
                        "Laisser la direction g√©rer"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Amortissement",
                    "question": "L'amortissement d'un √©quipement permet de :",
                    "options": [
                        "R√©partir son co√ªt sur plusieurs ann√©es",
                        "Le vendre imm√©diatement",
                        "Le jeter",
                        "Le donner"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Optimisation",
                    "question": "Pour optimiser le budget, le chef de service peut :",
                    "options": [
                        "Mutualiser les achats, n√©gocier les contrats",
                        "Supprimer toute formation",
                        "Ne rien acheter",
                        "Acheter sans comparer"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Types de D√©penses",
                    "question": "Associez la d√©pense avec sa cat√©gorie :",
                    "pairs": [
                        {
                            "left": "Salaires",
                            "right": "Fonctionnement r√©current"
                        },
                        {
                            "left": "Centrale SSI",
                            "right": "Investissement"
                        },
                        {
                            "left": "Formations",
                            "right": "Fonctionnement"
                        },
                        {
                            "left": "Extincteurs",
                            "right": "√âquipement"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Contrats Maintenance",
                    "question": "Associez l'√©quipement avec sa fr√©quence de maintenance :",
                    "pairs": [
                        {
                            "left": "SSI",
                            "right": "Mensuel + annuel"
                        },
                        {
                            "left": "Extincteurs",
                            "right": "Annuel"
                        },
                        {
                            "left": "RIA",
                            "right": "Annuel"
                        },
                        {
                            "left": "D√©senfumage",
                            "right": "Annuel"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Postes Budget",
                    "question": "Associez le poste avec son type :",
                    "pairs": [
                        {
                            "left": "Masse salariale",
                            "right": "Poste principal (60-70%)"
                        },
                        {
                            "left": "√âquipements",
                            "right": "Investissement ponctuel"
                        },
                        {
                            "left": "Formations",
                            "right": "Obligatoire"
                        },
                        {
                            "left": "Maintenance",
                            "right": "R√©current"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Indicateurs",
                    "question": "Associez l'indicateur avec ce qu'il mesure :",
                    "pairs": [
                        {
                            "left": "Ratio co√ªt/agent",
                            "right": "Efficience"
                        },
                        {
                            "left": "Taux formation",
                            "right": "Qualification"
                        },
                        {
                            "left": "Nombre interventions",
                            "right": "Activit√©"
                        },
                        {
                            "left": "Budget pr√©v./r√©alis√©",
                            "right": "Ma√Ætrise budg√©taire"
                        }
                    ],
                    "timeLimit": 70,
                    "points": 140
                },
                {
                    "type": "matching",
                    "title": "Sources Financement",
                    "question": "Associez la source avec son type :",
                    "pairs": [
                        {
                            "left": "Budget √©tablissement",
                            "right": "Principal"
                        },
                        {
                            "left": "Subventions",
                            "right": "Aide publique"
                        },
                        {
                            "left": "Assurances",
                            "right": "Partenaire"
                        },
                        {
                            "left": "Autofinancement",
                            "right": "√âconomies"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Justification",
                    "question": "Toute d√©pense doit pouvoir √™tre justifi√©e par une facture ou un bon de commande.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La tra√ßabilit√© et la justification des d√©penses sont obligatoires.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Appel d'Offres",
                    "question": "Pour les achats importants, un appel d'offres permet de comparer les prix.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La mise en concurrence permet d'optimiser les achats.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Pr√©visionnel",
                    "question": "Le budget pr√©visionnel doit anticiper les besoins de l'ann√©e suivante.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le budget se pr√©pare plusieurs mois √† l'avance.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "√âconomies",
                    "question": "Faire des √©conomies sur la s√©curit√© est acceptable si le budget est serr√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 1,
                    "explanation": "FAUX - La s√©curit√© ne peut √™tre n√©goci√©e. Il faut trouver d'autres solutions.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "ROI S√©curit√©",
                    "question": "L'investissement en s√©curit√© a un retour sur investissement (moins de sinistres).",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La pr√©vention co√ªte moins cher qu'un sinistre et ses cons√©quences.",
                    "timeLimit": 35,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Contr√¥le Gestion",
                    "question": "Le chef de service doit rendre compte de l'utilisation du budget.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Reporting et transparence sont essentiels dans la gestion budg√©taire.",
                    "timeLimit": 30,
                    "points": 80
                }
            ]
        ]
    },
    {
        "title": "Ressources Humaines",
        "subtitle": "Management et formation",
        "icon": "üë®‚Äçüë®‚Äçüë¶",
        "color": "from-green-500 to-blue-600",
        "games": [
            [
                {
                    "type": "sequence",
                    "title": "Recrutement",
                    "question": "√âtapes du processus de recrutement :",
                    "items": [
                        "D√©finition du poste et du profil",
                        "Diffusion de l'annonce",
                        "S√©lection des candidatures",
                        "Entretiens et choix final"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Int√©gration",
                    "question": "Parcours d'int√©gration d'un nouvel agent :",
                    "items": [
                        "Accueil et pr√©sentation de l'√©quipe",
                        "Visite de l'√©tablissement",
                        "Formation aux proc√©dures",
                        "√âvaluation de la p√©riode d'essai"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Formation Continue",
                    "question": "Cycle de formation d'un agent SSIAP :",
                    "items": [
                        "Formation initiale SSIAP",
                        "Mise en pratique sur site",
                        "Formation continue interne",
                        "Recyclage triennal obligatoire"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "√âvaluation",
                    "question": "Processus d'√©valuation annuelle :",
                    "items": [
                        "Pr√©paration (objectifs, crit√®res)",
                        "Entretien individuel",
                        "Bilan et points d'am√©lioration",
                        "D√©finition nouveaux objectifs"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Gestion Conflit",
                    "question": "R√©solution d'un conflit dans l'√©quipe :",
                    "items": [
                        "√âcoute des parties s√©par√©ment",
                        "R√©union de m√©diation",
                        "Recherche de solutions",
                        "Suivi de la mise en ≈ìuvre"
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "quiz",
                    "title": "Profil de Poste",
                    "question": "Un profil de poste d√©finit :",
                    "options": [
                        "Les comp√©tences, missions et responsabilit√©s",
                        "Uniquement le salaire",
                        "Uniquement les horaires",
                        "Rien d'important"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Entretien Annuel",
                    "question": "L'entretien annuel d'√©valuation sert √† :",
                    "options": [
                        "Faire le bilan, fixer des objectifs, identifier les besoins",
                        "Uniquement sanctionner",
                        "Parler de sujets personnels",
                        "Ne sert √† rien"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Plan de Formation",
                    "question": "Le plan de formation doit √™tre √©tabli :",
                    "options": [
                        "Annuellement en fonction des besoins identifi√©s",
                        "Jamais",
                        "Tous les 10 ans",
                        "Uniquement pour les nouveaux"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Motivation",
                    "question": "Pour maintenir la motivation, le chef de service doit :",
                    "options": [
                        "Reconna√Ætre le travail, donner du sens, impliquer",
                        "Uniquement augmenter les salaires",
                        "√ätre indiff√©rent",
                        "Critiquer constamment"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Comp√©tences",
                    "question": "La gestion des comp√©tences consiste √† :",
                    "options": [
                        "Identifier, d√©velopper et valoriser les comp√©tences",
                        "Ignorer les comp√©tences",
                        "Recruter uniquement des experts",
                        "Ne jamais former"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "GPEC",
                    "question": "La GPEC (Gestion Pr√©visionnelle des Emplois et Comp√©tences) permet de :",
                    "options": [
                        "Anticiper les besoins futurs en effectif et comp√©tences",
                        "Licencier du personnel",
                        "Augmenter les salaires",
                        "Rien de particulier"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "Types de Formation",
                    "question": "Quels types de formation existent ? (Plusieurs r√©ponses)",
                    "options": [
                        "Formation initiale (dipl√¥me SSIAP)",
                        "Formation continue",
                        "Recyclage obligatoire",
                        "Formation interne sur site",
                        "Pas besoin de formation"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Objectifs Formation",
                    "question": "Les objectifs de la formation sont : (Plusieurs r√©ponses)",
                    "options": [
                        "Maintenir les comp√©tences √† jour",
                        "Adapter aux √©volutions",
                        "D√©velopper la polyvalence",
                        "Motiver et valoriser",
                        "Perdre du temps"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Obligations Formation",
                    "question": "Quelles formations sont obligatoires ? (Plusieurs r√©ponses)",
                    "options": [
                        "Recyclage SSIAP tous les 3 ans",
                        "Remise √† niveau si interruption > 3 ans",
                        "Formation √† la manipulation des extincteurs",
                        "Consignes de s√©curit√© √† l'embauche",
                        "Formation au golf"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "√âvaluation Formation",
                    "question": "Comment √©valuer l'efficacit√© d'une formation ? (Plusieurs r√©ponses)",
                    "options": [
                        "Test de connaissances",
                        "Mise en situation pratique",
                        "Observation sur le terrain",
                        "Retour d'exp√©rience des participants",
                        "Ne pas √©valuer"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Besoins Formation",
                    "question": "Les besoins de formation sont identifi√©s par : (Plusieurs r√©ponses)",
                    "options": [
                        "Entretiens annuels",
                        "√âvolutions r√©glementaires",
                        "Retours d'incidents",
                        "Demandes des agents",
                        "Le hasard"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ]
        ]
    },
    {
        "title": "Analyse des Risques",
        "subtitle": "√âvaluation et pr√©vention",
        "icon": "‚ö†Ô∏è",
        "color": "from-blue-500 to-indigo-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Analyse de Risque",
                    "question": "L'analyse de risque permet de :",
                    "options": [
                        "Identifier, √©valuer et hi√©rarchiser les risques",
                        "Ignorer les probl√®mes",
                        "Uniquement constater",
                        "Bl√¢mer les agents"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "M√©thode",
                    "question": "La m√©thode AMDEC signifie :",
                    "options": [
                        "Analyse des Modes de D√©faillance, de leurs Effets et de leur Criticit√©",
                        "Analyse Mensuelle Des √âv√©nements Critiques",
                        "Aucune M√©thode De Contr√¥le",
                        "Autre M√©thode D'√âvaluation Continue"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Criticit√©",
                    "question": "La criticit√© d'un risque se calcule par :",
                    "options": [
                        "Gravit√© √ó Fr√©quence",
                        "Gravit√© + Fr√©quence",
                        "Gravit√© - Fr√©quence",
                        "Gravit√© / Fr√©quence"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Pr√©vention",
                    "question": "La pr√©vention primaire consiste √† :",
                    "options": [
                        "√âviter l'apparition du risque",
                        "Limiter les cons√©quences",
                        "R√©parer apr√®s accident",
                        "Ne rien faire"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Retour d'Exp√©rience",
                    "question": "Le RETEX (Retour d'Exp√©rience) permet de :",
                    "options": [
                        "Analyser les incidents pour √©viter leur r√©p√©tition",
                        "Chercher un coupable",
                        "Oublier les probl√®mes",
                        "Garder les erreurs secr√®tes"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Sc√©narios",
                    "question": "L'√©laboration de sc√©narios d'accident permet de :",
                    "options": [
                        "Anticiper et pr√©parer les r√©ponses",
                        "Faire peur au personnel",
                        "Perdre du temps",
                        "Ne sert √† rien"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Familles de Risques",
                    "question": "Associez le risque avec sa famille :",
                    "pairs": [
                        {
                            "left": "Incendie",
                            "right": "Risque majeur"
                        },
                        {
                            "left": "Chute",
                            "right": "Risque professionnel"
                        },
                        {
                            "left": "Panique",
                            "right": "Risque humain"
                        },
                        {
                            "left": "Panne SSI",
                            "right": "Risque technique"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Niveaux Pr√©vention",
                    "question": "Associez le niveau avec son action :",
                    "pairs": [
                        {
                            "left": "Primaire",
                            "right": "Emp√™cher le risque"
                        },
                        {
                            "left": "Secondaire",
                            "right": "D√©tecter pr√©cocement"
                        },
                        {
                            "left": "Tertiaire",
                            "right": "Limiter les cons√©quences"
                        },
                        {
                            "left": "Quaternaire",
                            "right": "R√©parer et am√©liorer"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Mesures Protection",
                    "question": "Associez la mesure avec son type :",
                    "pairs": [
                        {
                            "left": "Formation",
                            "right": "Protection collective"
                        },
                        {
                            "left": "EPI",
                            "right": "Protection individuelle"
                        },
                        {
                            "left": "Consignes",
                            "right": "Organisationnel"
                        },
                        {
                            "left": "Sprinkleurs",
                            "right": "Technique"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Outils Analyse",
                    "question": "Associez l'outil avec son usage :",
                    "pairs": [
                        {
                            "left": "Arbre des causes",
                            "right": "Analyser un accident"
                        },
                        {
                            "left": "Matrice de risques",
                            "right": "Hi√©rarchiser"
                        },
                        {
                            "left": "Check-list",
                            "right": "V√©rifier"
                        },
                        {
                            "left": "Plan d'action",
                            "right": "Traiter les risques"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Indicateurs",
                    "question": "Associez l'indicateur avec ce qu'il mesure :",
                    "pairs": [
                        {
                            "left": "Taux de fr√©quence",
                            "right": "Nombre d'accidents"
                        },
                        {
                            "left": "Taux de gravit√©",
                            "right": "Gravit√© des accidents"
                        },
                        {
                            "left": "Nombre presqu'accidents",
                            "right": "√âv√©nements pr√©curseurs"
                        },
                        {
                            "left": "Taux formation",
                            "right": "Pr√©vention"
                        }
                    ],
                    "timeLimit": 70,
                    "points": 140
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "Culture S√©curit√©",
                    "question": "La culture s√©curit√© doit √™tre partag√©e par tous (direction, encadrement, agents).",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La s√©curit√© est l'affaire de tous, √† tous les niveaux.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Risque Z√©ro",
                    "question": "Le risque z√©ro n'existe pas, on peut seulement le r√©duire.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - On ne peut jamais √©liminer totalement tous les risques.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Presqu'Accident",
                    "question": "Un presqu'accident doit √™tre analys√© comme un accident.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - C'est un signal d'alerte pr√©curseur qu'il faut exploiter.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Am√©lioration Continue",
                    "question": "La d√©marche de pr√©vention doit √™tre continue et √©volutive.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La pr√©vention n'est jamais termin√©e, elle s'am√©liore constamment.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Participation",
                    "question": "L'implication du personnel dans l'analyse des risques am√©liore la pr√©vention.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Les agents de terrain ont une connaissance pr√©cieuse des risques r√©els.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Documentation",
                    "question": "Toute analyse de risque doit √™tre document√©e et trac√©e.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - La tra√ßabilit√© est essentielle pour le suivi et l'am√©lioration.",
                    "timeLimit": 30,
                    "points": 80
                }
            ]
        ]
    },
    {
        "title": "Projets & Travaux",
        "subtitle": "Suivi et coordination",
        "icon": "üèóÔ∏è",
        "color": "from-indigo-500 to-purple-600",
        "games": [
            [
                {
                    "type": "sequence",
                    "title": "Phases Projet",
                    "question": "Phases d'un projet de s√©curit√© :",
                    "items": [
                        "Cadrage et faisabilit√©",
                        "Conception et planification",
                        "R√©alisation et suivi",
                        "R√©ception et bilan"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Travaux ERP",
                    "question": "Proc√©dure pour des travaux modifiant la s√©curit√© :",
                    "items": [
                        "Demande d'autorisation pr√©alable",
                        "Instruction par la commission",
                        "Autorisation du maire",
                        "R√©alisation et r√©ception"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Permis de Feu",
                    "question": "D√©livrance d'un permis de feu :",
                    "items": [
                        "Analyse des risques du chantier",
                        "D√©finition des mesures de pr√©vention",
                        "D√©livrance et signature du permis",
                        "Surveillance et ronde post-travaux"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "R√©ception Travaux",
                    "question": "R√©ception de travaux de s√©curit√© :",
                    "items": [
                        "V√©rification de la conformit√©",
                        "Tests de fonctionnement",
                        "Lev√©e des r√©serves",
                        "Validation commission de s√©curit√©"
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "sequence",
                    "title": "Installation SSI",
                    "question": "Installation d'un nouveau SSI :",
                    "items": [
                        "D√©finition du cahier des charges",
                        "Consultation des entreprises",
                        "R√©alisation et tests",
                        "Formation du personnel"
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "quiz",
                    "title": "R√¥le SSIAP 3",
                    "question": "Pour les travaux, le SSIAP 3 doit :",
                    "options": [
                        "Conseiller, contr√¥ler et coordonner la s√©curit√©",
                        "R√©aliser les travaux lui-m√™me",
                        "Ne rien faire",
                        "Uniquement observer"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Plan Pr√©vention",
                    "question": "Un plan de pr√©vention est obligatoire quand :",
                    "options": [
                        "Des entreprises ext√©rieures interviennent",
                        "Jamais",
                        "Uniquement pour les gros chantiers",
                        "Uniquement en IGH"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "PPSPS",
                    "question": "Le PPSPS (Plan Particulier de S√©curit√© et de Protection de la Sant√©) est √©tabli par :",
                    "options": [
                        "L'entreprise r√©alisant les travaux",
                        "Le SSIAP 3",
                        "Le maire",
                        "La commission de s√©curit√©"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Coordination",
                    "question": "Le coordinateur SPS (S√©curit√© et Protection de la Sant√©) est obligatoire :",
                    "options": [
                        "D√®s que plusieurs entreprises interviennent",
                        "Jamais",
                        "Uniquement en construction neuve",
                        "Uniquement en r√©novation"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Suivi Chantier",
                    "question": "Pendant les travaux, le SSIAP 3 doit :",
                    "options": [
                        "Visiter le chantier et v√©rifier les mesures de s√©curit√©",
                        "Rester au PC s√©curit√©",
                        "Partir en vacances",
                        "Ne pas s'en occuper"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "DOE",
                    "question": "Le DOE (Dossier des Ouvrages Ex√©cut√©s) contient :",
                    "options": [
                        "Plans conformes, notices, certificats",
                        "Uniquement les factures",
                        "Rien d'important",
                        "Le planning"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "Acteurs Projet",
                    "question": "Qui intervient dans un projet de s√©curit√© ? (Plusieurs r√©ponses)",
                    "options": [
                        "Ma√Ætre d'ouvrage (client)",
                        "Ma√Ætre d'≈ìuvre (architecte/bureau √©tudes)",
                        "Bureau de contr√¥le",
                        "Entreprises r√©alisatrices",
                        "Les passants"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Documents Projet",
                    "question": "Quels documents sont n√©cessaires pour un projet ? (Plusieurs r√©ponses)",
                    "options": [
                        "Cahier des charges",
                        "Plans d'ex√©cution",
                        "Planning",
                        "Budget pr√©visionnel",
                        "Menu du restaurant"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Autorisations",
                    "question": "Quels travaux n√©cessitent autorisation commission ? (Plusieurs r√©ponses)",
                    "options": [
                        "Modification des d√©gagements",
                        "Installation nouveau SSI",
                        "Changement de destination",
                        "Augmentation de l'effectif",
                        "Changement d'ampoule"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Contr√¥les R√©ception",
                    "question": "√Ä la r√©ception, on contr√¥le : (Plusieurs r√©ponses)",
                    "options": [
                        "La conformit√© aux plans",
                        "Le fonctionnement des √©quipements",
                        "La finition des travaux",
                        "La documentation technique",
                        "La couleur pr√©f√©r√©e du maire"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Mesures Chantier",
                    "question": "Mesures de s√©curit√© sur un chantier : (Plusieurs r√©ponses)",
                    "options": [
                        "Balisage et signalisation",
                        "Extincteurs √† disposition",
                        "Surveillance des travaux",
                        "Permis de feu si n√©cessaire",
                        "Aucune mesure"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ]
        ]
    },
    {
        "title": "Communication",
        "subtitle": "Relations internes et externes",
        "icon": "üìû",
        "color": "from-purple-500 to-pink-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Communication",
                    "question": "Une communication efficace est :",
                    "options": [
                        "Claire, concise, adapt√©e √† l'interlocuteur",
                        "Floue et confuse",
                        "Toujours technique",
                        "Inutile"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Rapport",
                    "question": "Un rapport √©crit doit √™tre :",
                    "options": [
                        "Structur√©, factuel et synth√©tique",
                        "Tr√®s long et incompr√©hensible",
                        "√âcrit en langage SMS",
                        "Oral uniquement"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "R√©union",
                    "question": "Pour r√©ussir une r√©union, il faut :",
                    "options": [
                        "Un ordre du jour, une pr√©paration, une animation",
                        "Improviser totalement",
                        "Parler de sujets hors-sujet",
                        "Ne jamais conclure"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Conflit",
                    "question": "Face √† un conflit avec un partenaire externe, il faut :",
                    "options": [
                        "√âcouter, chercher des solutions, garder le dialogue",
                        "Couper tout contact",
                        "S'√©nerver imm√©diatement",
                        "Ignorer le probl√®me"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Sensibilisation",
                    "question": "Pour sensibiliser le personnel, le chef de service peut utiliser :",
                    "options": [
                        "R√©unions, affiches, exercices, formations",
                        "Uniquement des emails",
                        "Rien",
                        "La peur et les menaces"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Compte-rendu",
                    "question": "Un compte-rendu de r√©union doit √™tre diffus√© :",
                    "options": [
                        "Rapidement apr√®s la r√©union",
                        "6 mois apr√®s",
                        "Jamais",
                        "Uniquement √† soi-m√™me"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 40,
                    "points": 100
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Partenaires Externes",
                    "question": "Associez le partenaire avec son r√¥le :",
                    "pairs": [
                        {
                            "left": "SDIS",
                            "right": "Secours et conseil"
                        },
                        {
                            "left": "Mairie",
                            "right": "Autorit√© administrative"
                        },
                        {
                            "left": "Bureau de contr√¥le",
                            "right": "V√©rification technique"
                        },
                        {
                            "left": "Assureur",
                            "right": "Gestion des risques"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Types Communication",
                    "question": "Associez le type avec sa caract√©ristique :",
                    "pairs": [
                        {
                            "left": "Descendante",
                            "right": "Direction vers √©quipe"
                        },
                        {
                            "left": "Ascendante",
                            "right": "√âquipe vers direction"
                        },
                        {
                            "left": "Horizontale",
                            "right": "Entre coll√®gues"
                        },
                        {
                            "left": "Externe",
                            "right": "Vers partenaires"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Outils Communication",
                    "question": "Associez l'outil avec son usage :",
                    "pairs": [
                        {
                            "left": "Note de service",
                            "right": "Information officielle"
                        },
                        {
                            "left": "Affichage",
                            "right": "Information visible"
                        },
                        {
                            "left": "Email",
                            "right": "Communication rapide"
                        },
                        {
                            "left": "R√©union",
                            "right": "√âchange et d√©cision"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Situations Communication",
                    "question": "Associez la situation avec le mode :",
                    "pairs": [
                        {
                            "left": "Urgence",
                            "right": "Oral direct"
                        },
                        {
                            "left": "Consigne durable",
                            "right": "√âcrit"
                        },
                        {
                            "left": "Brainstorming",
                            "right": "R√©union"
                        },
                        {
                            "left": "Information simple",
                            "right": "Email"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Relations Hi√©rarchiques",
                    "question": "Associez le niveau avec sa communication :",
                    "pairs": [
                        {
                            "left": "Direction g√©n√©rale",
                            "right": "Strat√©gie et d√©cisions"
                        },
                        {
                            "left": "Chef de service",
                            "right": "Organisation et coordination"
                        },
                        {
                            "left": "Chef d'√©quipe",
                            "right": "Animation quotidienne"
                        },
                        {
                            "left": "Agents",
                            "right": "Remont√©e terrain"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ],
            [
                {
                    "type": "true-false",
                    "title": "√âcoute Active",
                    "question": "L'√©coute active am√©liore la qualit√© des relations professionnelles.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - √âcouter activement favorise la compr√©hension et la confiance.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Transparence",
                    "question": "La transparence dans la communication renforce la cr√©dibilit√©.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - √ätre transparent et honn√™te cr√©e la confiance.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "R√©seau",
                    "question": "D√©velopper son r√©seau professionnel est utile pour le chef de service.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le r√©seau permet d'√©changer et de trouver des solutions.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Feedback",
                    "question": "Donner un feedback constructif aide les collaborateurs √† progresser.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Le retour constructif permet l'am√©lioration continue.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "N√©gociation",
                    "question": "La n√©gociation fait partie des comp√©tences du chef de service.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Il doit n√©gocier budgets, contrats, plannings, etc.",
                    "timeLimit": 30,
                    "points": 80
                },
                {
                    "type": "true-false",
                    "title": "Gestion Crise Communication",
                    "question": "En situation de crise, la communication doit √™tre rapide et coordonn√©e.",
                    "options": [
                        "Vrai",
                        "Faux"
                    ],
                    "correctAnswer": 0,
                    "explanation": "VRAI - Une bonne communication de crise √©vite la d√©sinformation.",
                    "timeLimit": 30,
                    "points": 80
                }
            ]
        ]
    },
    {
        "title": "Strat√©gie",
        "subtitle": "Vision et objectifs",
        "icon": "üéØ",
        "color": "from-pink-500 to-red-600",
        "games": [
            [
                {
                    "type": "quiz",
                    "title": "Strat√©gie",
                    "question": "La strat√©gie du service de s√©curit√© doit √™tre :",
                    "options": [
                        "Align√©e avec les objectifs de l'√©tablissement",
                        "Compl√®tement diff√©rente",
                        "Inexistante",
                        "Secr√®te"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Objectifs SMART",
                    "question": "Un objectif SMART est :",
                    "options": [
                        "Sp√©cifique, Mesurable, Atteignable, R√©aliste, Temporel",
                        "Simple, Motivant, Al√©atoire, Rapide, Technique",
                        "Secret, Multiple, Ambitieux, Risqu√©, Temporaire",
                        "Sans importance"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Tableau de Bord",
                    "question": "Un tableau de bord permet de :",
                    "options": [
                        "Suivre les indicateurs et piloter l'activit√©",
                        "D√©corer le bureau",
                        "Rien du tout",
                        "Faire peur aux agents"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Am√©lioration Continue",
                    "question": "La d√©marche d'am√©lioration continue (PDCA) signifie :",
                    "options": [
                        "Plan Do Check Act (Planifier, Faire, V√©rifier, Agir)",
                        "Pas De Contr√¥le Annuel",
                        "Planifier Difficilement Chaque Action",
                        "Rien"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 50,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Veille",
                    "question": "La veille r√©glementaire permet de :",
                    "options": [
                        "Se tenir inform√© des √©volutions l√©gales",
                        "Surveiller les concurrents",
                        "Espionner les agents",
                        "Dormir au travail"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                },
                {
                    "type": "quiz",
                    "title": "Innovation",
                    "question": "L'innovation dans le service de s√©curit√© peut porter sur :",
                    "options": [
                        "Les technologies, les m√©thodes, l'organisation",
                        "Uniquement la d√©coration",
                        "Rien, c'est inutile",
                        "Uniquement les uniformes"
                    ],
                    "correctAnswer": 0,
                    "timeLimit": 45,
                    "points": 100
                }
            ],
            [
                {
                    "type": "quiz-multi",
                    "title": "Indicateurs Performance",
                    "question": "Quels indicateurs pour piloter un service de s√©curit√© ? (Plusieurs r√©ponses)",
                    "options": [
                        "Nombre d'interventions",
                        "Temps de r√©action",
                        "Taux de disponibilit√© des √©quipements",
                        "Satisfaction des utilisateurs",
                        "Couleur des uniformes"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Plan d'Action",
                    "question": "Un plan d'action efficace contient : (Plusieurs r√©ponses)",
                    "options": [
                        "Des objectifs clairs",
                        "Des actions concr√®tes",
                        "Des responsables identifi√©s",
                        "Des √©ch√©ances pr√©cises",
                        "Aucune structure"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Axes Strat√©giques",
                    "question": "Les axes strat√©giques d'un service de s√©curit√© : (Plusieurs r√©ponses)",
                    "options": [
                        "Performance op√©rationnelle",
                        "D√©veloppement des comp√©tences",
                        "Optimisation des ressources",
                        "Innovation technologique",
                        "Esth√©tique du PC s√©curit√©"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Management Qualit√©",
                    "question": "Une d√©marche qualit√© implique : (Plusieurs r√©ponses)",
                    "options": [
                        "D√©finir des proc√©dures",
                        "Former le personnel",
                        "Mesurer et analyser",
                        "S'am√©liorer en continu",
                        "Ne rien changer"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                },
                {
                    "type": "quiz-multi",
                    "title": "Enjeux Strat√©giques",
                    "question": "Les enjeux strat√©giques du chef de service : (Plusieurs r√©ponses)",
                    "options": [
                        "Garantir la s√©curit√©",
                        "Optimiser les co√ªts",
                        "D√©velopper son √©quipe",
                        "Anticiper les √©volutions",
                        "Ignorer l'avenir"
                    ],
                    "correctAnswers": [
                        0,
                        1,
                        2,
                        3
                    ],
                    "timeLimit": 60,
                    "points": 150
                }
            ],
            [
                {
                    "type": "matching",
                    "title": "Outils Strat√©giques",
                    "question": "Associez l'outil avec son usage :",
                    "pairs": [
                        {
                            "left": "SWOT",
                            "right": "Analyse forces/faiblesses"
                        },
                        {
                            "left": "PESTEL",
                            "right": "Analyse environnement"
                        },
                        {
                            "left": "Benchmarking",
                            "right": "Comparaison meilleures pratiques"
                        },
                        {
                            "left": "Plan strat√©gique",
                            "right": "D√©finir la vision 3-5 ans"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Types Objectifs",
                    "question": "Associez l'objectif avec son horizon :",
                    "pairs": [
                        {
                            "left": "Strat√©gique",
                            "right": "Long terme (3-5 ans)"
                        },
                        {
                            "left": "Tactique",
                            "right": "Moyen terme (1 an)"
                        },
                        {
                            "left": "Op√©rationnel",
                            "right": "Court terme (quotidien)"
                        },
                        {
                            "left": "Vision",
                            "right": "Tr√®s long terme (10 ans)"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Niveaux Management",
                    "question": "Associez le niveau avec sa focale :",
                    "pairs": [
                        {
                            "left": "Strat√©gique",
                            "right": "Vision et orientation"
                        },
                        {
                            "left": "Tactique",
                            "right": "Organisation et moyens"
                        },
                        {
                            "left": "Op√©rationnel",
                            "right": "Ex√©cution quotidienne"
                        },
                        {
                            "left": "Normatif",
                            "right": "Valeurs et culture"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "D√©marches Qualit√©",
                    "question": "Associez la d√©marche avec son principe :",
                    "pairs": [
                        {
                            "left": "ISO 9001",
                            "right": "Management qualit√©"
                        },
                        {
                            "left": "Lean",
                            "right": "√âlimination gaspillages"
                        },
                        {
                            "left": "Six Sigma",
                            "right": "R√©duction variabilit√©"
                        },
                        {
                            "left": "Kaizen",
                            "right": "Am√©lioration continue"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                },
                {
                    "type": "matching",
                    "title": "Facteurs Succ√®s",
                    "question": "Associez le facteur avec son importance :",
                    "pairs": [
                        {
                            "left": "Leadership",
                            "right": "Donner la direction"
                        },
                        {
                            "left": "Comp√©tences",
                            "right": "Savoir-faire"
                        },
                        {
                            "left": "Ressources",
                            "right": "Moyens"
                        },
                        {
                            "left": "Culture",
                            "right": "√âtat d'esprit"
                        }
                    ],
                    "timeLimit": 60,
                    "points": 120
                }
            ]
        ]
    }
]
};

// Variables globales pour le niveau s√©lectionn√©
let currentLevel = 1; // Niveau s√©lectionn√© par d√©faut
let boxesData = BOXES_DATA_BY_LEVEL[1];

// Fonction de s√©lection de niveau
function selectLevel(level) {
    currentLevel = level;
    // Pas besoin de CORRECT_PASSWORD_HASH, l'authentification est d√©j√† faite
    boxesData = BOXES_DATA_BY_LEVEL[level];

    // Mettre √† jour les titres
    const titles = {
        1: { title: 'SSIAP 1', subtitle: 'Agent de S√©curit√© Incendie', icon: 'üë®‚Äçüöí' },
        2: { title: 'SSIAP 2', subtitle: 'Chef d\'√âquipe', icon: 'üë®‚Äç‚úàÔ∏è' },
        3: { title: 'SSIAP 3', subtitle: 'Chef de Service', icon: 'üëî' }
    };

    const selectedTitle = titles[level];

    // Mettre √† jour les titres si les √©l√©ments existent
    const loginTitle = document.getElementById('login-title');
    if (loginTitle) {
        loginTitle.textContent = `Challenge Cup ${selectedTitle.title}`;
    }

    // Changer aussi le titre de la page
    document.title = `Challenge Cup ${selectedTitle.title} - ${selectedTitle.subtitle}`;

    // Jouer un son
    playSound('tick');

    // Afficher l'√©cran de connexion (Superviseur/Joueur)
    showLevelScreen('login-screen');
}

// Initialiser l'√©cran de s√©lection et les event listeners
window.addEventListener('DOMContentLoaded', () => {
    // Afficher l'√©cran d'authentification au d√©marrage
    showLevelScreen('auth-screen');

    // G√©rer les clics sur les cartes de niveau
    document.querySelectorAll('.level-card').forEach(card => {
        card.addEventListener('click', () => {
            const level = parseInt(card.dataset.level);
            selectLevel(level);
        });
    });
});

// Variable globale pour l'authentification (en m√©moire uniquement)
let isUserAuthenticated = false;

// V√©rifier si l'utilisateur est d√©j√† authentifi√©
function checkAuthentication() {
    if (isUserAuthenticated) {
        // L'utilisateur est d√©j√† authentifi√©
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('login-screen').classList.remove('hidden');
        return true;
    } else {
        // L'utilisateur doit s'authentifier
        document.getElementById('auth-screen').classList.remove('hidden');
        document.getElementById('login-screen').classList.add('hidden');
        return false;
    }
}

// G√©rer le formulaire d'authentification
document.getElementById('auth-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const passwordInput = document.getElementById('auth-password');
    const errorDiv = document.getElementById('auth-error');
    const password = passwordInput.value;

    // V√©rifier le mot de passe
    const hashedInput = await hashPassword(password);

    if (hashedInput === MASTER_PASSWORD_HASH) {
        // Mot de passe correct !
        isUserAuthenticated = true;

        // Animation de succ√®s
        errorDiv.classList.add('hidden');
        passwordInput.classList.remove('border-red-500');
        passwordInput.classList.add('border-green-500');

        // Transition vers l'√©cran de s√©lection du niveau
        setTimeout(() => {
            showLevelScreen('level-selection-screen');
        }, 300);
    } else {
        // Mot de passe incorrect
        errorDiv.classList.remove('hidden');
        passwordInput.classList.add('border-red-500');
        passwordInput.value = '';
        passwordInput.focus();

        // Shake animation
        passwordInput.classList.add('shake');
        setTimeout(() => {
            passwordInput.classList.remove('shake');
        }, 500);
    }
});

// L'authentification est maintenant g√©r√©e par selectLevel() apr√®s la s√©lection du niveau
// document.addEventListener('DOMContentLoaded', () => {
//     checkAuthentication();
// });

// ==================== CONFIGURATION FIREBASE ====================

const firebaseConfig = {
  apiKey: "AIzaSyAZLBDZIaPp3GrXuVz4fPiK91JhLEqXPs0",
  authDomain: "jeu-sst-v1-291025.firebaseapp.com",
  databaseURL: "https://jeu-sst-v1-291025-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "jeu-sst-v1-291025",
  storageBucket: "jeu-sst-v1-291025.firebasestorage.app",
  messagingSenderId: "57462613537",
  appId: "1:57462613537:web:6178195b2f4f08fbaa2560"
};

// Initialiser Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// ==================== SYST√àME MULTIJOUEUR ====================

// ID unique pour cette session
const sessionId = 'team_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

// √âtat global du mode
let appMode = 'login'; // 'login', 'supervisor', 'player'
let currentTeamName = '';

// Stockage des √©quipes (pour le superviseur)
let teams = {};

// Audio Context pour les sons
const audioContext = new (window.AudioContext || window.webkitAudioContext)();

// ==================== SONS AM√âLIOR√âS ====================

function playSound(type, frequency = null) {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);

    switch(type) {
        case 'success':
            // Son de r√©ussite enjou√© (mont√©e joyeuse)
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
            oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.6);
            break;
        case 'bravo':
            // Son de bravo triomphant (fanfare courte)
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.08);
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.16);
            oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.24);
            oscillator.frequency.setValueAtTime(1318.51, audioContext.currentTime + 0.32);
            gainNode.gain.setValueAtTime(0.35, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.8);
            break;
        case 'error':
            // Son d'erreur descendant
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(100, audioContext.currentTime + 0.2);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.4);
            break;
        case 'wrong':
            // Son d'√©chec (plus doux que error)
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(250, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.15);
            gainNode.gain.setValueAtTime(0.25, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
            break;
        case 'tick':
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.05);
            break;
        case 'unlock':
            // Son de d√©verrouillage majestueux
            oscillator.type = 'triangle';
            const baseFreq = frequency || 400;
            oscillator.frequency.setValueAtTime(baseFreq, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(baseFreq * 1.25, audioContext.currentTime + 0.15);
            oscillator.frequency.setValueAtTime(baseFreq * 1.5, audioContext.currentTime + 0.3);
            oscillator.frequency.setValueAtTime(baseFreq * 2, audioContext.currentTime + 0.45);
            gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.8);
            break;
        case 'complete':
            // Son de victoire finale √©pique
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.12);
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.24);
            oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.36);
            oscillator.frequency.setValueAtTime(1318.51, audioContext.currentTime + 0.48);
            gainNode.gain.setValueAtTime(0.35, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 1);
            break;
        case 'countdown':
            // Son de compte √† rebours (urgent)
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
            break;
    }
}

// Fr√©quences pour chaque coffre (pour des sons uniques)
const boxSoundFrequencies = [300, 350, 400, 450, 500, 550, 600, 650];

// ==================== MUSIQUE DE FOND ====================
// Musique supprim√©e √† la demande de l'utilisateur (g√™nante en multi-joueurs)

// ==================== ILLUSTRATIONS SVG PROC√âDURES SST ====================

// Illustration RCP - Position des mains pour massage cardiaque
function getRCPHandsSVG() {
    return `
        <svg viewBox="0 0 300 400" class="w-full h-auto max-w-md mx-auto">
            <!-- Corps de la victime -->
            <ellipse cx="150" cy="180" rx="90" ry="140" fill="#FFE4C4" stroke="#8B4513" stroke-width="2"/>
            <!-- T√™te -->
            <circle cx="150" cy="60" r="35" fill="#FFD7A6" stroke="#8B4513" stroke-width="2"/>
            <!-- Cou -->
            <rect x="135" y="90" width="30" height="20" fill="#FFE4C4"/>
            <!-- Sternum (zone de compression) -->
            <rect x="120" y="150" width="60" height="80" fill="#FF6B6B" opacity="0.3" stroke="#FF0000" stroke-width="2" stroke-dasharray="5,5"/>
            <text x="150" y="195" text-anchor="middle" fill="#FF0000" font-size="14" font-weight="bold">STERNUM</text>
            <!-- Main 1 (en bas) -->
            <rect x="110" y="175" width="80" height="25" rx="3" fill="#87CEEB" stroke="#4682B4" stroke-width="2"/>
            <text x="150" y="192" text-anchor="middle" fill="#000" font-size="12" font-weight="bold">MAIN 1</text>
            <!-- Main 2 (au dessus) -->
            <rect x="110" y="145" width="80" height="25" rx="3" fill="#98D8E8" stroke="#4682B4" stroke-width="2"/>
            <text x="150" y="162" text-anchor="middle" fill="#000" font-size="12" font-weight="bold">MAIN 2</text>
            <!-- Fl√®ches de compression -->
            <path d="M 150 130 L 150 145" stroke="#FF0000" stroke-width="3" marker-end="url(#arrowhead)"/>
            <path d="M 170 130 L 170 145" stroke="#FF0000" stroke-width="3" marker-end="url(#arrowhead)"/>
            <path d="M 130 130 L 130 145" stroke="#FF0000" stroke-width="3" marker-end="url(#arrowhead)"/>
            <text x="150" y="120" text-anchor="middle" fill="#FF0000" font-size="16" font-weight="bold">‚Üì 5-6 cm ‚Üì</text>
            <!-- L√©gende -->
            <text x="150" y="340" text-anchor="middle" fill="#333" font-size="14" font-weight="bold">Position des mains au centre du thorax</text>
            <text x="150" y="360" text-anchor="middle" fill="#666" font-size="12">Bras tendus, 100-120 compressions/min</text>
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                    <polygon points="0 0, 10 5, 0 10" fill="#FF0000"/>
                </marker>
            </defs>
        </svg>
    `;
}

// Illustration PLS - Position Lat√©rale de S√©curit√©
function getPLSSVG() {
    return `
        <svg viewBox="0 0 400 250" class="w-full h-auto max-w-lg mx-auto">
            <!-- Sol -->
            <rect x="0" y="200" width="400" height="50" fill="#D2B48C" opacity="0.3"/>
            <!-- Corps en PLS -->
            <ellipse cx="200" cy="160" rx="110" ry="35" fill="#FFE4C4" stroke="#8B4513" stroke-width="2" transform="rotate(-10 200 160)"/>
            <!-- T√™te -->
            <circle cx="150" cy="130" r="30" fill="#FFD7A6" stroke="#8B4513" stroke-width="2"/>
            <!-- Bras du dessus (pli√©) -->
            <path d="M 230 150 Q 250 120 240 100" stroke="#FFE4C4" stroke-width="20" fill="none" stroke-linecap="round"/>
            <!-- Main sous la joue -->
            <ellipse cx="145" cy="125" rx="15" ry="20" fill="#FFDAB9" stroke="#8B4513" stroke-width="1"/>
            <!-- Jambe du dessus (pli√©e √† 90¬∞) -->
            <path d="M 220 180 L 220 220 L 270 220" stroke="#87CEEB" stroke-width="25" fill="none" stroke-linecap="round"/>
            <!-- Jambe du dessous (tendue) -->
            <path d="M 200 180 L 200 230" stroke="#6A9FB5" stroke-width="22" fill="none" stroke-linecap="round"/>
            <!-- Fl√®ches et annotations -->
            <text x="145" y="110" text-anchor="middle" fill="#FF0000" font-size="12" font-weight="bold">Main sous joue</text>
            <path d="M 145 115 L 145 122" stroke="#FF0000" stroke-width="2" marker-end="url(#arrowred)"/>
            <text x="280" y="210" text-anchor="start" fill="#0066CC" font-size="12" font-weight="bold">Jambe √† 90¬∞</text>
            <path d="M 270 215 L 250 220" stroke="#0066CC" stroke-width="2" marker-end="url(#arrowblue)"/>
            <!-- Titre -->
            <text x="200" y="30" text-anchor="middle" fill="#333" font-size="18" font-weight="bold">Position Lat√©rale de S√©curit√© (PLS)</text>
            <text x="200" y="50" text-anchor="middle" fill="#666" font-size="12">Victime inconsciente qui respire</text>
            <defs>
                <marker id="arrowred" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                    <polygon points="0 0, 10 5, 0 10" fill="#FF0000"/>
                </marker>
                <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                    <polygon points="0 0, 10 5, 0 10" fill="#0066CC"/>
                </marker>
            </defs>
        </svg>
    `;
}

// Illustration Heimlich - Compressions abdominales
function getHeimlichSVG() {
    return `
        <svg viewBox="0 0 300 400" class="w-full h-auto max-w-md mx-auto">
            <!-- Victime (vue de dos) -->
            <ellipse cx="150" cy="200" rx="70" ry="120" fill="#FFE4C4" stroke="#8B4513" stroke-width="2"/>
            <!-- T√™te -->
            <circle cx="150" cy="80" r="30" fill="#8B4513"/>
            <!-- Cou -->
            <rect x="135" y="105" width="30" height="20" fill="#FFE4C4"/>
            <!-- √âpaules -->
            <ellipse cx="150" cy="140" rx="85" ry="25" fill="#87CEEB"/>
            <!-- Bras du sauveteur -->
            <path d="M 70 180 Q 110 190 130 210" stroke="#98D8E8" stroke-width="22" fill="none" stroke-linecap="round"/>
            <path d="M 230 180 Q 190 190 170 210" stroke="#98D8E8" stroke-width="22" fill="none" stroke-linecap="round"/>
            <!-- Mains enlac√©es -->
            <circle cx="150" cy="220" r="25" fill="#FFDAB9" stroke="#8B4513" stroke-width="2"/>
            <text x="150" y="227" text-anchor="middle" fill="#000" font-size="12" font-weight="bold">POING</text>
            <!-- Zone de compression -->
            <ellipse cx="150" cy="220" rx="50" ry="35" fill="none" stroke="#FF0000" stroke-width="3" stroke-dasharray="5,5"/>
            <text x="150" y="260" text-anchor="middle" fill="#FF0000" font-size="11" font-weight="bold">Entre nombril et sternum</text>
            <!-- Fl√®che de compression -->
            <path d="M 150 185 L 150 195" stroke="#FF0000" stroke-width="4" marker-end="url(#arrowhead2)"/>
            <text x="150" y="175" text-anchor="middle" fill="#FF0000" font-size="14" font-weight="bold">‚Üë TIRER VERS SOI ‚Üë</text>
            <!-- Nombril (rep√®re) -->
            <circle cx="150" cy="250" r="5" fill="#8B4513"/>
            <text x="180" y="255" fill="#666" font-size="10">Nombril</text>
            <!-- Titre -->
            <text x="150" y="30" text-anchor="middle" fill="#333" font-size="16" font-weight="bold">M√©thode de Heimlich</text>
            <text x="150" y="50" text-anchor="middle" fill="#666" font-size="11">Compressions abdominales (obstruction totale)</text>
            <!-- Instructions -->
            <text x="150" y="340" text-anchor="middle" fill="#333" font-size="11">1. Poing entre nombril et sternum</text>
            <text x="150" y="360" text-anchor="middle" fill="#333" font-size="11">2. Tirer franchement vers soi et vers le haut</text>
            <text x="150" y="380" text-anchor="middle" fill="#333" font-size="11">3. R√©p√©ter jusqu'√† expulsion du corps √©tranger</text>
            <defs>
                <marker id="arrowhead2" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                    <polygon points="0 0, 10 5, 0 10" fill="#FF0000"/>
                </marker>
            </defs>
        </svg>
    `;
}

// Illustration compression h√©morragie
function getCompressionSVG() {
    return `
        <svg viewBox="0 0 300 350" class="w-full h-auto max-w-md mx-auto">
            <!-- Bras bless√© -->
            <rect x="80" y="150" width="140" height="50" rx="25" fill="#FFE4C4" stroke="#8B4513" stroke-width="2"/>
            <!-- Plaie / h√©morragie -->
            <ellipse cx="150" cy="175" rx="30" ry="20" fill="#8B0000" opacity="0.7"/>
            <circle cx="140" cy="170" r="8" fill="#FF0000" opacity="0.8"/>
            <circle cx="160" cy="180" r="6" fill="#FF0000" opacity="0.8"/>
            <circle cx="150" cy="185" r="5" fill="#8B0000" opacity="0.9"/>
            <!-- Sang qui coule -->
            <path d="M 145 190 Q 140 210 138 230" stroke="#8B0000" stroke-width="4" opacity="0.6"/>
            <path d="M 155 192 Q 158 210 160 230" stroke="#8B0000" stroke-width="3" opacity="0.6"/>
            <!-- Main avec gant (compression) -->
            <ellipse cx="150" cy="175" rx="45" ry="35" fill="#87CEEB" opacity="0.9" stroke="#4682B4" stroke-width="2"/>
            <text x="150" y="180" text-anchor="middle" fill="#FFF" font-size="13" font-weight="bold">MAIN GANT√âE</text>
            <!-- Gant (d√©tail) -->
            <rect x="130" y="90" width="40" height="50" rx="5" fill="#87CEEB" stroke="#4682B4" stroke-width="2"/>
            <text x="150" y="120" text-anchor="middle" fill="#000" font-size="10" font-weight="bold">Gant</text>
            <path d="M 150 140 L 150 155" stroke="#4682B4" stroke-width="2" stroke-dasharray="3,3"/>
            <!-- Fl√®ches de pression -->
            <path d="M 120 175 L 130 175" stroke="#FF0000" stroke-width="3" marker-end="url(#arrowhead3)"/>
            <path d="M 180 175 L 170 175" stroke="#FF0000" stroke-width="3" marker-end="url(#arrowhead3)"/>
            <text x="90" y="180" fill="#FF0000" font-size="14" font-weight="bold">‚Üí</text>
            <text x="205" y="180" fill="#FF0000" font-size="14" font-weight="bold">‚Üê</text>
            <text x="150" y="250" text-anchor="middle" fill="#FF0000" font-size="13" font-weight="bold">COMPRESSION DIRECTE</text>
            <!-- Titre -->
            <text x="150" y="30" text-anchor="middle" fill="#333" font-size="16" font-weight="bold">Arr√™t d'une h√©morragie externe</text>
            <text x="150" y="50" text-anchor="middle" fill="#666" font-size="11">Compression directe avec protection</text>
            <!-- Instructions -->
            <text x="150" y="290" text-anchor="middle" fill="#333" font-size="11">1. Prot√©ger ses mains (gants, sac plastique...)</text>
            <text x="150" y="310" text-anchor="middle" fill="#333" font-size="11">2. Comprimer fermement sur la plaie</text>
            <text x="150" y="330" text-anchor="middle" fill="#333" font-size="11">3. Maintenir jusqu'√† l'arriv√©e des secours</text>
            <defs>
                <marker id="arrowhead3" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                    <polygon points="0 0, 10 5, 0 10" fill="#FF0000"/>
                </marker>
            </defs>
        </svg>
    `;
}

// Illustration Lib√©ration des Voies A√©riennes (LVA)
function getLVASVG() {
    return `
        <svg viewBox="0 0 350 300" class="w-full h-auto max-w-lg mx-auto">
            <!-- T√™te de profil -->
            <ellipse cx="180" cy="120" rx="50" ry="60" fill="#FFD7A6" stroke="#8B4513" stroke-width="2"/>
            <!-- Nez -->
            <path d="M 220 110 L 235 120 L 225 125" fill="#FFB380" stroke="#8B4513" stroke-width="1"/>
            <!-- Bouche -->
            <ellipse cx="215" cy="140" rx="8" ry="5" fill="#FF6B8A"/>
            <!-- Menton -->
            <ellipse cx="200" cy="165" rx="25" ry="20" fill="#FFD7A6" stroke="#8B4513" stroke-width="2"/>
            <!-- Cou -->
            <rect x="160" y="175" width="35" height="50" fill="#FFE4C4" stroke="#8B4513" stroke-width="1"/>
            <!-- Main sous le menton -->
            <ellipse cx="215" cy="165" rx="25" ry="18" fill="#FFDAB9" stroke="#8B4513" stroke-width="2" transform="rotate(25 215 165)"/>
            <text x="250" y="170" fill="#0066CC" font-size="11" font-weight="bold">Main sous menton</text>
            <!-- Main sur le front -->
            <ellipse cx="160" cy="95" rx="28" ry="20" fill="#FFDAB9" stroke="#8B4513" stroke-width="2" transform="rotate(-15 160 95)"/>
            <text x="90" y="90" fill="#0066CC" font-size="11" font-weight="bold">Main sur front ‚Üí</text>
            <!-- Voies a√©riennes (sch√©ma interne) -->
            <path d="M 210 145 Q 200 160 195 180 L 195 220" stroke="#FF6B6B" stroke-width="4" fill="none" opacity="0.6"/>
            <text x="210" y="200" fill="#FF0000" font-size="10" font-weight="bold">Voies a√©riennes</text>
            <text x="210" y="215" fill="#FF0000" font-size="10" font-weight="bold">d√©gag√©es ‚úì</text>
            <!-- Fl√®ches de basculement -->
            <path d="M 180 80 Q 190 75 200 80" stroke="#FF0000" stroke-width="3" fill="none" marker-end="url(#arrowhead4)"/>
            <text x="180" y="65" fill="#FF0000" font-size="12" font-weight="bold">BASCULER</text>
            <path d="M 230 155 Q 235 150 240 155" stroke="#0066CC" stroke-width="3" fill="none" marker-end="url(#arrowblue2)"/>
            <text x="245" y="150" fill="#0066CC" font-size="12" font-weight="bold">SOULEVER</text>
            <!-- Titre -->
            <text x="175" y="30" text-anchor="middle" fill="#333" font-size="16" font-weight="bold">Lib√©ration des Voies A√©riennes (LVA)</text>
            <text x="175" y="50" text-anchor="middle" fill="#666" font-size="11">Basculer la t√™te en arri√®re pour d√©gager les voies a√©riennes</text>
            <!-- Instructions -->
            <text x="175" y="270" text-anchor="middle" fill="#333" font-size="11" font-weight="bold">Une main sur le front + Une main sous le menton</text>
            <defs>
                <marker id="arrowhead4" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                    <polygon points="0 0, 10 5, 0 10" fill="#FF0000"/>
                </marker>
                <marker id="arrowblue2" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                    <polygon points="0 0, 10 5, 0 10" fill="#0066CC"/>
                </marker>
            </defs>
        </svg>
    `;
}

// Illustration Triangle de signalisation
function getTriangleSVG() {
    return `
        <svg viewBox="0 0 300 350" class="w-full h-auto max-w-sm mx-auto">
            <!-- Route -->
            <rect x="0" y="250" width="300" height="100" fill="#555"/>
            <rect x="140" y="250" width="20" height="100" fill="#FFF" opacity="0.8"/>
            <rect x="140" y="270" width="20" height="20" fill="none"/>
            <rect x="140" y="310" width="20" height="20" fill="none"/>
            <!-- Distance 30m -->
            <line x1="150" y1="240" x2="250" y2="240" stroke="#FFD700" stroke-width="3" stroke-dasharray="5,5"/>
            <text x="200" y="235" text-anchor="middle" fill="#FFD700" font-size="14" font-weight="bold">‚â• 30 m√®tres</text>
            <!-- Triangle de signalisation -->
            <path d="M 250 200 L 220 260 L 280 260 Z" fill="none" stroke="#FF0000" stroke-width="6"/>
            <path d="M 250 210 L 230 250 L 270 250 Z" fill="#FF0000" opacity="0.3"/>
            <!-- Reflets -->
            <circle cx="240" cy="235" r="4" fill="#FFF" opacity="0.8"/>
            <circle cx="260" cy="235" r="4" fill="#FFF" opacity="0.8"/>
            <circle cx="250" cy="250" r="4" fill="#FFF" opacity="0.8"/>
            <!-- V√©hicule en panne -->
            <rect x="120" y="260" width="60" height="35" rx="5" fill="#4A90E2"/>
            <rect x="125" y="265" width="15" height="12" fill="#87CEEB"/>
            <rect x="145" y="265" width="15" height="12" fill="#87CEEB"/>
            <circle cx="135" cy="295" r="8" fill="#333"/>
            <circle cx="165" cy="295" r="8" fill="#333"/>
            <text x="150" y="315" text-anchor="middle" fill="#FFF" font-size="10" font-weight="bold">V√©hicule</text>
            <!-- Personne avec gilet -->
            <circle cx="90" cy="270" r="8" fill="#FFD7A6"/>
            <rect x="82" y="278" width="16" height="25" rx="2" fill="#FFD700"/>
            <line x1="78" y1="285" x2="102" y2="285" stroke="#FFD700" stroke-width="8"/>
            <text x="90" y="320" text-anchor="middle" fill="#FFF" font-size="9">Gilet HV</text>
            <!-- Titre -->
            <text x="150" y="30" text-anchor="middle" fill="#333" font-size="16" font-weight="bold">Protection sur la route</text>
            <text x="150" y="50" text-anchor="middle" fill="#666" font-size="11">Triangle √† 30m minimum en amont</text>
            <!-- Instructions -->
            <text x="150" y="360" text-anchor="middle" fill="#333" font-size="10">‚úì Gilet haute visibilit√©   ‚úì Triangle √† 30m   ‚úì Feux de d√©tresse</text>
        </svg>
    `;
}

// ==================== IC√îNES SVG DES COFFRES ====================

function getTreasureChestSVG(color, isLocked) {
    const gradientId = `chest-gradient-${Math.random().toString(36).substr(2, 9)}`;
    return `
        <svg viewBox="0 0 100 100" class="w-full h-full">
            <defs>
                <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:${color.from};stop-opacity:1" />
                    <stop offset="100%" style="stop-color:${color.to};stop-opacity:1" />
                </linearGradient>
            </defs>
            <!-- Corps du coffre -->
            <rect x="15" y="45" width="70" height="40" rx="5" fill="url(#${gradientId})" stroke="#8B4513" stroke-width="2"/>
            <!-- Couvercle du coffre ${isLocked ? '(ferm√©)' : '(ouvert)'}-->
            ${isLocked ? `
                <path d="M 15 45 Q 15 35, 20 30 L 80 30 Q 85 35, 85 45 Z" fill="url(#${gradientId})" stroke="#8B4513" stroke-width="2"/>
                <rect x="15" y="43" width="70" height="4" fill="#654321"/>
                <!-- Serrure -->
                <circle cx="50" cy="55" r="8" fill="#FFD700" stroke="#DAA520" stroke-width="1.5"/>
                <rect x="48" y="55" width="4" height="12" fill="#DAA520" rx="1"/>
                <!-- Fermoir -->
                <rect x="20" y="53" width="60" height="3" fill="#8B4513" opacity="0.6"/>
            ` : `
                <path d="M 15 25 Q 15 15, 20 10 L 80 10 Q 85 15, 85 25 L 85 45 L 15 45 Z" fill="url(#${gradientId})" stroke="#8B4513" stroke-width="2"/>
                <rect x="15" y="23" width="70" height="4" fill="#654321"/>
                <!-- Int√©rieur visible -->
                <rect x="20" y="45" width="60" height="5" fill="#FFE4B5"/>
                <!-- √âclat lumineux (tr√©sor) -->
                <circle cx="50" cy="50" r="3" fill="#FFD700" opacity="0.8"/>
                <path d="M 50 47 L 52 50 L 50 53 L 48 50 Z" fill="#FFF" opacity="0.6"/>
            `}
            <!-- D√©tails d√©coratifs -->
            <rect x="25" y="60" width="50" height="2" fill="#654321" opacity="0.5"/>
            <rect x="30" y="70" width="40" height="2" fill="#654321" opacity="0.5"/>
        </svg>
    `;
}

function getSafeSVG(color, isLocked) {
    const gradientId = `safe-gradient-${Math.random().toString(36).substr(2, 9)}`;
    return `
        <svg viewBox="0 0 100 100" class="w-full h-full">
            <defs>
                <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:${color.from};stop-opacity:1" />
                    <stop offset="100%" style="stop-color:${color.to};stop-opacity:1" />
                </linearGradient>
                <radialGradient id="${gradientId}-radial">
                    <stop offset="0%" style="stop-color:#C0C0C0;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#606060;stop-opacity:1" />
                </radialGradient>
            </defs>
            <!-- Corps du coffre-fort -->
            <rect x="20" y="25" width="60" height="55" rx="3" fill="url(#${gradientId})" stroke="#333" stroke-width="2"/>
            <!-- Cadre de porte -->
            <rect x="25" y="30" width="50" height="45" rx="2" fill="none" stroke="#666" stroke-width="1.5"/>
            <!-- Molette centrale -->
            <circle cx="50" cy="52" r="15" fill="url(#${gradientId}-radial)" stroke="#333" stroke-width="2"/>
            <circle cx="50" cy="52" r="12" fill="none" stroke="#999" stroke-width="1"/>
            <circle cx="50" cy="52" r="3" fill="#FFD700"/>
            <!-- Graduations de la molette -->
            ${[0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330].map(angle => {
                const rad = (angle * Math.PI) / 180;
                const x1 = 50 + Math.cos(rad) * 10;
                const y1 = 52 + Math.sin(rad) * 10;
                const x2 = 50 + Math.cos(rad) * 12;
                const y2 = 52 + Math.sin(rad) * 12;
                return `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="#666" stroke-width="1"/>`;
            }).join('')}
            <!-- Poign√©e -->
            ${isLocked ? `
                <rect x="68" y="50" width="8" height="4" rx="2" fill="#C0C0C0" stroke="#666" stroke-width="1"/>
            ` : `
                <rect x="68" y="48" width="4" height="8" rx="2" fill="#C0C0C0" stroke="#666" stroke-width="1"/>
            `}
            <!-- Charni√®res -->
            <circle cx="23" cy="35" r="2" fill="#666"/>
            <circle cx="23" cy="70" r="2" fill="#666"/>
            <!-- Indicateur d√©verrouill√© -->
            ${!isLocked ? `<circle cx="50" cy="30" r="3" fill="#00FF00" opacity="0.8"/>` : ''}
        </svg>
    `;
}

// ==================== CONFETTIS ====================

function createConfetti() {
    const container = document.getElementById('confetti-container');
    const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ffd700', '#ff69b4', '#32CD32', '#FF6347'];
    const shapes = ['‚óè', '‚ñ†', '‚ñ≤', '‚òÖ', '‚ô¶', '‚ú®', 'üéâ', 'üéä', '‚≠ê', 'üí´'];

    // Confettis normaux
    for (let i = 0; i < 120; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti absolute text-2xl pointer-events-none';
            confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.top = '-20px';
            confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 0.3 + 's';
            confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
            confetti.style.opacity = Math.random() * 0.5 + 0.5;
            confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            container.appendChild(confetti);

            setTimeout(() => confetti.remove(), 5000);
        }, i * 25);
    }

    // Feux d'artifice (particules qui explosent)
    for (let i = 0; i < 3; i++) {
        setTimeout(() => {
            createFirework();
        }, i * 400);
    }
}

function createFirework() {
    const container = document.getElementById('confetti-container');
    const centerX = Math.random() * 80 + 10; // Entre 10% et 90%
    const centerY = Math.random() * 50 + 10; // Entre 10% et 60%
    const colors = ['#FFD700', '#FF6347', '#32CD32', '#1E90FF', '#FF69B4', '#FFA500'];
    const color = colors[Math.floor(Math.random() * colors.length)];

    // Cr√©er 20 particules qui explosent depuis le centre
    for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'absolute pointer-events-none';
        particle.style.width = '8px';
        particle.style.height = '8px';
        particle.style.borderRadius = '50%';
        particle.style.backgroundColor = color;
        particle.style.left = centerX + '%';
        particle.style.top = centerY + '%';
        particle.style.boxShadow = `0 0 10px ${color}`;

        const angle = (Math.PI * 2 * i) / 20;
        const velocity = 100 + Math.random() * 50;
        const dx = Math.cos(angle) * velocity;
        const dy = Math.sin(angle) * velocity;

        container.appendChild(particle);

        let posX = 0;
        let posY = 0;
        let opacity = 1;
        const animation = setInterval(() => {
            posX += dx * 0.05;
            posY += dy * 0.05 + 2; // Gravit√©
            opacity -= 0.02;

            particle.style.transform = `translate(${posX}px, ${posY}px)`;
            particle.style.opacity = opacity;

            if (opacity <= 0) {
                clearInterval(animation);
                particle.remove();
            }
        }, 16);
    }
}

// Effet de particules lors de l'ouverture d'un coffre
function createChestOpenEffect(element) {
    const rect = element.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;

    const colors = ['#FFD700', '#FFA500', '#FFFF00'];

    for (let i = 0; i < 30; i++) {
        setTimeout(() => {
            const particle = document.createElement('div');
            particle.className = 'absolute pointer-events-none text-2xl';
            particle.textContent = '‚ú®';
            particle.style.left = centerX + 'px';
            particle.style.top = centerY + 'px';
            particle.style.color = colors[Math.floor(Math.random() * colors.length)];
            particle.style.zIndex = '9999';
            document.body.appendChild(particle);

            const angle = Math.random() * Math.PI * 2;
            const velocity = 50 + Math.random() * 100;
            const dx = Math.cos(angle) * velocity;
            const dy = Math.sin(angle) * velocity - 50; // Vers le haut initialement

            let posX = 0;
            let posY = 0;
            let opacity = 1;
            let rotation = 0;

            const animation = setInterval(() => {
                posX += dx * 0.05;
                posY += dy * 0.05;
                dy += 3; // Gravit√©
                opacity -= 0.015;
                rotation += 10;

                particle.style.transform = `translate(${posX}px, ${posY}px) rotate(${rotation}deg)`;
                particle.style.opacity = opacity;

                if (opacity <= 0) {
                    clearInterval(animation);
                    particle.remove();
                }
            }, 16);
        }, i * 20);
    }

    playSound('success');
}



// ==================== √âTAT DU JEU ====================

const gameState = {
    currentBoxIndex: -1,
    currentGameIndex: 0,
    totalScore: 0,
    gameScore: 0,
    attempts: 3,
    maxAttempts: 3,
    timeLeft: 60,
    timerInterval: null,
    boxesUnlocked: 0,
    stats: {
        gamesWon: 0,
        gamesLost: 0,
        totalTime: 0,
        startTime: null,
        endTime: null
    },
    currentAnswer: null
};

// ==================== COMMUNICATION MULTIJOUEUR FIREBASE ====================

// Envoyer une mise √† jour via Firebase
function broadcastUpdate() {
    // PROTECTION ANTI-NaN : V√©rifier et corriger les valeurs avant l'envoi
    if (isNaN(gameState.totalScore) || gameState.totalScore === undefined || gameState.totalScore === null) {
        console.error('‚ö†Ô∏è ERREUR CRITIQUE: totalScore est invalide avant broadcastUpdate, correction √† 0');
        gameState.totalScore = 0;
    }
    if (isNaN(gameState.boxesUnlocked) || gameState.boxesUnlocked === undefined || gameState.boxesUnlocked === null) {
        console.error('‚ö†Ô∏è ERREUR CRITIQUE: boxesUnlocked est invalide avant broadcastUpdate, correction √† 0');
        gameState.boxesUnlocked = 0;
    }

    const update = {
        type: 'team_update',
        sessionId: sessionId,
        teamName: currentTeamName,
        boxesUnlocked: gameState.boxesUnlocked,
        totalScore: gameState.totalScore,
        isFinished: gameState.boxesUnlocked >= boxesData.length,
        finishTime: gameState.stats.endTime || null,
        stats: {
            gamesWon: gameState.stats.gamesWon || 0,
            gamesLost: gameState.stats.gamesLost || 0,
            totalTime: gameState.stats.totalTime || 0,
            startTime: gameState.stats.startTime || null,
            endTime: gameState.stats.endTime || null
        },
        lastUpdate: Date.now()
    };

    // DEBUG: Afficher ce qu'on envoie √† Firebase
    console.log('üì§ Envoi √† Firebase:', update);

    // Enregistrer dans Firebase Realtime Database (s√©par√© par niveau)
    database.ref('teams_ssiap' + currentLevel + '/' + sessionId).set(update).catch(error => {
        console.error('‚ùå Erreur Firebase:', error);
    });
}

// √âcouter les changements d'√©quipes (pour le superviseur)
function startListeningToTeams() {
    database.ref('teams_ssiap' + currentLevel).on('value', (snapshot) => {
        if (appMode === 'supervisor') {
            teams = snapshot.val() || {};
            updateSupervisorDisplay();
        }
    });
}

// √âcouter les commandes du superviseur (pour les joueurs)
function startListeningToCommands() {
    database.ref('commands_ssiap' + currentLevel).on('value', (snapshot) => {
        if (appMode !== 'player') return;

        const command = snapshot.val();
        if (!command) return;

        if (command.type === 'stop_all_games' && command.timestamp > (Date.now() - 5000)) {
            stopTimer();
            showCustomAlert('‚è∏Ô∏è Le superviseur a arr√™t√© le jeu !');
        }

        if (command.type === 'reset_all' && command.timestamp > (Date.now() - 5000)) {
            resetGameState();
            showCustomAlert('üîÑ Le superviseur a r√©initialis√© le jeu !');
            setTimeout(() => {
                showScreen('player-entry-screen');
                document.getElementById('team-name-input').value = '';
            }, 2000);
        }
    });
}

// Envoyer une commande depuis le superviseur
function sendCommand(commandType) {
    database.ref('commands_ssiap' + currentLevel).set({
        type: commandType,
        timestamp: Date.now()
    });
}

// Charger les √©quipes depuis Firebase
function loadTeamsFromFirebase() {
    database.ref('teams_ssiap' + currentLevel).once('value', (snapshot) => {
        teams = snapshot.val() || {};
        updateSupervisorDisplay();
    });
}

// ==================== INITIALISATION ====================

// G√©n√©rer le QR Code
function generateQRCode() {
    const qrContainer = document.getElementById('qrcode');
    qrContainer.innerHTML = ''; // Clear existing

    // Cr√©er l'URL avec le param√®tre mode=player pour l'acc√®s joueur
    const url = new URL(window.location.href);
    url.searchParams.set('mode', 'player');

    new QRCode(qrContainer, {
        text: url.toString(),
        width: 200,
        height: 200,
        colorDark: '#5D5CDE',
        colorLight: '#ffffff',
    });
}

// Initialisation au chargement
window.addEventListener('DOMContentLoaded', () => {
    generateQRCode();

    // V√©rifier si l'URL contient le param√®tre mode=player
    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('mode');

    if (mode === 'player') {
        // Afficher directement l'√©cran d'entr√©e joueur
        showScreen('player-entry-screen');
    }
    // Sinon, l'√©cran de s√©lection du niveau est d√©j√† affich√© par le premier DOMContentLoaded

    // Bouton Superviseur
    document.getElementById('supervisor-btn').addEventListener('click', () => {
        playSound('tick');
        appMode = 'supervisor';
        showScreen('supervisor-screen');
        loadTeamsFromFirebase();

        // √âcouter les changements en temps r√©el
        startListeningToTeams();
    });

    // Bouton Acc√®s Joueur Direct (pour test en local)
    document.getElementById('manual-player-access-btn').addEventListener('click', () => {
        playSound('tick');
        showScreen('player-entry-screen');
    });

    // Bouton Joueur
    document.getElementById('player-btn').addEventListener('click', () => {
        const teamName = document.getElementById('team-name-input').value.trim();
        if (!teamName) {
            showCustomAlert('‚ö†Ô∏è Veuillez entrer un nom d\'√©quipe !');
            return;
        }

        playSound('tick');
        currentTeamName = teamName;
        appMode = 'player';

        // DEBUG: V√©rifier gameState AVANT reset
        console.log('üîç AVANT resetGameState():', {
            totalScore: gameState.totalScore,
            boxesUnlocked: gameState.boxesUnlocked
        });

        // R√©initialiser compl√®tement le gameState pour une nouvelle partie
        resetGameState();
        gameState.stats.startTime = Date.now();

        // PROTECTION CRITIQUE: Forcer les valeurs √† 0 si NaN
        if (isNaN(gameState.totalScore)) {
            console.error('‚ùå CORRUPTION D√âTECT√âE: totalScore est NaN apr√®s resetGameState()!');
            gameState.totalScore = 0;
        }
        if (isNaN(gameState.boxesUnlocked)) {
            console.error('‚ùå CORRUPTION D√âTECT√âE: boxesUnlocked est NaN apr√®s resetGameState()!');
            gameState.boxesUnlocked = 0;
        }

        // DEBUG: Afficher l'√©tat apr√®s reset
        console.log('‚úÖ APR√àS resetGameState() dans player-btn:', {
            totalScore: gameState.totalScore,
            boxesUnlocked: gameState.boxesUnlocked,
            sessionId: sessionId,
            teamName: currentTeamName
        });

        // √âcouter les commandes du superviseur
        startListeningToCommands();

        showScreen('boxes-screen');
        document.getElementById('team-name-display').textContent = currentTeamName;
        renderBoxes();

        // DEBUG: V√©rifier gameState JUSTE AVANT broadcastUpdate
        console.log('üöÄ JUSTE AVANT broadcastUpdate():', {
            totalScore: gameState.totalScore,
            boxesUnlocked: gameState.boxesUnlocked
        });

        broadcastUpdate();
    });

    // Bouton retour superviseur
    document.getElementById('back-to-login-supervisor').addEventListener('click', () => {
        playSound('tick');
        showScreen('login-screen');
        appMode = 'login';
    });

    // Bouton retour aux coffres
    document.getElementById('back-to-boxes').addEventListener('click', () => {
        stopTimer();
        playSound('tick');
        showScreen('boxes-screen');
        // Recharger l'affichage des coffres avec le score actuel
        updateBoxesDisplay();
    });

    // Bouton recommencer
    document.getElementById('restart-btn').addEventListener('click', () => {
        playSound('tick');
        resetGameState();
        showScreen('boxes-screen');
        renderBoxes();
        broadcastUpdate();
    });

    // Bouton Arr√™ter le jeu (Superviseur)
    document.getElementById('stop-all-games-btn').addEventListener('click', () => {
        showConfirmDialog(
            '‚è∏Ô∏è Voulez-vous vraiment arr√™ter tous les jeux en cours ?',
            () => {
                playSound('tick');
                // Envoyer une commande Firebase √† tous les joueurs
                sendCommand('stop_all_games');
                showCustomAlert('‚è∏Ô∏è Signal d\'arr√™t envoy√© √† toutes les √©quipes !');
            }
        );
    });

    // Bouton R√©initialiser tout (Superviseur)
    document.getElementById('reset-all-btn').addEventListener('click', () => {
        showConfirmDialog(
            'üîÑ Voulez-vous vraiment r√©initialiser toutes les donn√©es ? Cette action est irr√©versible !',
            () => {
                playSound('tick');
                // Effacer toutes les donn√©es Firebase
                database.ref('teams_ssiap' + currentLevel).remove();

                // R√©initialiser l'objet teams
                teams = {};

                // Envoyer une commande √† tous les joueurs pour r√©initialiser
                sendCommand('reset_all');

                // Mettre √† jour l'affichage
                updateSupervisorDisplay();
                document.getElementById('final-ranking').classList.add('hidden');

                showCustomAlert('üîÑ Toutes les donn√©es ont √©t√© r√©initialis√©es !');
            }
        );
    });

    // ==================== MODE ADMIN ====================

    let adminCurrentBox = null;
    let adminCurrentGameIndex = null;
    let adminCurrentVariationIndex = 0; // Index de la variation en cours d'√©dition

    // Bouton pour ouvrir le mode ADMIN
    document.getElementById('admin-mode-btn').addEventListener('click', () => {
        playSound('tick');
        showAdminScreen();
    });

    // Bouton pour fermer le mode ADMIN
    document.getElementById('admin-close-btn').addEventListener('click', () => {
        playSound('tick');
        showScreen('supervisor-screen');
        adminCurrentBox = null;
        adminCurrentGameIndex = null;
        adminCurrentVariationIndex = 0;
    });

    // Afficher l'√©cran ADMIN
    function showAdminScreen() {
        const screens = ['login-screen', 'player-entry-screen', 'supervisor-screen', 'boxes-screen', 'game-screen', 'end-screen', 'admin-screen'];
        screens.forEach(id => {
            document.getElementById(id).classList.add('hidden');
        });
        document.getElementById('admin-screen').classList.remove('hidden');

        // R√©initialiser les filtres
        adminSearchQuery = '';
        adminTypeFilter = 'all';
        document.getElementById('admin-search').value = '';

        // R√©initialiser l'√©tat des boutons de filtre
        document.querySelectorAll('.admin-filter-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
        });
        // Activer le bouton "Tous"
        const allBtn = document.querySelector('.admin-filter-btn[data-type="all"]');
        if (allBtn) {
            allBtn.classList.add('bg-primary', 'text-white');
            allBtn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
        }

        // G√©n√©rer la liste des coffres et jeux
        renderAdminBoxesList();

        // Mettre √† jour les statistiques de timing
        updateTimingStats();
    }

    // Variables de filtrage
    let adminSearchQuery = '';
    let adminTypeFilter = 'all';

    // Afficher la liste des coffres et jeux dans l'admin
    function renderAdminBoxesList() {
        const container = document.getElementById('admin-boxes-list');
        container.innerHTML = '';

        let totalGamesDisplayed = 0;

        const gameTypeLabels = {
            'quiz': '‚ùì QCM',
            'quiz-multi': '‚òëÔ∏è Multi',
            'true-false': '‚úì‚úó Vrai/Faux',
            'quiz-illustrated': 'üñºÔ∏è Illustr√©',
            'matching': 'üîó Appariement',
            'sequence': 'üìä S√©quence',
            'puzzle-text': 'üß© Puzzle',
            'draw': '‚úèÔ∏è Dessin'
        };

        boxesData.forEach((box, boxIndex) => {
            const boxDiv = document.createElement('div');
            boxDiv.className = 'border-2 border-gray-300 dark:border-gray-600 rounded-xl p-4 mb-3';

            let boxHTML = `
                <div class="flex items-center justify-between mb-3 pb-2 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center">
                        <div class="text-2xl mr-2">${box.icon || box.emoji || 'üì¶'}</div>
                        <div class="font-bold text-gray-800 dark:text-white text-sm">${box.title || box.name || 'Coffre'}</div>
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400" id="box-${boxIndex}-count">0 jeu(x)</div>
                </div>
                <div class="space-y-1" id="box-${boxIndex}-games">
            `;

            let boxGamesCount = 0;

            // Les games peuvent √™tre un tableau de tableaux (variations) ou un tableau simple
            box.games.forEach((gameOrVariations, gameIndex) => {
                // Si c'est un tableau de variations, on prend le premier jeu
                const game = Array.isArray(gameOrVariations) ? gameOrVariations[0] : gameOrVariations;

                if (!game || !game.type) return; // Ignorer les jeux invalides

                // Filtre par type
                if (adminTypeFilter !== 'all') {
                    // Normaliser les types pour la comparaison
                    const gameTypeNormalized = game.type.toLowerCase();
                    const filterTypeNormalized = adminTypeFilter.toLowerCase();

                    // V√©rifier si le type correspond
                    if (gameTypeNormalized !== filterTypeNormalized) {
                        // V√©rifier aussi les variantes (quiz-multi = quiz, quiz-illustrated = quiz)
                        const gameTypeBase = gameTypeNormalized.replace(/-illustrated|-multi/g, '');
                        const filterTypeBase = filterTypeNormalized.replace(/-illustrated|-multi/g, '');
                        if (gameTypeBase !== filterTypeBase) {
                            return; // Ne pas afficher ce jeu
                        }
                    }
                }

                // Filtre par recherche
                if (adminSearchQuery) {
                    const searchLower = adminSearchQuery.toLowerCase();
                    const title = (game.title || '').toLowerCase();
                    const question = (game.question || '').toLowerCase();
                    const type = (game.type || '').toLowerCase();

                    if (!title.includes(searchLower) &&
                        !question.includes(searchLower) &&
                        !type.includes(searchLower)) {
                        return; // Ne pas afficher ce jeu
                    }
                }

                const gameLabel = gameTypeLabels[game.type] || game.type || '‚ùì';
                const gameTitle = game.title || game.question || 'Sans titre';

                // Tronquer le titre si trop long
                const displayTitle = gameTitle.length > 45 ? gameTitle.substring(0, 42) + '...' : gameTitle;

                // Compter les variations
                const variationsCount = Array.isArray(gameOrVariations) ? gameOrVariations.length : 1;
                const variationsBadge = variationsCount > 1 ? `<span class="ml-1 px-1.5 py-0.5 bg-purple-500 text-white text-[10px] rounded-full">${variationsCount} var.</span>` : '';

                boxHTML += `
                    <button
                        class="admin-game-btn w-full text-left px-3 py-2 bg-gray-50 dark:bg-gray-700 hover:bg-primary hover:text-white dark:hover:bg-primary rounded-lg transition-all text-xs group"
                        data-box="${boxIndex}"
                        data-game="${gameIndex}"
                        title="${gameTitle}${variationsCount > 1 ? ' (' + variationsCount + ' variations)' : ''}"
                    >
                        <div class="flex items-start gap-2">
                            <span class="text-sm flex-shrink-0">${gameLabel}</span>
                            <span class="flex-1 line-clamp-2">${displayTitle}</span>
                            ${variationsBadge}
                        </div>
                    </button>
                `;
                boxGamesCount++;
                totalGamesDisplayed++;
            });

            boxHTML += '</div>';
            boxDiv.innerHTML = boxHTML;

            // N'afficher le coffre que s'il contient des jeux filtr√©s
            if (boxGamesCount > 0) {
                container.appendChild(boxDiv);
                // Mettre √† jour le compteur du coffre
                setTimeout(() => {
                    const countElement = document.getElementById(`box-${boxIndex}-count`);
                    if (countElement) {
                        countElement.textContent = `${boxGamesCount} jeu(x)`;
                    }
                }, 0);
            }
        });

        // Mettre √† jour le compteur global
        document.getElementById('admin-results-count').textContent = totalGamesDisplayed;

        // Message si aucun r√©sultat
        if (totalGamesDisplayed === 0) {
            container.innerHTML = `
                <div class="text-center py-10 text-gray-400 dark:text-gray-500">
                    <div class="text-4xl mb-3">üîç</div>
                    <p>Aucun jeu trouv√©</p>
                </div>
            `;
        }

        // Ajouter les √©v√©nements sur les boutons de jeu
        document.querySelectorAll('.admin-game-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const boxIndex = parseInt(btn.dataset.box);
                const gameIndex = parseInt(btn.dataset.game);
                loadGameInEditor(boxIndex, gameIndex);
            });
        });
    }

    // Barre de recherche
    document.getElementById('admin-search').addEventListener('input', (e) => {
        adminSearchQuery = e.target.value;
        renderAdminBoxesList();
    });

    // Filtres par type
    document.querySelectorAll('.admin-filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            // Retirer l'√©tat actif de tous les boutons
            document.querySelectorAll('.admin-filter-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white');
                b.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            });

            // Activer le bouton cliqu√©
            btn.classList.add('bg-primary', 'text-white');
            btn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');

            // Appliquer le filtre
            adminTypeFilter = btn.dataset.type;
            renderAdminBoxesList();
        });
    });

    // Charger un jeu dans l'√©diteur
    function loadGameInEditor(boxIndex, gameIndex, variationIndex = 0) {
        adminCurrentBox = boxIndex;
        adminCurrentGameIndex = gameIndex;
        adminCurrentVariationIndex = variationIndex;

        const gameOrVariations = boxesData[boxIndex].games[gameIndex];
        const isArray = Array.isArray(gameOrVariations);
        const variationsCount = isArray ? gameOrVariations.length : 1;

        // R√©cup√©rer le jeu √† √©diter
        const game = isArray ? gameOrVariations[variationIndex] : gameOrVariations;

        if (!game || !game.type) {
            showCustomAlert('‚ùå Erreur : Jeu invalide');
            return;
        }

        // Afficher le formulaire d'√©dition
        document.getElementById('admin-no-selection').classList.add('hidden');
        document.getElementById('admin-edit-form').classList.remove('hidden');

        // Cr√©er/mettre √† jour le s√©lecteur de variantes
        renderVariationSelector(variationsCount, variationIndex);

        // Remplir les champs de base
        document.getElementById('admin-type').value = game.type || '';
        document.getElementById('admin-title').value = game.title || '';
        document.getElementById('admin-question').value = game.question || '';
        document.getElementById('admin-timeLimit').value = game.timeLimit || 60;
        document.getElementById('admin-points').value = game.points || 100;

        // G√©rer l'explication (pour true-false)
        const explanationContainer = document.getElementById('admin-explanation-container');
        if (game.type === 'true-false' && game.explanation) {
            explanationContainer.classList.remove('hidden');
            document.getElementById('admin-explanation').value = game.explanation;
        } else {
            explanationContainer.classList.add('hidden');
        }

        // G√©n√©rer les champs d'options selon le type de jeu
        renderAdminOptionsFields(game);
        renderAdminCorrectAnswerField(game);
    }

    // Afficher le s√©lecteur de variantes
    function renderVariationSelector(totalVariations, currentIndex) {
        const container = document.getElementById('admin-variation-selector');

        if (totalVariations <= 1) {
            // Pas de variantes, cacher le s√©lecteur
            container.classList.add('hidden');
            container.innerHTML = '';
        } else {
            // Afficher le s√©lecteur avec navigation
            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/30 rounded-lg border-2 border-purple-200 dark:border-purple-700">
                    <div class="flex items-center gap-2">
                        <span class="text-sm font-semibold text-purple-700 dark:text-purple-300">
                            üìë Variante ${currentIndex + 1} / ${totalVariations}
                        </span>
                    </div>
                    <div class="flex gap-2">
                        <button
                            id="admin-prev-variation"
                            class="px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm"
                            ${currentIndex === 0 ? 'disabled' : ''}
                        >
                            ‚Üê Pr√©c√©dente
                        </button>
                        <button
                            id="admin-next-variation"
                            class="px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm"
                            ${currentIndex === totalVariations - 1 ? 'disabled' : ''}
                        >
                            Suivante ‚Üí
                        </button>
                    </div>
                </div>
            `;

            // Ajouter les √©v√©nements de navigation
            const prevBtn = document.getElementById('admin-prev-variation');
            const nextBtn = document.getElementById('admin-next-variation');

            if (prevBtn && currentIndex > 0) {
                prevBtn.addEventListener('click', () => {
                    playSound('tick');
                    loadGameInEditor(adminCurrentBox, adminCurrentGameIndex, currentIndex - 1);
                });
            }

            if (nextBtn && currentIndex < totalVariations - 1) {
                nextBtn.addEventListener('click', () => {
                    playSound('tick');
                    loadGameInEditor(adminCurrentBox, adminCurrentGameIndex, currentIndex + 1);
                });
            }
        }
    }

    // G√©n√©rer les champs d'options selon le type de jeu
    function renderAdminOptionsFields(game) {
        const container = document.getElementById('admin-options-container');
        container.innerHTML = '';

        if (game.type === 'quiz' || game.type === 'quiz-multi' || game.type === 'true-false' || game.type === 'quiz-illustrated') {
            container.innerHTML = '<label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Options de r√©ponse</label>';

            game.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'flex items-center gap-2 mb-2';
                optionDiv.innerHTML = `
                    <span class="text-gray-600 dark:text-gray-400 font-semibold w-8">${index + 1}.</span>
                    <input
                        type="text"
                        class="admin-option-input flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base"
                        data-index="${index}"
                        value="${option}"
                    >
                `;
                container.appendChild(optionDiv);
            });
        } else if (game.type === 'matching') {
            container.innerHTML = '<label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-3">Paires √† associer</label>';

            game.pairs.forEach((pair, index) => {
                const pairDiv = document.createElement('div');
                pairDiv.className = 'grid grid-cols-2 gap-2 mb-2 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg';
                pairDiv.innerHTML = `
                    <div>
                        <label class="text-xs text-gray-600 dark:text-gray-400">Gauche ${index + 1}</label>
                        <input
                            type="text"
                            class="admin-pair-left w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base"
                            data-index="${index}"
                            value="${pair.left}"
                        >
                    </div>
                    <div>
                        <label class="text-xs text-gray-600 dark:text-gray-400">Droite ${index + 1}</label>
                        <input
                            type="text"
                            class="admin-pair-right w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base"
                            data-index="${index}"
                            value="${pair.right}"
                        >
                    </div>
                `;
                container.appendChild(pairDiv);
            });
        } else if (game.type === 'sequence') {
            container.innerHTML = '<label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">√âtapes dans le bon ordre</label>';

            game.items.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex items-center gap-2 mb-2';
                itemDiv.innerHTML = `
                    <span class="text-gray-600 dark:text-gray-400 font-semibold w-8">${index + 1}.</span>
                    <input
                        type="text"
                        class="admin-sequence-input flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base"
                        data-index="${index}"
                        value="${item}"
                    >
                `;
                container.appendChild(itemDiv);
            });
        } else if (game.type === 'puzzle-text') {
            container.innerHTML = `
                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Texte du puzzle</label>
                <textarea id="admin-puzzle-text" rows="4" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base">${game.text || ''}</textarea>
            `;
        }
    }

    // G√©n√©rer le champ de r√©ponse correcte
    function renderAdminCorrectAnswerField(game) {
        const container = document.getElementById('admin-correct-answer-container');
        container.innerHTML = '';

        if (game.type === 'quiz' || game.type === 'true-false' || game.type === 'quiz-illustrated') {
            container.innerHTML = `
                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Index de la r√©ponse correcte (0 = premi√®re option)</label>
                <input
                    type="number"
                    id="admin-correctAnswer"
                    min="0"
                    max="${game.options.length - 1}"
                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base"
                    value="${game.correctAnswer}"
                >
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">La bonne r√©ponse est actuellement : "${game.options[game.correctAnswer]}"</p>
            `;
        } else if (game.type === 'quiz-multi') {
            const correctAnswersArray = Array.isArray(game.correctAnswers) ? game.correctAnswers : [];
            container.innerHTML = `
                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-2">Indices des r√©ponses correctes (s√©par√©s par des virgules)</label>
                <input
                    type="text"
                    id="admin-correctAnswer"
                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-white text-base"
                    value="${correctAnswersArray.join(',')}"
                    placeholder="Ex: 0,2,3"
                >
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Les bonnes r√©ponses sont : ${correctAnswersArray.map(i => game.options[i]).join(', ')}</p>
            `;
        }
    }

    // Bouton Enregistrer
    document.getElementById('admin-save-btn').addEventListener('click', () => {
        if (adminCurrentBox === null || adminCurrentGameIndex === null) return;

        const gameOrVariations = boxesData[adminCurrentBox].games[adminCurrentGameIndex];

        // R√©cup√©rer le jeu √† sauvegarder (en tenant compte de la variante)
        const game = Array.isArray(gameOrVariations) ? gameOrVariations[adminCurrentVariationIndex] : gameOrVariations;

        if (!game) {
            showCustomAlert('‚ùå Erreur : Impossible de sauvegarder');
            return;
        }

        // R√©cup√©rer les valeurs modifi√©es
        game.title = document.getElementById('admin-title').value;
        game.question = document.getElementById('admin-question').value;
        game.timeLimit = parseInt(document.getElementById('admin-timeLimit').value);
        game.points = parseInt(document.getElementById('admin-points').value);

        // Mettre √† jour l'explication si c'est un true-false
        if (game.type === 'true-false') {
            game.explanation = document.getElementById('admin-explanation').value;
        }

        // Mettre √† jour les options selon le type
        if (game.type === 'quiz' || game.type === 'quiz-multi' || game.type === 'true-false' || game.type === 'quiz-illustrated') {
            const optionInputs = document.querySelectorAll('.admin-option-input');
            game.options = Array.from(optionInputs).map(input => input.value);

            // Mettre √† jour la r√©ponse correcte
            if (game.type === 'quiz-multi') {
                const correctAnswerStr = document.getElementById('admin-correctAnswer').value;
                game.correctAnswers = correctAnswerStr.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
            } else {
                game.correctAnswer = parseInt(document.getElementById('admin-correctAnswer').value);
            }
        } else if (game.type === 'matching') {
            const leftInputs = document.querySelectorAll('.admin-pair-left');
            const rightInputs = document.querySelectorAll('.admin-pair-right');
            game.pairs = Array.from(leftInputs).map((leftInput, index) => ({
                left: leftInput.value,
                right: rightInputs[index].value
            }));
        } else if (game.type === 'sequence') {
            const sequenceInputs = document.querySelectorAll('.admin-sequence-input');
            game.items = Array.from(sequenceInputs).map(input => input.value);
        } else if (game.type === 'puzzle-text') {
            game.text = document.getElementById('admin-puzzle-text').value;
        }

        playSound('success');
        showCustomAlert('‚úÖ Modifications enregistr√©es avec succ√®s !');

        // Recharger la liste pour refl√©ter les changements
        renderAdminBoxesList();
    });

    // Bouton Annuler
    document.getElementById('admin-cancel-btn').addEventListener('click', () => {
        playSound('tick');
        document.getElementById('admin-no-selection').classList.remove('hidden');
        document.getElementById('admin-edit-form').classList.add('hidden');
        adminCurrentBox = null;
        adminCurrentGameIndex = null;
        adminCurrentVariationIndex = 0;
    });

    // Bouton Exporter
    document.getElementById('admin-export-btn').addEventListener('click', () => {
        const dataStr = JSON.stringify(boxesData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'sst-questions-backup.json';
        link.click();
        URL.revokeObjectURL(url);

        playSound('success');
        showCustomAlert('üì• Questions export√©es avec succ√®s !');
    });

    // Bouton Importer
    document.getElementById('admin-import-btn').addEventListener('click', () => {
        document.getElementById('admin-import-file').click();
    });

    document.getElementById('admin-import-file').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const importedData = JSON.parse(event.target.result);

                // Valider que c'est bien un tableau de coffres
                if (!Array.isArray(importedData)) {
                    throw new Error('Le fichier JSON doit contenir un tableau de coffres');
                }

                showConfirmDialog(
                    'üì§ Voulez-vous vraiment importer ces questions ? Cela remplacera TOUTES les questions actuelles !',
                    () => {
                        // Remplacer boxesData
                        boxesData.length = 0;
                        boxesData.push(...importedData);

                        playSound('success');
                        showCustomAlert('‚úÖ Questions import√©es avec succ√®s !');
                        renderAdminBoxesList();
                        updateTimingStats();

                        // R√©initialiser l'input file
                        document.getElementById('admin-import-file').value = '';
                    }
                );
            } catch (error) {
                showCustomAlert('‚ùå Erreur lors de l\'import : ' + error.message);
            }
        };
        reader.readAsText(file);
    });

    // ==================== CONTR√îLE DU TIMING GLOBAL ====================

    // Calculer et afficher les statistiques de timing
    function updateTimingStats() {
        let allTimes = [];

        boxesData.forEach(box => {
            box.games.forEach(gameOrVariations => {
                const game = Array.isArray(gameOrVariations) ? gameOrVariations[0] : gameOrVariations;
                if (game && game.timeLimit) {
                    allTimes.push(game.timeLimit);
                }
            });
        });

        if (allTimes.length === 0) {
            document.getElementById('admin-avg-time').textContent = '0';
            document.getElementById('admin-min-time').textContent = '0';
            document.getElementById('admin-max-time').textContent = '0';
            return;
        }

        const avg = Math.round(allTimes.reduce((a, b) => a + b, 0) / allTimes.length);
        const min = Math.min(...allTimes);
        const max = Math.max(...allTimes);

        document.getElementById('admin-avg-time').textContent = avg;
        document.getElementById('admin-min-time').textContent = min;
        document.getElementById('admin-max-time').textContent = max;
    }

    // Appliquer un multiplicateur √† tous les temps
    function applyTimeMultiplier(multiplier) {
        let count = 0;

        boxesData.forEach(box => {
            box.games.forEach(gameOrVariations => {
                if (Array.isArray(gameOrVariations)) {
                    // C'est un tableau de variations
                    gameOrVariations.forEach(game => {
                        if (game && game.timeLimit) {
                            game.timeLimit = Math.max(10, Math.round(game.timeLimit * multiplier));
                            count++;
                        }
                    });
                } else {
                    // C'est un jeu simple
                    const game = gameOrVariations;
                    if (game && game.timeLimit) {
                        game.timeLimit = Math.max(10, Math.round(game.timeLimit * multiplier));
                        count++;
                    }
                }
            });
        });

        return count;
    }

    // D√©finir un temps fixe pour tous
    function applyFixedTime(time) {
        let count = 0;

        boxesData.forEach(box => {
            box.games.forEach(gameOrVariations => {
                if (Array.isArray(gameOrVariations)) {
                    gameOrVariations.forEach(game => {
                        if (game && game.timeLimit !== undefined) {
                            game.timeLimit = time;
                            count++;
                        }
                    });
                } else {
                    const game = gameOrVariations;
                    if (game && game.timeLimit !== undefined) {
                        game.timeLimit = time;
                        count++;
                    }
                }
            });
        });

        return count;
    }

    // Boutons presets de vitesse
    document.querySelectorAll('.admin-speed-preset').forEach(btn => {
        btn.addEventListener('click', () => {
            const multiplier = parseFloat(btn.dataset.multiplier);

            showConfirmDialog(
                `‚è±Ô∏è Voulez-vous vraiment modifier TOUS les temps avec un multiplicateur de ${multiplier}x ?`,
                () => {
                    const count = applyTimeMultiplier(multiplier);
                    updateTimingStats();
                    playSound('success');
                    showCustomAlert(`‚úÖ ${count} jeux ont √©t√© mis √† jour !`);
                }
            );
        });
    });

    // Bouton appliquer multiplicateur personnalis√©
    document.getElementById('admin-apply-multiplier').addEventListener('click', () => {
        const multiplier = parseFloat(document.getElementById('admin-time-multiplier').value);

        if (isNaN(multiplier) || multiplier <= 0) {
            showCustomAlert('‚ùå Veuillez entrer un multiplicateur valide (sup√©rieur √† 0)');
            return;
        }

        showConfirmDialog(
            `‚è±Ô∏è Voulez-vous vraiment modifier TOUS les temps avec un multiplicateur de ${multiplier}x ?`,
            () => {
                const count = applyTimeMultiplier(multiplier);
                updateTimingStats();
                playSound('success');
                showCustomAlert(`‚úÖ ${count} jeux ont √©t√© mis √† jour !`);
            }
        );
    });

    // Bouton appliquer temps fixe
    document.getElementById('admin-apply-fixed-time').addEventListener('click', () => {
        const time = parseInt(document.getElementById('admin-fixed-time').value);

        if (isNaN(time) || time < 10 || time > 300) {
            showCustomAlert('‚ùå Veuillez entrer un temps valide (entre 10 et 300 secondes)');
            return;
        }

        showConfirmDialog(
            `‚è±Ô∏è Voulez-vous vraiment d√©finir ${time} secondes pour TOUS les jeux ?`,
            () => {
                const count = applyFixedTime(time);
                updateTimingStats();
                playSound('success');
                showCustomAlert(`‚úÖ ${count} jeux ont √©t√© mis √† jour √† ${time}s !`);
            }
        );
    });

    // Mettre √† jour les stats √† l'ouverture de l'√©cran ADMIN
    // (on modifie la fonction showAdminScreen existante pour ajouter updateTimingStats)
});

// R√©initialiser l'√©tat du jeu
function resetGameState() {
    gameState.currentBoxIndex = -1;
    gameState.currentGameIndex = 0;
    gameState.totalScore = 0;
    gameState.gameScore = 0;
    gameState.attempts = 3;
    gameState.boxesUnlocked = 0;
    gameState.stats = { gamesWon: 0, gamesLost: 0, totalTime: 0, startTime: Date.now(), endTime: null };
    gameState.currentAnswer = null;

    // DEBUG: V√©rifier que les valeurs sont correctes
    console.log('üîÑ resetGameState() appel√©:', {
        totalScore: gameState.totalScore,
        boxesUnlocked: gameState.boxesUnlocked
    });
}

// Fonction de protection pour √©viter les valeurs NaN
function safeUpdateDisplay() {
    // S'assurer que les valeurs ne sont jamais NaN ou undefined
    if (isNaN(gameState.totalScore) || gameState.totalScore === undefined) {
        console.error('‚ö†Ô∏è ERREUR: totalScore est NaN ou undefined, r√©initialisation √† 0');
        gameState.totalScore = 0;
    }
    if (isNaN(gameState.boxesUnlocked) || gameState.boxesUnlocked === undefined) {
        console.error('‚ö†Ô∏è ERREUR: boxesUnlocked est NaN ou undefined, r√©initialisation √† 0');
        gameState.boxesUnlocked = 0;
    }

    updateBoxesDisplay();
}

// ==================== SUPERVISEUR ====================

function updateSupervisorDisplay() {
    const container = document.getElementById('teams-progress-container');
    const teamsArray = Object.values(teams);

    // Compter les √©quipes actives et termin√©es
    const activeTeams = teamsArray.filter(t => !t.isFinished).length;
    const finishedTeams = teamsArray.filter(t => t.isFinished).length;

    document.getElementById('active-teams-count').textContent = activeTeams;
    document.getElementById('finished-teams-count').textContent = finishedTeams;

    // Mettre √† jour les barres de progression
    container.innerHTML = '';

    // Trier par ordre d'arriv√©e (ceux qui ont fini, par temps)
    const sortedTeams = teamsArray.sort((a, b) => {
        if (a.isFinished && !b.isFinished) return -1;
        if (!a.isFinished && b.isFinished) return 1;
        if (a.isFinished && b.isFinished) {
            return (a.finishTime || 0) - (b.finishTime || 0);
        }
        // Pour ceux en cours, trier par progression
        return b.boxesUnlocked - a.boxesUnlocked;
    });

    sortedTeams.forEach((team, index) => {
        const teamDiv = document.createElement('div');
        teamDiv.className = 'bounce-in';

        const progressPercent = (team.boxesUnlocked / boxesData.length) * 100;

        // Ordre d'arriv√©e (seulement pour ceux qui ont fini)
        let rankBadge = '';
        if (team.isFinished) {
            const finishedTeams = sortedTeams.filter(t => t.isFinished);
            const rankPosition = finishedTeams.indexOf(team) + 1;

            if (rankPosition === 1) {
                rankBadge = `
                    <div class="absolute -top-4 -right-4 z-10">
                        <div class="relative">
                            <div class="absolute inset-0 bg-yellow-400 rounded-full animate-ping"></div>
                            <div class="relative flex items-center justify-center w-20 h-20 bg-gradient-to-br from-yellow-400 via-yellow-500 to-orange-500 rounded-full shadow-2xl border-4 border-white pulse glow">
                                <span class="text-5xl font-black text-white drop-shadow-lg">1</span>
                            </div>
                        </div>
                        <div class="text-center mt-1 text-xs font-bold text-yellow-600 dark:text-yellow-400 animate-pulse">üèÜ VAINQUEUR</div>
                    </div>
                `;
            } else if (rankPosition === 2) {
                rankBadge = `
                    <div class="absolute -top-4 -right-4 z-10">
                        <div class="flex items-center justify-center w-16 h-16 bg-gradient-to-br from-gray-300 via-gray-400 to-gray-500 rounded-full shadow-xl border-4 border-white">
                            <span class="text-4xl font-black text-white drop-shadow-lg">2</span>
                        </div>
                        <div class="text-center mt-1 text-xs font-bold text-gray-600 dark:text-gray-400">ü•à 2√®me</div>
                    </div>
                `;
            } else if (rankPosition === 3) {
                rankBadge = `
                    <div class="absolute -top-4 -right-4 z-10">
                        <div class="flex items-center justify-center w-14 h-14 bg-gradient-to-br from-orange-300 via-orange-400 to-orange-600 rounded-full shadow-xl border-4 border-white">
                            <span class="text-3xl font-black text-white drop-shadow-lg">3</span>
                        </div>
                        <div class="text-center mt-1 text-xs font-bold text-orange-600 dark:text-orange-400">ü•â 3√®me</div>
                    </div>
                `;
            } else {
                rankBadge = `
                    <div class="absolute -top-3 -right-3 z-10">
                        <div class="flex items-center justify-center w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full shadow-lg border-3 border-white">
                            <span class="text-2xl font-bold text-white">${rankPosition}</span>
                        </div>
                    </div>
                `;
            }
        }

        // G√©n√©rer les segments de coffres
        let segmentsHTML = '';
        for (let i = 0; i < team.boxesUnlocked; i++) {
            const box = boxesData[i];
            const segmentHeight = 100 / boxesData.length;
            segmentsHTML += `
                <div class="box-segment bg-gradient-to-r ${box.color}" style="height: ${segmentHeight}%">
                    ${box.icon}
                </div>
            `;
        }

        teamDiv.innerHTML = `
            <div class="glass-morphism rounded-2xl p-4 shadow-xl relative">
                ${rankBadge}
                <div class="text-center mb-3">
                    <div class="text-lg font-bold text-gray-800 dark:text-white">${team.teamName}</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">${team.totalScore} pts</div>
                    ${team.isFinished ? '<div class="text-xs text-green-600 font-semibold">‚úì Termin√©</div>' : ''}
                </div>

                <div class="progress-bar-vertical">
                    <div class="progress-fill" style="height: ${progressPercent}%">
                        ${segmentsHTML}
                    </div>
                </div>

                <div class="text-center mt-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                    ${team.boxesUnlocked} / ${boxesData.length}
                </div>
            </div>
        `;

        container.appendChild(teamDiv);
    });

    // Afficher le classement final si toutes les √©quipes ont termin√©
    if (finishedTeams > 0 && finishedTeams === teamsArray.length && teamsArray.length > 0) {
        showFinalRanking();
    }
}

function showFinalRanking() {
    const rankingDiv = document.getElementById('final-ranking');
    const rankingList = document.getElementById('ranking-list');

    rankingDiv.classList.remove('hidden');

    // Trier les √©quipes par score d√©croissant, puis par temps
    const sortedTeams = Object.values(teams).sort((a, b) => {
        if (b.totalScore !== a.totalScore) {
            return b.totalScore - a.totalScore;
        }
        return (a.finishTime || Infinity) - (b.finishTime || Infinity);
    });

    rankingList.innerHTML = '';

    sortedTeams.forEach((team, index) => {
        const rank = index + 1;
        const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';
        const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : rank;

        const duration = team.finishTime && team.stats.startTime ?
            Math.round((team.finishTime - team.stats.startTime) / 1000) : 0;

        const rankItem = document.createElement('div');
        rankItem.className = 'glass-morphism rounded-2xl p-6 flex items-center gap-6 bounce-in';
        rankItem.style.animationDelay = `${index * 0.1}s`;

        rankItem.innerHTML = `
            <div class="ranking-badge ${rankClass}">
                ${medal}
            </div>
            <div class="flex-1">
                <div class="text-2xl font-bold text-gray-800 dark:text-white">${team.teamName}</div>
                <div class="text-sm text-gray-600 dark:text-gray-400">
                    ${team.totalScore} points ‚Ä¢ ${duration}s ‚Ä¢ ${team.stats.gamesWon}/${team.stats.gamesWon + team.stats.gamesLost} r√©ussis
                </div>
            </div>
            <div class="text-3xl">${rank === 1 ? 'üéâ' : rank === 2 ? 'üëè' : rank === 3 ? 'üëç' : '‚ú®'}</div>
        `;

        rankingList.appendChild(rankItem);
    });
}

// ==================== JOUEUR - COFFRES ====================

function renderBoxes() {
    const container = document.getElementById('boxes-container');
    container.innerHTML = '';

    boxesData.forEach((box, index) => {
        const isUnlocked = gameState.boxesUnlocked > index;
        const isCurrent = gameState.boxesUnlocked === index;

        const boxElement = document.createElement('div');
        boxElement.className = `${isUnlocked ? 'unlocked-box' : 'locked-box'} cursor-pointer transition-all duration-500 bounce-in`;
        boxElement.style.animationDelay = `${index * 0.1}s`;

        // Utiliser un coffre-fort pour les coffres pairs, un coffre au tr√©sor pour les impairs
        const chestType = index % 2 === 0 ? 'safe' : 'treasure';
        const colorObj = {
            from: box.color.includes('blue') ? '#3b82f6' :
                  box.color.includes('red') ? '#ef4444' :
                  box.color.includes('green') ? '#10b981' :
                  box.color.includes('yellow') ? '#f59e0b' :
                  box.color.includes('purple') ? '#a855f7' :
                  box.color.includes('pink') ? '#ec4899' :
                  box.color.includes('indigo') ? '#6366f1' : '#3b82f6',
            to: box.color.includes('blue') ? '#1d4ed8' :
                box.color.includes('red') ? '#b91c1c' :
                box.color.includes('green') ? '#047857' :
                box.color.includes('orange') ? '#c2410c' :
                box.color.includes('purple') ? '#7c3aed' :
                box.color.includes('pink') ? '#be123c' :
                box.color.includes('indigo') ? '#4338ca' : '#1d4ed8'
        };

        const svgIcon = chestType === 'safe' ? getSafeSVG(colorObj, !isUnlocked) : getTreasureChestSVG(colorObj, !isUnlocked);

        boxElement.innerHTML = `
            <div class="relative p-6 rounded-2xl bg-gradient-to-br ${box.color} shadow-2xl transform hover:scale-105 transition-all duration-300 ${isCurrent ? 'ring-4 ring-yellow-400 ring-opacity-75 animate-pulse' : ''}">
                <div class="text-center mb-4">
                    <div class="w-32 h-32 mx-auto mb-3 ${!isUnlocked && !isCurrent ? 'opacity-50 grayscale' : ''} ${isCurrent ? 'float' : ''}">
                        ${svgIcon}
                    </div>
                </div>
                <h3 class="text-xl font-bold text-white text-center mb-2">${box.title}</h3>
                <p class="text-sm text-white text-opacity-90 text-center mb-4">${box.subtitle}</p>
                ${isUnlocked ? '<div class="text-center text-white font-bold text-lg">‚úì D√âVERROUILL√â</div>' :
                 isCurrent ? '<div class="text-center text-white font-bold text-lg animate-pulse glow">üéØ CLIQUE ICI !</div>' :
                 '<div class="text-center text-white text-opacity-70">üîí Verrouill√©</div>'}
            </div>
        `;

        if (isCurrent || isUnlocked) {
            boxElement.addEventListener('click', () => {
                playSound('tick');
                createChestOpenEffect(boxElement); // Effet de particules !
                gameState.currentBoxIndex = index;
                gameState.currentGameIndex = 0;
                gameState.gameScore = 0;
                loadBoxGame();
            });
        }

        container.appendChild(boxElement);
    });

    updateBoxesDisplay();
}

function updateBoxesDisplay() {
    // Protections contre NaN
    const safeScore = isNaN(gameState.totalScore) ? 0 : gameState.totalScore;
    const safeBoxes = isNaN(gameState.boxesUnlocked) ? 0 : gameState.boxesUnlocked;

    console.log('üìä updateBoxesDisplay():', {
        totalScore: gameState.totalScore,
        boxesUnlocked: gameState.boxesUnlocked,
        safeScore: safeScore,
        safeBoxes: safeBoxes
    });

    document.getElementById('total-score-display').textContent = safeScore;
    document.getElementById('boxes-unlocked').textContent = `${safeBoxes}/${boxesData.length}`;
}

// ==================== CHARGER UN JEU ====================

function loadBoxGame() {
    const box = boxesData[gameState.currentBoxIndex];

    // S√©lectionner al√©atoirement un jeu parmi les variations disponibles
    const gameVariations = box.games[gameState.currentGameIndex];
    if (!gameVariations) {
        unlockBox();
        return;
    }

    // Si c'est un tableau de variations, en choisir une au hasard
    const game = Array.isArray(gameVariations) ?
        gameVariations[Math.floor(Math.random() * gameVariations.length)] :
        gameVariations;

    gameState.attempts = gameState.maxAttempts;
    gameState.timeLeft = game.timeLimit;
    gameState.currentAnswer = null;

    showScreen('game-screen');
    updateGameDisplay();

    const container = document.getElementById('current-game');
    container.className = 'glass-morphism rounded-3xl shadow-2xl p-6 md:p-8 bounce-in';

    document.getElementById('reset-answer-btn').classList.add('hidden');

    switch(game.type) {
        case 'quiz':
            renderQuiz(game, container);
            break;
        case 'true-false':
            renderTrueFalse(game, container);
            break;
        case 'quiz-illustrated':
            renderQuizIllustrated(game, container);
            break;
        case 'quiz-multi':
            renderQuizMulti(game, container);
            break;
        case 'matching':
            renderMatching(game, container);
            break;
        case 'sequence':
            renderSequence(game, container);
            break;
        case 'puzzle-text':
            renderPuzzleText(game, container);
            break;
        case 'draw':
            renderDraw(game, container);
            break;
        case 'image-puzzle':
            renderImagePuzzle(game, container);
            break;
        case 'video-quiz':
            renderVideoQuiz(game, container);
            break;
        case 'image-quiz':
            renderImageQuiz(game, container);
            break;
    }

    startTimer();
}

// ==================== RENDU DES JEUX ====================

// QUIZ SIMPLE
function renderQuiz(game, container) {
    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-6">${game.question}</h2>
        </div>
        <div id="quiz-options" class="space-y-4">
            ${game.options.map((option, index) => `
                <button class="quiz-option w-full text-left p-5 md:p-6 rounded-2xl border-3 border-gray-300 dark:border-gray-600 hover:border-primary hover:bg-gradient-to-r hover:from-primary hover:to-purple-600 hover:text-white transition-all duration-300 text-base md:text-lg font-semibold text-gray-700 dark:text-gray-300 shadow-lg" data-index="${index}">
                    <span class="inline-block w-8 h-8 rounded-full bg-primary text-white text-center leading-8 mr-3 font-bold">${String.fromCharCode(65 + index)}</span>
                    ${option}
                </button>
            `).join('')}
        </div>
    `;

    document.querySelectorAll('.quiz-option').forEach(btn => {
        btn.addEventListener('click', () => {
            playSound('tick');
            gameState.currentAnswer = parseInt(btn.dataset.index);

            document.querySelectorAll('.quiz-option').forEach(b => {
                b.classList.remove('border-primary', 'bg-gradient-to-r', 'from-primary', 'to-purple-600', 'text-white', 'scale-105', 'shadow-2xl');
                b.classList.add('border-gray-300', 'dark:border-gray-600');
            });

            btn.classList.remove('border-gray-300', 'dark:border-gray-600');
            btn.classList.add('border-primary', 'bg-gradient-to-r', 'from-primary', 'to-purple-600', 'text-white', 'scale-105', 'shadow-2xl');

            document.getElementById('reset-answer-btn').classList.remove('hidden');
        });
    });

    setupValidation(() => {
        if (gameState.currentAnswer === null) {
            showCustomAlert('‚ö†Ô∏è Veuillez s√©lectionner une r√©ponse !');
            return false;
        }
        return gameState.currentAnswer === game.correctAnswer;
    });
}

// TRUE-FALSE (Vrai/Faux)
function renderTrueFalse(game, container) {
    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-8 text-center">${game.question}</h2>
        </div>
        <div id="true-false-options" class="grid grid-cols-2 gap-6 max-w-2xl mx-auto">
            <button class="true-false-option h-40 flex flex-col items-center justify-center p-6 rounded-3xl border-4 border-green-300 hover:border-green-500 hover:bg-gradient-to-br hover:from-green-500 hover:to-emerald-600 hover:text-white transition-all duration-300 text-xl font-bold text-gray-700 dark:text-gray-300 shadow-xl hover:scale-110 hover:shadow-2xl" data-index="0">
                <div class="text-6xl mb-3">‚úì</div>
                <div class="text-2xl">${game.options[0]}</div>
            </button>
            <button class="true-false-option h-40 flex flex-col items-center justify-center p-6 rounded-3xl border-4 border-red-300 hover:border-red-500 hover:bg-gradient-to-br hover:from-red-500 hover:to-pink-600 hover:text-white transition-all duration-300 text-xl font-bold text-gray-700 dark:text-gray-300 shadow-xl hover:scale-110 hover:shadow-2xl" data-index="1">
                <div class="text-6xl mb-3">‚úó</div>
                <div class="text-2xl">${game.options[1]}</div>
            </button>
        </div>
        ${game.explanation ? `<div class="mt-6 p-4 bg-blue-100 dark:bg-blue-900 dark:bg-opacity-30 rounded-xl text-sm text-gray-700 dark:text-gray-300 text-center opacity-0" id="explanation-text">üí° ${game.explanation}</div>` : ''}
    `;

    document.querySelectorAll('.true-false-option').forEach(btn => {
        btn.addEventListener('click', () => {
            playSound('tick');
            gameState.currentAnswer = parseInt(btn.dataset.index);

            document.querySelectorAll('.true-false-option').forEach(b => {
                b.classList.remove('scale-110', 'shadow-2xl', 'ring-4', 'ring-yellow-400');
            });

            btn.classList.add('scale-110', 'shadow-2xl', 'ring-4', 'ring-yellow-400');

            // Afficher l'explication si elle existe
            if (game.explanation) {
                const explanation = document.getElementById('explanation-text');
                explanation.style.opacity = '1';
                explanation.classList.add('bounce-in');
            }

            document.getElementById('reset-answer-btn').classList.remove('hidden');
        });
    });

    setupValidation(() => {
        if (gameState.currentAnswer === null) {
            showCustomAlert('‚ö†Ô∏è Veuillez s√©lectionner une r√©ponse !');
            return false;
        }
        return gameState.currentAnswer === game.correctAnswer;
    });
}

// QUIZ ILLUSTR√â (Quiz avec illustration SVG - L'IMAGE S'AFFICHE APR√àS LA R√âPONSE)
function renderQuizIllustrated(game, container) {
    // Obtenir l'illustration SVG depuis la fonction
    const svgFunction = window[game.illustrationFunction];
    const illustrationHTML = svgFunction ? svgFunction() : '';

    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
        </div>

        <!-- Illustration SVG (cach√©e au d√©part) -->
        <div id="illustration-reveal" class="hidden mb-6 p-4 bg-gradient-to-br from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-2xl shadow-lg bounce-in">
            <div class="text-center mb-3 text-green-600 dark:text-green-400 font-bold text-xl">‚úì Bonne r√©ponse ! Voici l'illustration :</div>
            ${illustrationHTML}
        </div>

        <!-- Question -->
        <div class="mb-6">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 dark:text-white mb-6 text-center">${game.question}</h2>
        </div>

        <div id="quiz-options" class="space-y-4">
            ${game.options.map((option, index) => `
                <button class="quiz-option w-full text-left p-4 md:p-5 rounded-2xl border-3 border-gray-300 dark:border-gray-600 hover:border-primary hover:bg-gradient-to-r hover:from-primary hover:to-purple-600 hover:text-white transition-all duration-300 text-base md:text-lg font-semibold text-gray-700 dark:text-gray-300 shadow-lg" data-index="${index}">
                    <span class="inline-block w-8 h-8 rounded-full bg-primary text-white text-center leading-8 mr-3 font-bold">${String.fromCharCode(65 + index)}</span>
                    ${option}
                </button>
            `).join('')}
        </div>
    `;

    document.querySelectorAll('.quiz-option').forEach(btn => {
        btn.addEventListener('click', () => {
            playSound('tick');
            gameState.currentAnswer = parseInt(btn.dataset.index);

            document.querySelectorAll('.quiz-option').forEach(b => {
                b.classList.remove('border-primary', 'bg-gradient-to-r', 'from-primary', 'to-purple-600', 'text-white', 'scale-105', 'shadow-2xl');
                b.classList.add('border-gray-300', 'dark:border-gray-600');
            });

            btn.classList.remove('border-gray-300', 'dark:border-gray-600');
            btn.classList.add('border-primary', 'bg-gradient-to-r', 'from-primary', 'to-purple-600', 'text-white', 'scale-105', 'shadow-2xl');

            document.getElementById('reset-answer-btn').classList.remove('hidden');
        });
    });

    setupValidation(() => {
        if (gameState.currentAnswer === null) {
            showCustomAlert('‚ö†Ô∏è Veuillez s√©lectionner une r√©ponse !');
            return false;
        }
        const isCorrect = gameState.currentAnswer === game.correctAnswer;

        // Si bonne r√©ponse, afficher l'illustration
        if (isCorrect) {
            const illustrationDiv = document.getElementById('illustration-reveal');
            if (illustrationDiv) {
                illustrationDiv.classList.remove('hidden');
            }
        }

        return isCorrect;
    });
}

// QUIZ MULTI (reste du code dans le prochain message pour ne pas d√©passer la limite)
function renderQuizMulti(game, container) {
    const selectedAnswers = new Set();

    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-4">${game.question}</h2>
            <p class="text-sm text-orange-600 dark:text-orange-400 font-semibold">‚ö†Ô∏è Plusieurs r√©ponses correctes</p>
        </div>
        <div id="quiz-multi-options" class="space-y-4">
            ${game.options.map((option, index) => `
                <button class="quiz-multi-option w-full text-left p-5 md:p-6 rounded-2xl border-3 border-gray-300 dark:border-gray-600 hover:border-primary transition-all duration-300 text-base md:text-lg font-semibold text-gray-700 dark:text-gray-300 shadow-lg" data-index="${index}">
                    <span class="inline-block w-8 h-8 rounded-lg border-2 border-gray-400 text-center leading-7 mr-3 option-checkbox"></span>
                    ${option}
                </button>
            `).join('')}
        </div>
    `;

    document.querySelectorAll('.quiz-multi-option').forEach(btn => {
        btn.addEventListener('click', () => {
            playSound('tick');
            const index = parseInt(btn.dataset.index);

            if (selectedAnswers.has(index)) {
                selectedAnswers.delete(index);
                btn.classList.remove('border-primary', 'bg-gradient-to-r', 'from-primary', 'to-purple-600', 'text-white');
                btn.querySelector('.option-checkbox').textContent = '';
            } else {
                selectedAnswers.add(index);
                btn.classList.add('border-primary', 'bg-gradient-to-r', 'from-primary', 'to-purple-600', 'text-white');
                btn.querySelector('.option-checkbox').textContent = '‚úì';
            }

            gameState.currentAnswer = Array.from(selectedAnswers).sort((a, b) => a - b);
            document.getElementById('reset-answer-btn').classList.remove('hidden');
        });
    });

    setupValidation(() => {
        if (!gameState.currentAnswer || gameState.currentAnswer.length === 0) {
            showCustomAlert('‚ö†Ô∏è Veuillez s√©lectionner au moins une r√©ponse !');
            return false;
        }
        return JSON.stringify(gameState.currentAnswer) === JSON.stringify(game.correctAnswers.sort((a, b) => a - b));
    });
}

// APPARIEMENT (suite dans le prochain fichier si n√©cessaire - je vais condenser)
function renderMatching(game, container) {
    const shuffledRight = [...game.pairs.map((p, i) => ({ value: p.right, index: i }))].sort(() => Math.random() - 0.5);
    const matches = {};
    let selectedLeft = null;
    let selectedRight = null;

    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-4">${game.question}</h2>
            <p class="text-sm text-blue-600 dark:text-blue-400 font-semibold">üí° Cliquez gauche puis droite</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6">
            <div id="left-column" class="space-y-3">
                ${game.pairs.map((pair, index) => `
                    <button class="matching-left-item matching-item w-full p-5 bg-gradient-to-r from-blue-400 to-blue-600 rounded-xl font-semibold text-white border-3 border-blue-300 shadow-lg hover:shadow-2xl transition-all" data-index="${index}">
                        ${pair.left}
                    </button>
                `).join('')}
            </div>
            <div id="right-column" class="space-y-3">
                ${shuffledRight.map((item) => `
                    <button class="matching-right-item matching-item w-full p-5 bg-gradient-to-r from-green-400 to-green-600 rounded-xl font-semibold text-white border-3 border-green-300 shadow-lg hover:shadow-2xl transition-all" data-index="${item.index}">
                        ${item.value}
                    </button>
                `).join('')}
            </div>
        </div>
        <div class="bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900 dark:to-pink-900 rounded-xl p-6">
            <div class="font-bold text-gray-800 dark:text-white mb-3">üìù Associations :</div>
            <div id="matches-list" class="text-gray-700 dark:text-gray-300">Aucune</div>
        </div>
    `;

    function updateMatchesDisplay() {
        const matchesList = document.getElementById('matches-list');
        if (Object.keys(matches).length === 0) {
            matchesList.innerHTML = 'Aucune';
        } else {
            matchesList.innerHTML = Object.entries(matches).map(([leftIndex, rightIndex]) => {
                const leftValue = game.pairs[leftIndex].left;
                const rightValue = game.pairs[rightIndex].right;
                return `<div class="flex items-center gap-3 mb-2 p-3 bg-white dark:bg-gray-800 rounded-lg">
                    <span class="flex-1 font-semibold text-blue-600">${leftValue}</span>
                    <span class="text-2xl">‚Üí</span>
                    <span class="flex-1 font-semibold text-green-600">${rightValue}</span>
                    <button class="text-red-500 hover:text-red-700 font-bold" onclick="removeMatch(${leftIndex})">‚úï</button>
                </div>`;
            }).join('');
        }
    }

    window.removeMatch = (leftIndex) => {
        delete matches[leftIndex];
        document.querySelectorAll('.matching-left-item, .matching-right-item').forEach(btn => {
            btn.classList.remove('matched', 'opacity-50');
        });
        updateMatchesDisplay();
        gameState.currentAnswer = matches;
        playSound('tick');
    };

    document.querySelectorAll('.matching-left-item').forEach(btn => {
        btn.addEventListener('click', () => {
            playSound('tick');
            const index = parseInt(btn.dataset.index);
            if (matches[index]) return;

            document.querySelectorAll('.matching-left-item').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedLeft = index;

            if (selectedRight !== null) {
                matches[selectedLeft] = selectedRight;
                btn.classList.add('matched', 'opacity-50');
                document.querySelectorAll('.matching-right-item').forEach(b => {
                    if (parseInt(b.dataset.index) === selectedRight) b.classList.add('matched', 'opacity-50');
                    b.classList.remove('selected');
                });
                updateMatchesDisplay();
                gameState.currentAnswer = matches;
                selectedLeft = null;
                selectedRight = null;
                document.getElementById('reset-answer-btn').classList.remove('hidden');
            }
        });
    });

    document.querySelectorAll('.matching-right-item').forEach(btn => {
        btn.addEventListener('click', () => {
            playSound('tick');
            const index = parseInt(btn.dataset.index);
            if (Object.values(matches).includes(index)) return;

            document.querySelectorAll('.matching-right-item').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            selectedRight = index;

            if (selectedLeft !== null) {
                matches[selectedLeft] = selectedRight;
                btn.classList.add('matched', 'opacity-50');
                document.querySelectorAll('.matching-left-item').forEach(b => {
                    if (parseInt(b.dataset.index) === selectedLeft) b.classList.add('matched', 'opacity-50');
                    b.classList.remove('selected');
                });
                updateMatchesDisplay();
                gameState.currentAnswer = matches;
                selectedLeft = null;
                selectedRight = null;
                document.getElementById('reset-answer-btn').classList.remove('hidden');
            }
        });
    });

    setupValidation(() => {
        if (Object.keys(matches).length < game.pairs.length) {
            showCustomAlert('‚ö†Ô∏è Compl√©tez toutes les associations !');
            return false;
        }
        // V√©rifier que chaque association gauche -> droite correspond bien
        // matches[leftIndex] donne rightIndex, il faut que ce soit le bon
        return game.pairs.every((pair, leftIndex) => {
            const rightIndex = matches[leftIndex];
            if (rightIndex === undefined) return false;
            // V√©rifier que l'√©l√©ment de droite correspond bien √† l'√©l√©ment de gauche
            return game.pairs[leftIndex].right === game.pairs[rightIndex].right;
        });
    });
}

// S√âQUENCE
function renderSequence(game, container) {
    const currentOrder = [...game.items.map((item, i) => i)].sort(() => Math.random() - 0.5);
    let selectedItems = [];

    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-4">${game.question}</h2>
            <p class="text-sm text-blue-600 dark:text-blue-400 font-semibold">üí° Cliquez dans le bon ordre</p>
        </div>
        <div id="sequence-items" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            ${currentOrder.map(index => `
                <button class="sequence-item p-6 bg-gradient-to-r from-indigo-400 to-purple-600 rounded-xl font-semibold text-white shadow-lg hover:shadow-2xl border-3 border-transparent" data-index="${index}">
                    ${game.items[index]}
                </button>
            `).join('')}
        </div>
        <div class="bg-gradient-to-r from-blue-100 to-purple-100 dark:from-blue-900 dark:to-purple-900 rounded-xl p-6">
            <div class="font-bold text-gray-800 dark:text-white mb-3">üìù Votre ordre :</div>
            <div id="sequence-order" class="text-gray-700 dark:text-gray-300">Cliquez...</div>
        </div>
    `;

    function updateSequenceDisplay() {
        const orderDiv = document.getElementById('sequence-order');
        if (selectedItems.length === 0) {
            orderDiv.innerHTML = 'Cliquez...';
        } else {
            orderDiv.innerHTML = selectedItems.map((index, position) =>
                `<div class="inline-block mr-3 mb-2 p-3 bg-white dark:bg-gray-800 rounded-lg shadow">
                    <span class="font-bold text-primary mr-2">${position + 1}.</span>
                    <span class="font-semibold">${game.items[index]}</span>
                </div>`
            ).join('');
        }
    }

    document.querySelectorAll('.sequence-item').forEach(btn => {
        btn.addEventListener('click', () => {
            const index = parseInt(btn.dataset.index);

            if (selectedItems.includes(index)) {
                const pos = selectedItems.indexOf(index);
                selectedItems.splice(pos, 1);
                btn.classList.remove('selected', 'opacity-50', 'border-yellow-400');
                btn.classList.add('border-transparent');
            } else {
                selectedItems.push(index);
                btn.classList.add('selected', 'opacity-50', 'border-yellow-400');
            }

            playSound('tick');
            updateSequenceDisplay();
            gameState.currentAnswer = selectedItems;

            if (selectedItems.length > 0) {
                document.getElementById('reset-answer-btn').classList.remove('hidden');
            }
        });
    });

    setupValidation(() => {
        if (selectedItems.length !== game.items.length) {
            showCustomAlert('‚ö†Ô∏è Ordonnez tous les √©l√©ments !');
            return false;
        }
        return JSON.stringify(selectedItems) === JSON.stringify(game.correctOrder);
    });
}

// PUZZLE
function renderPuzzleText(game, container) {
    const shuffledPieces = [...game.pieces.map((p, i) => ({ text: p, index: i }))].sort(() => Math.random() - 0.5);
    let placedPieces = Array(game.pieces.length).fill(null);

    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-4">${game.question}</h2>
        </div>
        <div class="mb-6">
            <div class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Zone :</div>
            <div id="puzzle-target" class="space-y-3">
                ${game.pieces.map((_, index) => `
                    <div class="puzzle-slot min-h-16 p-4 border-3 border-dashed border-gray-400 rounded-xl flex items-center justify-center text-gray-400 font-semibold bg-gray-50 dark:bg-gray-800" data-slot="${index}">
                        Position ${index + 1}
                    </div>
                `).join('')}
            </div>
        </div>
        <div>
            <div class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Pi√®ces :</div>
            <div id="puzzle-pieces" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                ${shuffledPieces.map((piece) => `
                    <div class="puzzle-piece cursor-pointer" data-piece-index="${piece.index}">
                        ${piece.text}
                    </div>
                `).join('')}
            </div>
        </div>
    `;

    let selectedPiece = null;

    document.querySelectorAll('.puzzle-piece').forEach(piece => {
        piece.addEventListener('click', () => {
            if (piece.classList.contains('correct')) return;
            playSound('tick');
            document.querySelectorAll('.puzzle-piece').forEach(p => p.classList.remove('ring-4', 'ring-yellow-400'));
            piece.classList.add('ring-4', 'ring-yellow-400');
            selectedPiece = parseInt(piece.dataset.pieceIndex);
        });
    });

    document.querySelectorAll('.puzzle-slot').forEach(slot => {
        slot.addEventListener('click', () => {
            if (selectedPiece === null) {
                showCustomAlert('‚ö†Ô∏è S√©lectionnez une pi√®ce !');
                return;
            }

            const slotIndex = parseInt(slot.dataset.slot);

            if (placedPieces[slotIndex] !== null) {
                document.querySelectorAll('.puzzle-piece').forEach(p => {
                    if (parseInt(p.dataset.pieceIndex) === placedPieces[slotIndex]) {
                        p.classList.remove('correct', 'opacity-30');
                    }
                });
            }

            placedPieces[slotIndex] = selectedPiece;
            slot.innerHTML = `<div class="text-white font-semibold">${game.pieces[selectedPiece]}</div>`;
            slot.classList.remove('border-gray-400', 'bg-gray-50');
            slot.classList.add('bg-gradient-to-r', 'from-green-400', 'to-green-600', 'border-green-300');

            document.querySelectorAll('.puzzle-piece').forEach(p => {
                if (parseInt(p.dataset.pieceIndex) === selectedPiece) {
                    p.classList.add('correct', 'opacity-30');
                    p.classList.remove('ring-4', 'ring-yellow-400');
                }
            });

            playSound('success');
            selectedPiece = null;
            gameState.currentAnswer = placedPieces;
            document.getElementById('reset-answer-btn').classList.remove('hidden');
        });
    });

    setupValidation(() => {
        if (placedPieces.includes(null)) {
            showCustomAlert('‚ö†Ô∏è Placez toutes les pi√®ces !');
            return false;
        }
        return placedPieces.every((piece, index) => piece === game.correctOrder[index]);
    });
}

// DESSIN
function renderDraw(game, container) {
    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-4">${game.question}</h2>
        </div>
        <div class="mb-4 flex gap-3 flex-wrap">
            <button id="color-black" class="w-12 h-12 bg-black rounded-full border-4 border-gray-300 hover:scale-110 transition-all"></button>
            <button id="color-red" class="w-12 h-12 bg-red-500 rounded-full border-4 border-gray-300 hover:scale-110 transition-all"></button>
            <button id="color-blue" class="w-12 h-12 bg-blue-500 rounded-full border-4 border-gray-300 hover:scale-110 transition-all"></button>
            <button id="clear-canvas" class="px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700">üóëÔ∏è Effacer</button>
        </div>
        <canvas id="draw-canvas" class="draw-canvas w-full" width="800" height="500"></canvas>
    `;

    const canvas = document.getElementById('draw-canvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let currentColor = '#000000';

    ctx.fillStyle = '#FFFFFF';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    function startDrawing(e) {
        isDrawing = true;
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (canvas.width / rect.width);
        const y = (e.clientY - rect.top) * (canvas.height / rect.height);
        ctx.beginPath();
        ctx.moveTo(x, y);
    }

    function draw(e) {
        if (!isDrawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (canvas.width / rect.width);
        const y = (e.clientY - rect.top) * (canvas.height / rect.height);
        ctx.lineTo(x, y);
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
        ctx.stroke();
        gameState.currentAnswer = true;
        document.getElementById('reset-answer-btn').classList.remove('hidden');
    }

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', () => isDrawing = false);
    canvas.addEventListener('mouseout', () => isDrawing = false);

    // Touch support
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
        const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
        ctx.beginPath();
        ctx.moveTo(x, y);
        isDrawing = true;
    });

    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        if (!isDrawing) return;
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
        const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
        ctx.lineTo(x, y);
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
        ctx.stroke();
    });

    canvas.addEventListener('touchend', () => isDrawing = false);

    document.getElementById('color-black').addEventListener('click', () => { currentColor = '#000000'; playSound('tick'); });
    document.getElementById('color-red').addEventListener('click', () => { currentColor = '#FF0000'; playSound('tick'); });
    document.getElementById('color-blue').addEventListener('click', () => { currentColor = '#0000FF'; playSound('tick'); });
    document.getElementById('clear-canvas').addEventListener('click', () => {
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        gameState.currentAnswer = null;
        playSound('tick');
    });

    setupValidation(() => {
        if (!gameState.currentAnswer) {
            showCustomAlert('‚ö†Ô∏è Dessinez quelque chose !');
            return false;
        }
        return true;
    });
}

// IMAGE PUZZLE (Puzzle d'image √† reconstituer)
function renderImagePuzzle(game, container) {
    // Obtenir l'illustration SVG
    const svgFunction = window[game.illustrationFunction];
    const fullImageHTML = svgFunction ? svgFunction() : '';

    // Cr√©er les pi√®ces du puzzle (grille 3x3 = 9 pi√®ces)
    const gridSize = game.gridSize || 3; // 3x3 par d√©faut
    const totalPieces = gridSize * gridSize;

    // M√©langer les positions
    const positions = Array.from({length: totalPieces}, (_, i) => i);
    const shuffledPositions = positions.sort(() => Math.random() - 0.5);

    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 dark:text-white mb-4 text-center">${game.question}</h2>
            <p class="text-center text-gray-600 dark:text-gray-400 mb-4">üí° Cliquez sur 2 pi√®ces pour les √©changer</p>
        </div>

        <!-- Image de r√©f√©rence (mini) -->
        <div class="mb-6 flex justify-center">
            <button id="toggle-hint" class="px-4 py-2 bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-lg font-semibold hover:from-yellow-600 hover:to-orange-600 transition-all shadow-lg">
                üí° Voir l'image compl√®te
            </button>
        </div>

        <div id="hint-container" class="hidden mb-6 p-4 bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-gray-800 dark:to-gray-700 rounded-2xl shadow-lg">
            <div class="max-w-sm mx-auto opacity-60">
                ${fullImageHTML}
            </div>
        </div>

        <!-- Grille de puzzle -->
        <div id="puzzle-grid" class="grid gap-2 max-w-2xl mx-auto mb-4" style="grid-template-columns: repeat(${gridSize}, 1fr);">
            ${shuffledPositions.map((position, index) => `
                <div class="puzzle-tile cursor-pointer border-4 border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden hover:border-primary transition-all duration-200 bg-white dark:bg-gray-800 aspect-square relative"
                     data-current-pos="${index}"
                     data-correct-pos="${position}"
                     style="min-height: 80px;">
                    <div class="absolute inset-0 flex items-center justify-center p-2">
                        <div class="puzzle-piece-content transform scale-[${gridSize}] origin-center" style="transform: translate(${-(position % gridSize) * 100}%, ${-Math.floor(position / gridSize) * 100}%);">
                            ${fullImageHTML}
                        </div>
                    </div>
                    <div class="absolute top-1 right-1 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded">${index + 1}</div>
                </div>
            `).join('')}
        </div>

        <div class="text-center">
            <button id="check-puzzle" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-bold hover:from-green-600 hover:to-emerald-700 transition-all shadow-lg text-lg">
                ‚úì V√©rifier le puzzle
            </button>
        </div>
    `;

    let selectedTile = null;
    const tiles = document.querySelectorAll('.puzzle-tile');

    // Toggle hint
    document.getElementById('toggle-hint').addEventListener('click', () => {
        const hintContainer = document.getElementById('hint-container');
        hintContainer.classList.toggle('hidden');
        playSound('tick');
    });

    // Gestion des clics sur les pi√®ces
    tiles.forEach(tile => {
        tile.addEventListener('click', () => {
            playSound('tick');

            if (selectedTile === null) {
                // Premi√®re s√©lection
                selectedTile = tile;
                tile.classList.add('ring-4', 'ring-yellow-400', 'scale-105');
            } else if (selectedTile === tile) {
                // D√©s√©lection
                tile.classList.remove('ring-4', 'ring-yellow-400', 'scale-105');
                selectedTile = null;
            } else {
                // √âchange des pi√®ces
                const pos1 = selectedTile.dataset.correctPos;
                const pos2 = tile.dataset.correctPos;

                selectedTile.dataset.correctPos = pos2;
                tile.dataset.correctPos = pos1;

                // √âchanger visuellement le contenu
                const content1 = selectedTile.querySelector('.puzzle-piece-content').innerHTML;
                const content2 = tile.querySelector('.puzzle-piece-content').innerHTML;

                selectedTile.querySelector('.puzzle-piece-content').innerHTML = content2;
                tile.querySelector('.puzzle-piece-content').innerHTML = content1;

                // Mise √† jour des styles de transformation
                const gridSize = game.gridSize || 3;
                selectedTile.querySelector('.puzzle-piece-content').style.transform =
                    `translate(${-(parseInt(pos2) % gridSize) * 100}%, ${-Math.floor(parseInt(pos2) / gridSize) * 100}%)`;
                tile.querySelector('.puzzle-piece-content').style.transform =
                    `translate(${-(parseInt(pos1) % gridSize) * 100}%, ${-Math.floor(parseInt(pos1) / gridSize) * 100}%)`;

                selectedTile.classList.remove('ring-4', 'ring-yellow-400', 'scale-105');
                selectedTile = null;
            }
        });
    });

    // V√©rification du puzzle
    document.getElementById('check-puzzle').addEventListener('click', () => {
        playSound('tick');
        let isCorrect = true;

        tiles.forEach(tile => {
            const currentPos = parseInt(tile.dataset.currentPos);
            const correctPos = parseInt(tile.dataset.correctPos);

            if (currentPos !== correctPos) {
                isCorrect = false;
            }
        });

        if (isCorrect) {
            gameState.currentAnswer = true;
            tiles.forEach(tile => {
                tile.classList.add('border-green-500', 'border-4');
            });
            playSound('success');
            setTimeout(() => validateAnswer(true), 500);
        } else {
            showCustomAlert('‚ùå Pas tout √† fait ! Continuez √† √©changer les pi√®ces.');
            playSound('error');
        }
    });

    setupValidation(() => {
        return gameState.currentAnswer === true;
    });
}

// VIDEO QUIZ (avec vid√©o YouTube int√©gr√©e)
function renderVideoQuiz(game, container) {
    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-6">${game.question}</h2>
        </div>
        ${game.videoUrl ? `
            <div class="mb-6">
                <div class="relative aspect-video rounded-xl overflow-hidden shadow-2xl">
                    <iframe class="w-full h-full" src="${game.videoUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
            </div>
        ` : ''}
        <div id="quiz-options" class="space-y-4">
            ${game.options.map((option, index) => `
                <button class="quiz-option w-full text-left p-5 md:p-6 rounded-2xl border-3 border-gray-300 dark:border-gray-600 hover:border-primary hover:bg-gradient-to-r hover:from-primary hover:to-purple-600 hover:text-white transition-all duration-300 text-base md:text-lg font-semibold text-gray-700 dark:text-gray-300 shadow-lg" data-index="${index}">
                    <span class="inline-block w-8 h-8 rounded-full bg-primary text-white text-center leading-8 mr-3 font-bold">${String.fromCharCode(65 + index)}</span>
                    ${option}
                </button>
            `).join('')}
        </div>
    `;

    document.querySelectorAll('.quiz-option').forEach(btn => {
        btn.addEventListener('click', () => {
            playSound('tick');
            gameState.currentAnswer = parseInt(btn.dataset.index);

            document.querySelectorAll('.quiz-option').forEach(b => {
                b.classList.remove('border-primary', 'bg-gradient-to-r', 'from-primary', 'to-purple-600', 'text-white', 'scale-105', 'shadow-2xl');
                b.classList.add('border-gray-300', 'dark:border-gray-600');
            });

            btn.classList.remove('border-gray-300', 'dark:border-gray-600');
            btn.classList.add('border-primary', 'bg-gradient-to-r', 'from-primary', 'to-purple-600', 'text-white', 'scale-105', 'shadow-2xl');

            document.getElementById('reset-answer-btn').classList.remove('hidden');
        });
    });

    setupValidation(() => {
        if (gameState.currentAnswer === null) {
            showCustomAlert('‚ö†Ô∏è Veuillez s√©lectionner une r√©ponse !');
            return false;
        }
        return gameState.currentAnswer === game.correctAnswer;
    });
}

// IMAGE QUIZ (avec image)
function renderImageQuiz(game, container) {
    container.innerHTML = `
        <div class="mb-6">
            <div class="inline-block px-4 py-2 bg-gradient-to-r ${boxesData[gameState.currentBoxIndex].color} text-white rounded-full text-sm font-bold mb-3">${game.title}</div>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-6">${game.question}</h2>
        </div>
        ${game.imageData ? `
            <div class="mb-6 flex justify-center">
                <div class="max-w-2xl rounded-xl overflow-hidden shadow-2xl border-4 border-primary">
                    <img src="${game.imageData}" alt="Question image" class="w-full h-auto">
                </div>
            </div>
        ` : ''}
        <div id="quiz-options" class="space-y-4">
            ${game.options.map((option, index) => `
                <button class="quiz-option w-full text-left p-5 md:p-6 rounded-2xl border-3 border-gray-300 dark:border-gray-600 hover:border-primary hover:bg-gradient-to-r hover:from-primary hover:to-purple-600 hover:text-white transition-all duration-300 text-base md:text-lg font-semibold text-gray-700 dark:text-gray-300 shadow-lg" data-index="${index}">
                    <span class="inline-block w-8 h-8 rounded-full bg-primary text-white text-center leading-8 mr-3 font-bold">${String.fromCharCode(65 + index)}</span>
                    ${option}
                </button>
            `).join('')}
        </div>
    `;

    document.querySelectorAll('.quiz-option').forEach(btn => {
        btn.addEventListener('click', () => {
            playSound('tick');
            gameState.currentAnswer = parseInt(btn.dataset.index);

            document.querySelectorAll('.quiz-option').forEach(b => {
                b.classList.remove('border-primary', 'bg-gradient-to-r', 'from-primary', 'to-purple-600', 'text-white', 'scale-105', 'shadow-2xl');
                b.classList.add('border-gray-300', 'dark:border-gray-600');
            });

            btn.classList.remove('border-gray-300', 'dark:border-gray-600');
            btn.classList.add('border-primary', 'bg-gradient-to-r', 'from-primary', 'to-purple-600', 'text-white', 'scale-105', 'shadow-2xl');

            document.getElementById('reset-answer-btn').classList.remove('hidden');
        });
    });

    setupValidation(() => {
        if (gameState.currentAnswer === null) {
            showCustomAlert('‚ö†Ô∏è Veuillez s√©lectionner une r√©ponse !');
            return false;
        }
        return gameState.currentAnswer === game.correctAnswer;
    });
}

// ==================== VALIDATION ====================

function setupValidation(validateFunction) {
    document.getElementById('validate-btn').onclick = () => {
        const isCorrect = validateFunction();
        if (isCorrect !== false) {
            validateAnswer(isCorrect);
        }
    };

    document.getElementById('reset-answer-btn').onclick = () => {
        playSound('tick');
        gameState.currentAnswer = null;
        loadBoxGame();
    };
}

// Fonction helper pour obtenir la bonne r√©ponse format√©e selon le type de jeu
function getCorrectAnswerText(game) {
    if (game.type === 'quiz' || game.type === 'true-false') {
        return `<div class="text-lg"><strong>Bonne r√©ponse :</strong> ${game.options[game.correctAnswer]}</div>`;
    } else if (game.type === 'quiz-multi') {
        const correctOpts = game.correctAnswers.map(i => game.options[i]).join(', ');
        return `<div class="text-lg"><strong>Bonnes r√©ponses :</strong> ${correctOpts}</div>`;
    } else if (game.type === 'sequence' || game.type === 'puzzle-text') {
        const correctSeq = game.correctOrder.map(i => game.items ? game.items[i] : game.pieces[i]).join(' ‚Üí ');
        return `<div class="text-lg"><strong>Ordre correct :</strong><br>${correctSeq}</div>`;
    } else if (game.type === 'matching') {
        const pairs = game.pairs.map(p => `${p.left} ‚Üî ${p.right}`).join('<br>');
        return `<div class="text-lg"><strong>Bonnes associations :</strong><br>${pairs}</div>`;
    } else if (game.type === 'draw') {
        return `<div class="text-lg"><strong>Dessin valid√©</strong></div>`;
    }
    return '';
}

function validateAnswer(isCorrect) {
    stopTimer();

    // R√©cup√©rer le jeu actuel AVANT toute modification
    const box = boxesData[gameState.currentBoxIndex];
    const gameVariations = box.games[gameState.currentGameIndex];
    const currentGame = Array.isArray(gameVariations) ?
        gameVariations[0] : gameVariations; // Prendre le premier pour afficher la r√©ponse

    if (isCorrect) {
        playSound('bravo'); // Son "bravo" au lieu de "success"

        // PROTECTION: S'assurer que currentGame.timeLimit et currentGame.points existent
        const timeLimit = currentGame.timeLimit || 60;
        const basePoints = currentGame.points || 100;

        const timeBonus = Math.floor(gameState.timeLeft / timeLimit * 50);
        const points = basePoints + timeBonus;

        console.log('üîç CALCUL DES POINTS:', {
            gameType: currentGame.type,
            basePoints: basePoints,
            timeLeft: gameState.timeLeft,
            timeLimit: timeLimit,
            timeBonus: timeBonus,
            points: points
        });

        gameState.gameScore += points;
        gameState.totalScore += points;
        gameState.stats.gamesWon++;
        gameState.stats.totalTime += (timeLimit - gameState.timeLeft);

        // DEBUG: Afficher le score apr√®s ajout
        console.log('‚úÖ Points ajout√©s:', {
            points: points,
            totalScore: gameState.totalScore,
            boxesUnlocked: gameState.boxesUnlocked
        });

        createConfetti();
        showFeedback(`‚úì Excellent ! +${points} pts`, 'success');

        setTimeout(() => {
            gameState.currentGameIndex++;
            loadBoxGame();
        }, 2500);
    } else {
        playSound('wrong'); // Son "wrong" au lieu de "error"
        gameState.attempts--;
        document.getElementById('current-game').classList.add('shake');
        setTimeout(() => document.getElementById('current-game').classList.remove('shake'), 500);

        if (gameState.attempts > 0) {
            showFeedback(`‚úó Incorrect ! ${gameState.attempts} essai(s) restant(s)`, 'error');
            updateGameDisplay();
            gameState.currentAnswer = null;
            startTimer();
        } else {
            // Afficher la bonne r√©ponse apr√®s √©chec
            gameState.stats.gamesLost++;
            const correctAnswerHTML = getCorrectAnswerText(currentGame);
            showFeedbackWithAnswer(`‚úó √âchec ! Jeu suivant...`, correctAnswerHTML, 'error');
            setTimeout(() => {
                gameState.currentGameIndex++;
                loadBoxGame();
            }, 5000); // Plus de temps pour lire la r√©ponse
        }
    }
}

function showFeedback(message, type) {
    const feedback = document.createElement('div');
    feedback.className = `fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 px-10 py-8 rounded-3xl text-white text-2xl md:text-3xl font-bold shadow-2xl z-50 bounce-in ${type === 'success' ? 'bg-gradient-to-r from-green-500 to-emerald-600' : 'bg-gradient-to-r from-red-500 to-pink-600'}`;
    feedback.textContent = message;
    document.body.appendChild(feedback);
    setTimeout(() => feedback.remove(), 2500);
}

function showFeedbackWithAnswer(message, answerHTML, type) {
    const feedback = document.createElement('div');
    feedback.className = `fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 px-10 py-8 rounded-3xl text-white text-xl md:text-2xl font-bold shadow-2xl z-50 bounce-in max-w-2xl ${type === 'success' ? 'bg-gradient-to-r from-green-500 to-emerald-600' : 'bg-gradient-to-r from-red-500 to-pink-600'}`;
    feedback.innerHTML = `
        <div class="mb-4 text-3xl">${message}</div>
        <div class="mt-4 p-4 bg-white bg-opacity-20 rounded-xl text-base text-left">
            ${answerHTML}
        </div>
    `;
    document.body.appendChild(feedback);
    setTimeout(() => feedback.remove(), 5000);
}

function unlockBox() {
    stopTimer();
    const boxIndex = gameState.currentBoxIndex;
    playSound('unlock', boxSoundFrequencies[boxIndex]);
    createConfetti();

    const box = boxesData[boxIndex];
    showFeedback(`üîì ${box.title} d√©verrouill√© !`, 'success');

    gameState.boxesUnlocked++;

    // DEBUG: Afficher l'√©tat apr√®s d√©verrouillage
    console.log('üîì Coffre d√©verrouill√©:', {
        boxIndex: boxIndex,
        boxesUnlocked: gameState.boxesUnlocked,
        totalScore: gameState.totalScore
    });

    broadcastUpdate();

    setTimeout(() => {
        if (gameState.boxesUnlocked >= boxesData.length) {
            endGame();
        } else {
            showScreen('boxes-screen');
            renderBoxes();
        }
    }, 3000);
}

// ==================== TIMER ====================

function startTimer() {
    stopTimer();

    gameState.timerInterval = setInterval(() => {
        gameState.timeLeft--;
        updateGameDisplay();

        if (gameState.timeLeft <= 10) {
            playSound('countdown');
            document.getElementById('timer-display').classList.add('timer-critical');
        }

        if (gameState.timeLeft <= 0) {
            stopTimer();
            gameState.attempts--;

            if (gameState.attempts > 0) {
                playSound('wrong');
                showFeedback(`‚è∞ Temps √©coul√© ! ${gameState.attempts} essai(s)`, 'error');
                const box = boxesData[gameState.currentBoxIndex];
                const gameVariations = box.games[gameState.currentGameIndex];
                const game = Array.isArray(gameVariations) ? gameVariations[0] : gameVariations;
                gameState.timeLeft = game.timeLimit;
                gameState.currentAnswer = null;
                updateGameDisplay();
                startTimer();
            } else {
                playSound('error');
                gameState.stats.gamesLost++;
                // Afficher la bonne r√©ponse apr√®s temps √©coul√©
                const box = boxesData[gameState.currentBoxIndex];
                const gameVariations = box.games[gameState.currentGameIndex];
                const game = Array.isArray(gameVariations) ? gameVariations[0] : gameVariations;
                const correctAnswerHTML = getCorrectAnswerText(game);
                showFeedbackWithAnswer('‚è∞ Temps √©coul√© ! Jeu suivant...', correctAnswerHTML, 'error');
                setTimeout(() => {
                    gameState.currentGameIndex++;
                    loadBoxGame();
                }, 5000);
            }
        }
    }, 1000);
}

function stopTimer() {
    if (gameState.timerInterval) {
        clearInterval(gameState.timerInterval);
        gameState.timerInterval = null;
    }
    document.getElementById('timer-display').classList.remove('timer-critical');
}

function updateGameDisplay() {
    document.getElementById('game-score-display').textContent = gameState.totalScore;
    document.getElementById('timer-display').textContent = gameState.timeLeft;
    document.getElementById('attempts-display').textContent = '‚ù§Ô∏è'.repeat(gameState.attempts) + 'üñ§'.repeat(gameState.maxAttempts - gameState.attempts);
}

// ==================== FIN DE JEU ====================

function endGame() {
    stopTimer();
    playSound('complete');
    createConfetti();

    gameState.stats.endTime = Date.now();
    broadcastUpdate();

    showScreen('end-screen');
    document.getElementById('final-score').textContent = gameState.totalScore;

    const avgTime = gameState.stats.gamesWon > 0 ? Math.round(gameState.stats.totalTime / gameState.stats.gamesWon) : 0;

    document.getElementById('final-stats').innerHTML = `
        <div class="glass-morphism p-6 rounded-2xl border-2 border-green-400">
            <div class="text-5xl font-bold text-green-600 dark:text-green-400 mb-2">${gameState.stats.gamesWon}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400 font-semibold">Jeux r√©ussis</div>
        </div>
        <div class="glass-morphism p-6 rounded-2xl border-2 border-red-400">
            <div class="text-5xl font-bold text-red-600 dark:text-red-400 mb-2">${gameState.stats.gamesLost}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400 font-semibold">Jeux rat√©s</div>
        </div>
        <div class="glass-morphism p-6 rounded-2xl border-2 border-blue-400">
            <div class="text-5xl font-bold text-blue-600 dark:text-blue-400 mb-2">${avgTime}s</div>
            <div class="text-sm text-gray-600 dark:text-gray-400 font-semibold">Temps moyen</div>
        </div>
    `;
}

// ==================== UTILITAIRES ====================

function showCustomAlert(message) {
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
        <div class="glass-morphism p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4 bounce-in border-2 border-primary">
            <p class="text-gray-700 dark:text-gray-300 mb-6 text-center text-xl font-semibold">${message}</p>
            <button class="w-full px-6 py-4 bg-gradient-to-r from-primary to-purple-600 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-2xl transition-all" onclick="this.closest('.fixed').remove()">OK</button>
        </div>
    `;
    document.body.appendChild(modal);
    playSound('tick');
}

function showConfirmDialog(message, onConfirm) {
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = `
        <div class="glass-morphism p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4 bounce-in border-2 border-orange-500">
            <p class="text-gray-700 dark:text-gray-300 mb-6 text-center text-xl font-semibold">${message}</p>
            <div class="flex gap-3">
                <button class="flex-1 px-6 py-4 bg-gray-500 hover:bg-gray-600 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-2xl transition-all" onclick="this.closest('.fixed').remove()">Annuler</button>
                <button id="confirm-btn" class="flex-1 px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-2xl transition-all">Confirmer</button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    playSound('tick');

    // Ajouter l'√©v√©nement de confirmation
    modal.querySelector('#confirm-btn').addEventListener('click', () => {
        modal.remove();
        onConfirm();
    });
}
</script></body></html>
